"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _teen_process = require("teen_process");
var _logger = _interopRequireDefault(require("../logger.js"));
var _helpers = require("../helpers.js");
var _support = require("@appium/support");
var _lodash = _interopRequireDefault(require("lodash"));
var _path = _interopRequireDefault(require("path"));
var _adbkitApkreader = _interopRequireDefault(require("adbkit-apkreader"));
let manifestMethods = {};
manifestMethods.packageAndLaunchActivityFromManifest = async function packageAndLaunchActivityFromManifest(appPath) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }
  let manifest;
  try {
    const apkReader = await _adbkitApkreader.default.open(appPath);
    manifest = await apkReader.readManifest();
  } catch (e) {
    _logger.default.debug(e);
    throw new Error(`Cannot extract a manifest from '${appPath}'. ` + `Is it a valid Android application?`);
  }
  const {
    pkg,
    activity
  } = (0, _helpers.parseManifest)(manifest);
  _logger.default.info(`Package name: '${pkg}'`);
  _logger.default.info(`Main activity name: '${activity}'`);
  return {
    apkPackage: pkg,
    apkActivity: activity
  };
};
manifestMethods.targetSdkVersionFromManifest = async function targetSdkVersionFromManifest(appPath) {
  _logger.default.debug(`Extracting target SDK version of '${appPath}'`);
  const originalAppPath = appPath;
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }
  const getTargetSdkViaApkReader = async () => {
    const apkReader = await _adbkitApkreader.default.open(appPath);
    const manifest = await apkReader.readManifest();
    if (manifest.usesSdk && _lodash.default.isInteger(manifest.usesSdk.targetSdkVersion)) {
      return manifest.usesSdk.targetSdkVersion;
    }
    throw new Error('Cannot find the information about targetSdkVersion in the manifest');
  };
  const getTargetSdkViaAapt = async () => {
    await this.initAapt();
    const args = ['dump', 'badging', appPath];
    const {
      stdout
    } = await (0, _teen_process.exec)(this.binaries.aapt, args);
    const targetSdkVersion = /targetSdkVersion:'([^']+)'/g.exec(stdout);
    if (!targetSdkVersion) {
      _logger.default.debug(stdout);
      throw new Error('Cannot parse the command output');
    }
    return parseInt(targetSdkVersion[1], 10);
  };
  const versionGetters = [['ApkReader', getTargetSdkViaApkReader], ['aapt', getTargetSdkViaAapt]];
  for (const [toolName, versionGetter] of versionGetters) {
    try {
      return await versionGetter();
    } catch (e) {
      _logger.default.info(`Cannot extract targetSdkVersion of '${originalAppPath}' using ${toolName}. ` + `Original error: ${e.message}`);
    }
  }
  throw new Error(`Cannot extract the target SDK version number of '${originalAppPath}' using either of ` + `${JSON.stringify(versionGetters.map(pair => pair[0]))} tools. ` + `Check the server log for more details`);
};
manifestMethods.targetSdkVersionUsingPKG = async function targetSdkVersionUsingPKG(pkg, cmdOutput = null) {
  let stdout = cmdOutput || (await this.shell(['dumpsys', 'package', pkg]));
  let targetSdkVersion = new RegExp(/targetSdk=([^\s\s]+)/g).exec(stdout);
  if (targetSdkVersion && targetSdkVersion.length >= 2) {
    targetSdkVersion = targetSdkVersion[1];
  } else {
    targetSdkVersion = 0;
  }
  return parseInt(targetSdkVersion, 10);
};
manifestMethods.compileManifest = async function compileManifest(manifest, manifestPackage, targetPackage) {
  const {
    platform,
    platformPath
  } = await (0, _helpers.getAndroidPlatformAndPath)(this.sdkRoot);
  if (!platform) {
    throw new Error('Cannot compile the manifest. The required platform does not exist (API level >= 17)');
  }
  const resultPath = `${manifest}.apk`;
  const androidJarPath = _path.default.resolve(platformPath, 'android.jar');
  if (await _support.fs.exists(resultPath)) {
    await _support.fs.rimraf(resultPath);
  }
  try {
    await this.initAapt2();
    const args = ['link', '-o', resultPath, '--manifest', manifest, '--rename-manifest-package', manifestPackage, '--rename-instrumentation-target-package', targetPackage, '-I', androidJarPath, '-v'];
    _logger.default.debug(`Compiling the manifest using '${_support.util.quote([this.binaries.aapt2, ...args])}'`);
    await (0, _teen_process.exec)(this.binaries.aapt2, args);
  } catch (e) {
    _logger.default.debug('Cannot compile the manifest using aapt2. Defaulting to aapt. ' + `Original error: ${e.stderr || e.message}`);
    await this.initAapt();
    const args = ['package', '-M', manifest, '--rename-manifest-package', manifestPackage, '--rename-instrumentation-target-package', targetPackage, '-I', androidJarPath, '-F', resultPath, '-f'];
    _logger.default.debug(`Compiling the manifest using '${_support.util.quote([this.binaries.aapt, ...args])}'`);
    try {
      await (0, _teen_process.exec)(this.binaries.aapt, args);
    } catch (e1) {
      throw new Error(`Cannot compile the manifest. Original error: ${e1.stderr || e1.message}`);
    }
  }
  _logger.default.debug(`Compiled the manifest at '${resultPath}'`);
};
manifestMethods.insertManifest = async function insertManifest(manifest, srcApk, dstApk) {
  _logger.default.debug(`Inserting manifest '${manifest}', src: '${srcApk}', dst: '${dstApk}'`);
  await _support.zip.assertValidZip(srcApk);
  await (0, _helpers.unzipFile)(`${manifest}.apk`);
  const manifestName = _path.default.basename(manifest);
  try {
    await this.initAapt();
    await _support.fs.copyFile(srcApk, dstApk);
    _logger.default.debug('Moving manifest');
    try {
      await (0, _teen_process.exec)(this.binaries.aapt, ['remove', dstApk, manifestName]);
    } catch (ign) {}
    await (0, _teen_process.exec)(this.binaries.aapt, ['add', dstApk, manifestName], {
      cwd: _path.default.dirname(manifest)
    });
  } catch (e) {
    _logger.default.debug('Cannot insert manifest using aapt. Defaulting to zip. ' + `Original error: ${e.stderr || e.message}`);
    const tmpRoot = await _support.tempDir.openDir();
    try {
      _logger.default.debug(`Extracting the source apk at '${srcApk}'`);
      await _support.zip.extractAllTo(srcApk, tmpRoot);
      _logger.default.debug('Moving manifest');
      await _support.fs.mv(manifest, _path.default.resolve(tmpRoot, manifestName));
      _logger.default.debug(`Collecting the destination apk at '${dstApk}'`);
      await _support.zip.toArchive(dstApk, {
        cwd: tmpRoot
      });
    } finally {
      await _support.fs.rimraf(tmpRoot);
    }
  }
  _logger.default.debug(`Manifest insertion into '${dstApk}' is completed`);
};
manifestMethods.hasInternetPermissionFromManifest = async function hasInternetPermissionFromManifest(appPath) {
  _logger.default.debug(`Checking if '${appPath}' requires internet access permission in the manifest`);
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    appPath = await this.extractBaseApk(appPath);
  }
  const apkReader = await _adbkitApkreader.default.open(appPath);
  const manifest = await apkReader.readManifest();
  return (manifest.usesPermissions || []).some(({
    name
  }) => name === 'android.permission.INTERNET');
};
var _default = manifestMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfdGVlbl9wcm9jZXNzIiwicmVxdWlyZSIsIl9sb2dnZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX2hlbHBlcnMiLCJfc3VwcG9ydCIsIl9sb2Rhc2giLCJfcGF0aCIsIl9hZGJraXRBcGtyZWFkZXIiLCJtYW5pZmVzdE1ldGhvZHMiLCJwYWNrYWdlQW5kTGF1bmNoQWN0aXZpdHlGcm9tTWFuaWZlc3QiLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsImV4dHJhY3RCYXNlQXBrIiwibWFuaWZlc3QiLCJhcGtSZWFkZXIiLCJBcGtSZWFkZXIiLCJvcGVuIiwicmVhZE1hbmlmZXN0IiwiZSIsImxvZyIsImRlYnVnIiwiRXJyb3IiLCJwa2ciLCJhY3Rpdml0eSIsInBhcnNlTWFuaWZlc3QiLCJpbmZvIiwiYXBrUGFja2FnZSIsImFwa0FjdGl2aXR5IiwidGFyZ2V0U2RrVmVyc2lvbkZyb21NYW5pZmVzdCIsIm9yaWdpbmFsQXBwUGF0aCIsImdldFRhcmdldFNka1ZpYUFwa1JlYWRlciIsInVzZXNTZGsiLCJfIiwiaXNJbnRlZ2VyIiwidGFyZ2V0U2RrVmVyc2lvbiIsImdldFRhcmdldFNka1ZpYUFhcHQiLCJpbml0QWFwdCIsImFyZ3MiLCJzdGRvdXQiLCJleGVjIiwiYmluYXJpZXMiLCJhYXB0IiwicGFyc2VJbnQiLCJ2ZXJzaW9uR2V0dGVycyIsInRvb2xOYW1lIiwidmVyc2lvbkdldHRlciIsIm1lc3NhZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwibWFwIiwicGFpciIsInRhcmdldFNka1ZlcnNpb25Vc2luZ1BLRyIsImNtZE91dHB1dCIsInNoZWxsIiwiUmVnRXhwIiwibGVuZ3RoIiwiY29tcGlsZU1hbmlmZXN0IiwibWFuaWZlc3RQYWNrYWdlIiwidGFyZ2V0UGFja2FnZSIsInBsYXRmb3JtIiwicGxhdGZvcm1QYXRoIiwiZ2V0QW5kcm9pZFBsYXRmb3JtQW5kUGF0aCIsInNka1Jvb3QiLCJyZXN1bHRQYXRoIiwiYW5kcm9pZEphclBhdGgiLCJwYXRoIiwicmVzb2x2ZSIsImZzIiwiZXhpc3RzIiwicmltcmFmIiwiaW5pdEFhcHQyIiwidXRpbCIsInF1b3RlIiwiYWFwdDIiLCJzdGRlcnIiLCJlMSIsImluc2VydE1hbmlmZXN0Iiwic3JjQXBrIiwiZHN0QXBrIiwiemlwIiwiYXNzZXJ0VmFsaWRaaXAiLCJ1bnppcEZpbGUiLCJtYW5pZmVzdE5hbWUiLCJiYXNlbmFtZSIsImNvcHlGaWxlIiwiaWduIiwiY3dkIiwiZGlybmFtZSIsInRtcFJvb3QiLCJ0ZW1wRGlyIiwib3BlbkRpciIsImV4dHJhY3RBbGxUbyIsIm12IiwidG9BcmNoaXZlIiwiaGFzSW50ZXJuZXRQZXJtaXNzaW9uRnJvbU1hbmlmZXN0IiwidXNlc1Blcm1pc3Npb25zIiwic29tZSIsIm5hbWUiLCJfZGVmYXVsdCIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3Rvb2xzL2FuZHJvaWQtbWFuaWZlc3QuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlYyB9IGZyb20gJ3RlZW5fcHJvY2Vzcyc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQge1xuICBnZXRBbmRyb2lkUGxhdGZvcm1BbmRQYXRoLCB1bnppcEZpbGUsXG4gIEFQS1NfRVhURU5TSU9OLCBwYXJzZU1hbmlmZXN0IH0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5pbXBvcnQgeyBmcywgemlwLCB0ZW1wRGlyLCB1dGlsIH0gZnJvbSAnQGFwcGl1bS9zdXBwb3J0JztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBBcGtSZWFkZXIgZnJvbSAnYWRia2l0LWFwa3JlYWRlcic7XG5cbmxldCBtYW5pZmVzdE1ldGhvZHMgPSB7fTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBBUEtJbmZvXG4gKiBAcHJvcGVydHkge3N0cmluZ30gYXBrUGFja2FnZSAtIFRoZSBuYW1lIG9mIGFwcGxpY2F0aW9uIHBhY2thZ2UsIGZvciBleGFtcGxlICdjb20uYWNtZS5hcHAnLlxuICogQHByb3BlcnR5IHtzdHJpbmd9IGFwa0FjdGl2aXR5IC0gVGhlIG5hbWUgb2YgbWFpbiBhcHBsaWNhdGlvbiBhY3Rpdml0eS5cbiAqL1xuXG4vKipcbiAqIEV4dHJhY3QgcGFja2FnZSBhbmQgbWFpbiBhY3Rpdml0eSBuYW1lIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIGFwcGxpY2F0aW9uIC5hcGsocykgcGFja2FnZVxuICogQHJldHVybiB7QVBLSW5mb30gVGhlIHBhcnNlZCBhcHBsaWNhdGlvbiBpbmZvLlxuICogQHRocm93cyB7ZXJyb3J9IElmIHRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBnZXR0aW5nIHRoZSBkYXRhIGZyb20gdGhlIGdpdmVuXG4gKiAgICAgICAgICAgICAgICAgYXBwbGljYXRpb24gcGFja2FnZS5cbiAqL1xubWFuaWZlc3RNZXRob2RzLnBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIHBhY2thZ2VBbmRMYXVuY2hBY3Rpdml0eUZyb21NYW5pZmVzdCAoYXBwUGF0aCkge1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBhcHBQYXRoID0gYXdhaXQgdGhpcy5leHRyYWN0QmFzZUFwayhhcHBQYXRoKTtcbiAgfVxuXG4gIGxldCBtYW5pZmVzdDtcbiAgdHJ5IHtcbiAgICBjb25zdCBhcGtSZWFkZXIgPSBhd2FpdCBBcGtSZWFkZXIub3BlbihhcHBQYXRoKTtcbiAgICBtYW5pZmVzdCA9IGF3YWl0IGFwa1JlYWRlci5yZWFkTWFuaWZlc3QoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZy5kZWJ1ZyhlKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleHRyYWN0IGEgbWFuaWZlc3QgZnJvbSAnJHthcHBQYXRofScuIGAgK1xuICAgICAgYElzIGl0IGEgdmFsaWQgQW5kcm9pZCBhcHBsaWNhdGlvbj9gKTtcbiAgfVxuICBjb25zdCB7cGtnLCBhY3Rpdml0eX0gPSBwYXJzZU1hbmlmZXN0KG1hbmlmZXN0KTtcbiAgbG9nLmluZm8oYFBhY2thZ2UgbmFtZTogJyR7cGtnfSdgKTtcbiAgbG9nLmluZm8oYE1haW4gYWN0aXZpdHkgbmFtZTogJyR7YWN0aXZpdHl9J2ApO1xuICByZXR1cm4ge1xuICAgIGFwa1BhY2thZ2U6IHBrZyxcbiAgICBhcGtBY3Rpdml0eTogYWN0aXZpdHksXG4gIH07XG59O1xuXG4vKipcbiAqIEV4dHJhY3QgdGFyZ2V0IFNESyB2ZXJzaW9uIGZyb20gYXBwbGljYXRpb24gbWFuaWZlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFBhdGggLSBUaGUgZnVsbCBwYXRoIHRvIC5hcGsocykgcGFja2FnZS5cbiAqIEByZXR1cm4ge251bWJlcn0gVGhlIHZlcnNpb24gb2YgdGhlIHRhcmdldCBTREsuXG4gKiBAdGhyb3dzIHtlcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIGdldHRpbmcgdGhlIGRhdGEgZnJvbSB0aGUgZ2l2ZW5cbiAqICAgICAgICAgICAgICAgICBhcHBsaWNhdGlvbiBwYWNrYWdlLlxuICovXG5tYW5pZmVzdE1ldGhvZHMudGFyZ2V0U2RrVmVyc2lvbkZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIHRhcmdldFNka1ZlcnNpb25Gcm9tTWFuaWZlc3QgKGFwcFBhdGgpIHtcbiAgbG9nLmRlYnVnKGBFeHRyYWN0aW5nIHRhcmdldCBTREsgdmVyc2lvbiBvZiAnJHthcHBQYXRofSdgKTtcbiAgY29uc3Qgb3JpZ2luYWxBcHBQYXRoID0gYXBwUGF0aDtcbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgYXBwUGF0aCA9IGF3YWl0IHRoaXMuZXh0cmFjdEJhc2VBcGsoYXBwUGF0aCk7XG4gIH1cblxuICBjb25zdCBnZXRUYXJnZXRTZGtWaWFBcGtSZWFkZXIgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgYXBrUmVhZGVyID0gYXdhaXQgQXBrUmVhZGVyLm9wZW4oYXBwUGF0aCk7XG4gICAgY29uc3QgbWFuaWZlc3QgPSBhd2FpdCBhcGtSZWFkZXIucmVhZE1hbmlmZXN0KCk7XG4gICAgaWYgKG1hbmlmZXN0LnVzZXNTZGsgJiYgXy5pc0ludGVnZXIobWFuaWZlc3QudXNlc1Nkay50YXJnZXRTZGtWZXJzaW9uKSkge1xuICAgICAgcmV0dXJuIG1hbmlmZXN0LnVzZXNTZGsudGFyZ2V0U2RrVmVyc2lvbjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgZmluZCB0aGUgaW5mb3JtYXRpb24gYWJvdXQgdGFyZ2V0U2RrVmVyc2lvbiBpbiB0aGUgbWFuaWZlc3QnKTtcbiAgfTtcbiAgY29uc3QgZ2V0VGFyZ2V0U2RrVmlhQWFwdCA9IGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gICAgY29uc3QgYXJncyA9IFsnZHVtcCcsICdiYWRnaW5nJywgYXBwUGF0aF07XG4gICAgY29uc3Qge3N0ZG91dH0gPSBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuYWFwdCwgYXJncyk7XG4gICAgY29uc3QgdGFyZ2V0U2RrVmVyc2lvbiA9IC90YXJnZXRTZGtWZXJzaW9uOicoW14nXSspJy9nLmV4ZWMoc3Rkb3V0KTtcbiAgICBpZiAoIXRhcmdldFNka1ZlcnNpb24pIHtcbiAgICAgIGxvZy5kZWJ1ZyhzdGRvdXQpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcGFyc2UgdGhlIGNvbW1hbmQgb3V0cHV0Jyk7XG4gICAgfVxuICAgIHJldHVybiBwYXJzZUludCh0YXJnZXRTZGtWZXJzaW9uWzFdLCAxMCk7XG4gIH07XG4gIGNvbnN0IHZlcnNpb25HZXR0ZXJzID0gW1xuICAgIFsnQXBrUmVhZGVyJywgZ2V0VGFyZ2V0U2RrVmlhQXBrUmVhZGVyXSxcbiAgICBbJ2FhcHQnLCBnZXRUYXJnZXRTZGtWaWFBYXB0XSxcbiAgXTtcbiAgZm9yIChjb25zdCBbdG9vbE5hbWUsIHZlcnNpb25HZXR0ZXJdIG9mIHZlcnNpb25HZXR0ZXJzKSB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCB2ZXJzaW9uR2V0dGVyKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgbG9nLmluZm8oYENhbm5vdCBleHRyYWN0IHRhcmdldFNka1ZlcnNpb24gb2YgJyR7b3JpZ2luYWxBcHBQYXRofScgdXNpbmcgJHt0b29sTmFtZX0uIGAgK1xuICAgICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZS5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBleHRyYWN0IHRoZSB0YXJnZXQgU0RLIHZlcnNpb24gbnVtYmVyIG9mICcke29yaWdpbmFsQXBwUGF0aH0nIHVzaW5nIGVpdGhlciBvZiBgICtcbiAgICBgJHtKU09OLnN0cmluZ2lmeSh2ZXJzaW9uR2V0dGVycy5tYXAoKHBhaXIpID0+IHBhaXJbMF0pKX0gdG9vbHMuIGAgK1xuICAgIGBDaGVjayB0aGUgc2VydmVyIGxvZyBmb3IgbW9yZSBkZXRhaWxzYCk7XG59O1xuXG4vKipcbiAqIEV4dHJhY3QgdGFyZ2V0IFNESyB2ZXJzaW9uIGZyb20gcGFja2FnZSBpbmZvcm1hdGlvbi5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gcGtnIC0gVGhlIGNsYXNzIG5hbWUgb2YgdGhlIHBhY2thZ2UgaW5zdGFsbGVkIG9uIHRoZSBkZXZpY2UgdW5kZXIgdGVzdC5cbiAqIEBwYXJhbSB7P3N0cmluZ30gY21kT3V0cHV0IC0gT3B0aW9uYWwgcGFyYW1ldGVyIGNvbnRhaW5pbmcgdGhlIG91dHB1dCBvZlxuICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfZHVtcHN5cyBwYWNrYWdlXyBjb21tYW5kLiBJdCBtYXkgc3BlZWQgdXAgdGhlIG1ldGhvZCBleGVjdXRpb24uXG4gKiBAcmV0dXJuIHtudW1iZXJ9IFRoZSB2ZXJzaW9uIG9mIHRoZSB0YXJnZXQgU0RLLlxuICovXG5tYW5pZmVzdE1ldGhvZHMudGFyZ2V0U2RrVmVyc2lvblVzaW5nUEtHID0gYXN5bmMgZnVuY3Rpb24gdGFyZ2V0U2RrVmVyc2lvblVzaW5nUEtHIChwa2csIGNtZE91dHB1dCA9IG51bGwpIHtcbiAgbGV0IHN0ZG91dCA9IGNtZE91dHB1dCB8fCBhd2FpdCB0aGlzLnNoZWxsKFsnZHVtcHN5cycsICdwYWNrYWdlJywgcGtnXSk7XG4gIGxldCB0YXJnZXRTZGtWZXJzaW9uID0gbmV3IFJlZ0V4cCgvdGFyZ2V0U2RrPShbXlxcc1xcc10rKS9nKS5leGVjKHN0ZG91dCk7XG4gIGlmICh0YXJnZXRTZGtWZXJzaW9uICYmIHRhcmdldFNka1ZlcnNpb24ubGVuZ3RoID49IDIpIHtcbiAgICB0YXJnZXRTZGtWZXJzaW9uID0gdGFyZ2V0U2RrVmVyc2lvblsxXTtcbiAgfSBlbHNlIHtcbiAgICAvLyB0YXJnZXRTZGsgbm90IGZvdW5kIGluIHRoZSBkdW1wLCBhc3NpZ25pbmcgMCB0byB0YXJnZXRTZGtWZXJzaW9uXG4gICAgdGFyZ2V0U2RrVmVyc2lvbiA9IDA7XG4gIH1cbiAgcmV0dXJuIHBhcnNlSW50KHRhcmdldFNka1ZlcnNpb24sIDEwKTtcbn07XG5cbi8qKlxuICogQ3JlYXRlIGJpbmFyeSByZXByZXNlbnRhdGlvbiBvZiBwYWNrYWdlIG1hbmlmZXN0ICh1c3VhbGx5IEFuZHJvaWRNYW5pZmVzdC54bWwpLlxuICogYCR7bWFuaWZlc3R9LmFwa2AgZmlsZSB3aWxsIGJlIGNyZWF0ZWQgYXMgdGhlIHJlc3VsdCBvZiB0aGlzIG1ldGhvZFxuICogY29udGFpbmluZyB0aGUgY29tcGlsZWQgbWFuaWZlc3QuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG1hbmlmZXN0IC0gRnVsbCBwYXRoIHRvIHRoZSBpbml0aWFsIG1hbmlmZXN0IHRlbXBsYXRlXG4gKiBAcGFyYW0ge3N0cmluZ30gbWFuaWZlc3RQYWNrYWdlIC0gVGhlIG5hbWUgb2YgdGhlIG1hbmlmZXN0IHBhY2thZ2VcbiAqIEBwYXJhbSB7c3RyaW5nfSB0YXJnZXRQYWNrYWdlIC0gVGhlIG5hbWUgb2YgdGhlIGRlc3RpbmF0aW9uIHBhY2thZ2VcbiAqL1xubWFuaWZlc3RNZXRob2RzLmNvbXBpbGVNYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIGNvbXBpbGVNYW5pZmVzdCAobWFuaWZlc3QsIG1hbmlmZXN0UGFja2FnZSwgdGFyZ2V0UGFja2FnZSkge1xuICBjb25zdCB7cGxhdGZvcm0sIHBsYXRmb3JtUGF0aH0gPSBhd2FpdCBnZXRBbmRyb2lkUGxhdGZvcm1BbmRQYXRoKHRoaXMuc2RrUm9vdCk7XG4gIGlmICghcGxhdGZvcm0pIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdC4gVGhlIHJlcXVpcmVkIHBsYXRmb3JtIGRvZXMgbm90IGV4aXN0IChBUEkgbGV2ZWwgPj0gMTcpJyk7XG4gIH1cbiAgY29uc3QgcmVzdWx0UGF0aCA9IGAke21hbmlmZXN0fS5hcGtgO1xuICBjb25zdCBhbmRyb2lkSmFyUGF0aCA9IHBhdGgucmVzb2x2ZShwbGF0Zm9ybVBhdGgsICdhbmRyb2lkLmphcicpO1xuICBpZiAoYXdhaXQgZnMuZXhpc3RzKHJlc3VsdFBhdGgpKSB7XG4gICAgYXdhaXQgZnMucmltcmFmKHJlc3VsdFBhdGgpO1xuICB9XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdDIoKTtcbiAgICAvLyBodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9zdHVkaW8vY29tbWFuZC1saW5lL2FhcHQyXG4gICAgY29uc3QgYXJncyA9IFtcbiAgICAgICdsaW5rJyxcbiAgICAgICctbycsIHJlc3VsdFBhdGgsXG4gICAgICAnLS1tYW5pZmVzdCcsIG1hbmlmZXN0LFxuICAgICAgJy0tcmVuYW1lLW1hbmlmZXN0LXBhY2thZ2UnLCBtYW5pZmVzdFBhY2thZ2UsXG4gICAgICAnLS1yZW5hbWUtaW5zdHJ1bWVudGF0aW9uLXRhcmdldC1wYWNrYWdlJywgdGFyZ2V0UGFja2FnZSxcbiAgICAgICctSScsIGFuZHJvaWRKYXJQYXRoLFxuICAgICAgJy12JyxcbiAgICBdO1xuICAgIGxvZy5kZWJ1ZyhgQ29tcGlsaW5nIHRoZSBtYW5pZmVzdCB1c2luZyAnJHt1dGlsLnF1b3RlKFt0aGlzLmJpbmFyaWVzLmFhcHQyLCAuLi5hcmdzXSl9J2ApO1xuICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0MiwgYXJncyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoJ0Nhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdCB1c2luZyBhYXB0Mi4gRGVmYXVsdGluZyB0byBhYXB0LiAnICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gICAgYXdhaXQgdGhpcy5pbml0QWFwdCgpO1xuICAgIGNvbnN0IGFyZ3MgPSBbXG4gICAgICAncGFja2FnZScsXG4gICAgICAnLU0nLCBtYW5pZmVzdCxcbiAgICAgICctLXJlbmFtZS1tYW5pZmVzdC1wYWNrYWdlJywgbWFuaWZlc3RQYWNrYWdlLFxuICAgICAgJy0tcmVuYW1lLWluc3RydW1lbnRhdGlvbi10YXJnZXQtcGFja2FnZScsIHRhcmdldFBhY2thZ2UsXG4gICAgICAnLUknLCBhbmRyb2lkSmFyUGF0aCxcbiAgICAgICctRicsIHJlc3VsdFBhdGgsXG4gICAgICAnLWYnLFxuICAgIF07XG4gICAgbG9nLmRlYnVnKGBDb21waWxpbmcgdGhlIG1hbmlmZXN0IHVzaW5nICcke3V0aWwucXVvdGUoW3RoaXMuYmluYXJpZXMuYWFwdCwgLi4uYXJnc10pfSdgKTtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLmFhcHQsIGFyZ3MpO1xuICAgIH0gY2F0Y2ggKGUxKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBjb21waWxlIHRoZSBtYW5pZmVzdC4gT3JpZ2luYWwgZXJyb3I6ICR7ZTEuc3RkZXJyIHx8IGUxLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG4gIGxvZy5kZWJ1ZyhgQ29tcGlsZWQgdGhlIG1hbmlmZXN0IGF0ICcke3Jlc3VsdFBhdGh9J2ApO1xufTtcblxuLyoqXG4gKiBSZXBsYWNlL2luc2VydCB0aGUgc3BlY2lhbGx5IHByZWNvbXBpbGVkIG1hbmlmZXN0IGZpbGUgaW50byB0aGVcbiAqIHBhcnRpY3VsYXIgcGFja2FnZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbWFuaWZlc3QgLSBGdWxsIHBhdGggdG8gdGhlIHByZWNvbXBpbGVkIG1hbmlmZXN0XG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVhdGVkIGJ5IGBjb21waWxlTWFuaWZlc3RgIG1ldGhvZCBjYWxsXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aXRob3V0IC5hcGsgZXh0ZW5zaW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3JjQXBrIC0gRnVsbCBwYXRoIHRvIHRoZSBleGlzdGluZyB2YWxpZCBhcHBsaWNhdGlvbiBwYWNrYWdlLCB3aGVyZVxuICogICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMgbWFuaWZlc3QgaGFzIHRvIGJlIGluc2V0cmVkIHRvLiBUaGlzIHBhY2thZ2VcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICB3aWxsIE5PVCBiZSBtb2RpZmllZC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBkc3RBcGsgLSBGdWxsIHBhdGggdG8gdGhlIHJlc3VsdGluZyBwYWNrYWdlLlxuICogICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBmaWxlIHdpbGwgYmUgb3ZlcnJpZGRlbiBpZiBpdCBhbHJlYWR5IGV4aXN0cy5cbiAqL1xubWFuaWZlc3RNZXRob2RzLmluc2VydE1hbmlmZXN0ID0gYXN5bmMgZnVuY3Rpb24gaW5zZXJ0TWFuaWZlc3QgKG1hbmlmZXN0LCBzcmNBcGssIGRzdEFwaykge1xuICBsb2cuZGVidWcoYEluc2VydGluZyBtYW5pZmVzdCAnJHttYW5pZmVzdH0nLCBzcmM6ICcke3NyY0Fwa30nLCBkc3Q6ICcke2RzdEFwa30nYCk7XG4gIGF3YWl0IHppcC5hc3NlcnRWYWxpZFppcChzcmNBcGspO1xuICBhd2FpdCB1bnppcEZpbGUoYCR7bWFuaWZlc3R9LmFwa2ApO1xuICBjb25zdCBtYW5pZmVzdE5hbWUgPSBwYXRoLmJhc2VuYW1lKG1hbmlmZXN0KTtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmluaXRBYXB0KCk7XG4gICAgYXdhaXQgZnMuY29weUZpbGUoc3JjQXBrLCBkc3RBcGspO1xuICAgIGxvZy5kZWJ1ZygnTW92aW5nIG1hbmlmZXN0Jyk7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAgICdyZW1vdmUnLCBkc3RBcGssIG1hbmlmZXN0TmFtZVxuICAgICAgXSk7XG4gICAgfSBjYXRjaCAoaWduKSB7fVxuICAgIGF3YWl0IGV4ZWModGhpcy5iaW5hcmllcy5hYXB0LCBbXG4gICAgICAnYWRkJywgZHN0QXBrLCBtYW5pZmVzdE5hbWVcbiAgICBdLCB7Y3dkOiBwYXRoLmRpcm5hbWUobWFuaWZlc3QpfSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2cuZGVidWcoJ0Nhbm5vdCBpbnNlcnQgbWFuaWZlc3QgdXNpbmcgYWFwdC4gRGVmYXVsdGluZyB0byB6aXAuICcgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUubWVzc2FnZX1gKTtcbiAgICBjb25zdCB0bXBSb290ID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVuZm9ydHVuYXRlbHkgTm9kZUpTIGRvZXMgbm90IHByb3ZpZGUgYW55IHJlbGlhYmxlIG1ldGhvZHNcbiAgICAgIC8vIHRvIHJlcGxhY2UgZmlsZXMgaW5zaWRlIHppcCBhcmNoaXZlcyB3aXRob3V0IGxvYWRpbmcgdGhlXG4gICAgICAvLyB3aG9sZSBhcmNoaXZlIGNvbnRlbnQgaW50byBSQU1cbiAgICAgIGxvZy5kZWJ1ZyhgRXh0cmFjdGluZyB0aGUgc291cmNlIGFwayBhdCAnJHtzcmNBcGt9J2ApO1xuICAgICAgYXdhaXQgemlwLmV4dHJhY3RBbGxUbyhzcmNBcGssIHRtcFJvb3QpO1xuICAgICAgbG9nLmRlYnVnKCdNb3ZpbmcgbWFuaWZlc3QnKTtcbiAgICAgIGF3YWl0IGZzLm12KG1hbmlmZXN0LCBwYXRoLnJlc29sdmUodG1wUm9vdCwgbWFuaWZlc3ROYW1lKSk7XG4gICAgICBsb2cuZGVidWcoYENvbGxlY3RpbmcgdGhlIGRlc3RpbmF0aW9uIGFwayBhdCAnJHtkc3RBcGt9J2ApO1xuICAgICAgYXdhaXQgemlwLnRvQXJjaGl2ZShkc3RBcGssIHtcbiAgICAgICAgY3dkOiB0bXBSb290LFxuICAgICAgfSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGF3YWl0IGZzLnJpbXJhZih0bXBSb290KTtcbiAgICB9XG4gIH1cbiAgbG9nLmRlYnVnKGBNYW5pZmVzdCBpbnNlcnRpb24gaW50byAnJHtkc3RBcGt9JyBpcyBjb21wbGV0ZWRgKTtcbn07XG5cbi8qKlxuICogQ2hlY2sgd2hldGhlciBwYWNrYWdlIG1hbmlmZXN0IGNvbnRhaW5zIEludGVybmV0IHBlcm1pc3Npb25zLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byAuYXBrKHMpIHBhY2thZ2UuXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIHRoZSBtYW5pZmVzdCByZXF1aXJlcyBJbnRlcm5ldCBhY2Nlc3MgcGVybWlzc2lvbi5cbiAqL1xubWFuaWZlc3RNZXRob2RzLmhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCA9IGFzeW5jIGZ1bmN0aW9uIGhhc0ludGVybmV0UGVybWlzc2lvbkZyb21NYW5pZmVzdCAoYXBwUGF0aCkge1xuICBsb2cuZGVidWcoYENoZWNraW5nIGlmICcke2FwcFBhdGh9JyByZXF1aXJlcyBpbnRlcm5ldCBhY2Nlc3MgcGVybWlzc2lvbiBpbiB0aGUgbWFuaWZlc3RgKTtcbiAgaWYgKGFwcFBhdGguZW5kc1dpdGgoQVBLU19FWFRFTlNJT04pKSB7XG4gICAgYXBwUGF0aCA9IGF3YWl0IHRoaXMuZXh0cmFjdEJhc2VBcGsoYXBwUGF0aCk7XG4gIH1cblxuICBjb25zdCBhcGtSZWFkZXIgPSBhd2FpdCBBcGtSZWFkZXIub3BlbihhcHBQYXRoKTtcbiAgY29uc3QgbWFuaWZlc3QgPSBhd2FpdCBhcGtSZWFkZXIucmVhZE1hbmlmZXN0KCk7XG4gIHJldHVybiAobWFuaWZlc3QudXNlc1Blcm1pc3Npb25zIHx8IFtdKS5zb21lKCh7bmFtZX0pID0+IG5hbWUgPT09ICdhbmRyb2lkLnBlcm1pc3Npb24uSU5URVJORVQnKTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IG1hbmlmZXN0TWV0aG9kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxhQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFDLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBRyxRQUFBLEdBQUFILE9BQUE7QUFHQSxJQUFBSSxRQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxPQUFBLEdBQUFILHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBTSxLQUFBLEdBQUFKLHNCQUFBLENBQUFGLE9BQUE7QUFDQSxJQUFBTyxnQkFBQSxHQUFBTCxzQkFBQSxDQUFBRixPQUFBO0FBRUEsSUFBSVEsZUFBZSxHQUFHLENBQUMsQ0FBQztBQWdCeEJBLGVBQWUsQ0FBQ0Msb0NBQW9DLEdBQUcsZUFBZUEsb0NBQW9DQSxDQUFFQyxPQUFPLEVBQUU7RUFDbkgsSUFBSUEsT0FBTyxDQUFDQyxRQUFRLENBQUNDLHVCQUFjLENBQUMsRUFBRTtJQUNwQ0YsT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDRyxjQUFjLENBQUNILE9BQU8sQ0FBQztFQUM5QztFQUVBLElBQUlJLFFBQVE7RUFDWixJQUFJO0lBQ0YsTUFBTUMsU0FBUyxHQUFHLE1BQU1DLHdCQUFTLENBQUNDLElBQUksQ0FBQ1AsT0FBTyxDQUFD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