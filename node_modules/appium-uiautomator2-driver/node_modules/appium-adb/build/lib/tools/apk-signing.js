"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _fs2 = _interopRequireDefault(require("fs"));
var _teen_process = require("teen_process");
var _path = _interopRequireDefault(require("path"));
var _logger = _interopRequireDefault(require("../logger.js"));
var _support = require("@appium/support");
var _lruCache = _interopRequireDefault(require("lru-cache"));
var _helpers = require("../helpers.js");
const DEFAULT_PRIVATE_KEY = _path.default.join('keys', 'testkey.pk8');
const DEFAULT_CERTIFICATE = _path.default.join('keys', 'testkey.x509.pem');
const BUNDLETOOL_TUTORIAL = 'https://developer.android.com/studio/command-line/bundletool';
const APKSIGNER_VERIFY_FAIL = 'DOES NOT VERIFY';
const SHA1 = 'sha1';
const SHA256 = 'sha256';
const SHA512 = 'sha512';
const MD5 = 'md5';
const DEFAULT_CERT_HASH = {
  [SHA256]: 'a40da80a59d170caa950cf15c18c454d47a39b26989d8b640ecd745ba71bf5dc'
};
const JAVA_PROPS_INIT_ERROR = 'java.lang.Error: Properties init';
const SIGNED_APPS_CACHE = new _lruCache.default({
  max: 30
});
const apkSigningMethods = {};
apkSigningMethods.executeApksigner = async function executeApksigner(args = []) {
  const apkSignerJar = await (0, _helpers.getApksignerForOs)(this);
  const fullCmd = [await (0, _helpers.getJavaForOs)(), '-Xmx1024M', '-Xss1m', '-jar', apkSignerJar, ...args];
  _logger.default.debug(`Starting apksigner: ${_support.util.quote(fullCmd)}`);
  const {
    stdout,
    stderr
  } = await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1), {
    cwd: _path.default.dirname(apkSignerJar),
    windowsVerbatimArguments: _support.system.isWindows()
  });
  for (let [name, stream] of [['stdout', stdout], ['stderr', stderr]]) {
    if (!_lodash.default.trim(stream)) {
      continue;
    }
    if (name === 'stdout') {
      stream = stream.split('\n').filter(line => !line.includes('WARNING:')).join('\n');
    }
    _logger.default.debug(`apksigner ${name}: ${stream}`);
  }
  return stdout;
};
apkSigningMethods.signWithDefaultCert = async function signWithDefaultCert(apk) {
  _logger.default.debug(`Signing '${apk}' with default cert`);
  if (!(await _support.fs.exists(apk))) {
    throw new Error(`${apk} file doesn't exist.`);
  }
  const args = ['sign', '--key', await (0, _helpers.getResourcePath)(DEFAULT_PRIVATE_KEY), '--cert', await (0, _helpers.getResourcePath)(DEFAULT_CERTIFICATE), apk];
  try {
    await this.executeApksigner(args);
  } catch (e) {
    throw new Error(`Could not sign '${apk}' with the default certificate. ` + `Original error: ${e.stderr || e.stdout || e.message}`);
  }
};
apkSigningMethods.signWithCustomCert = async function signWithCustomCert(apk) {
  _logger.default.debug(`Signing '${apk}' with custom cert`);
  if (!(await _support.fs.exists(this.keystorePath))) {
    throw new Error(`Keystore: ${this.keystorePath} doesn't exist.`);
  }
  if (!(await _support.fs.exists(apk))) {
    throw new Error(`'${apk}' doesn't exist.`);
  }
  try {
    await this.executeApksigner(['sign', '--ks', this.keystorePath, '--ks-key-alias', this.keyAlias, '--ks-pass', `pass:${this.keystorePassword}`, '--key-pass', `pass:${this.keyPassword}`, apk]);
  } catch (err) {
    _logger.default.warn(`Cannot use apksigner tool for signing. Defaulting to jarsigner. ` + `Original error: ${err.stderr || err.stdout || err.message}`);
    try {
      if (await (0, _helpers.unsignApk)(apk)) {
        _logger.default.debug(`'${apk}' has been successfully unsigned`);
      } else {
        _logger.default.debug(`'${apk}' does not need to be unsigned`);
      }
      const jarsigner = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `jarsigner${_support.system.isWindows() ? '.exe' : ''}`);
      const fullCmd = [jarsigner, '-sigalg', 'MD5withRSA', '-digestalg', 'SHA1', '-keystore', this.keystorePath, '-storepass', this.keystorePassword, '-keypass', this.keyPassword, apk, this.keyAlias];
      _logger.default.debug(`Starting jarsigner: ${_support.util.quote(fullCmd)}`);
      await (0, _teen_process.exec)(fullCmd[0], fullCmd.slice(1), {
        windowsVerbatimArguments: _support.system.isWindows()
      });
    } catch (e) {
      throw new Error(`Could not sign with custom certificate. ` + `Original error: ${e.stderr || e.message}`);
    }
  }
};
apkSigningMethods.sign = async function sign(appPath) {
  if (appPath.endsWith(_helpers.APKS_EXTENSION)) {
    let message = 'Signing of .apks-files is not supported. ';
    if (this.useKeystore) {
      message += 'Consider manual application bundle signing with the custom keystore ' + `like it is described at ${BUNDLETOOL_TUTORIAL}`;
    } else {
      message += `Consider manual application bundle signing with the key at '${DEFAULT_PRIVATE_KEY}' ` + `and the certificate at '${DEFAULT_CERTIFICATE}'. Read ${BUNDLETOOL_TUTORIAL} for more details.`;
    }
    _logger.default.warn(message);
    return;
  }
  await this.zipAlignApk(appPath);
  if (this.useKeystore) {
    await this.signWithCustomCert(appPath);
  } else {
    await this.signWithDefaultCert(appPath);
  }
};
apkSigningMethods.zipAlignApk = async function zipAlignApk(apk) {
  await this.initZipAlign();
  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-c', '4', apk]);
    _logger.default.debug(`${apk}' is already zip-aligned. Doing nothing`);
    return false;
  } catch (e) {
    _logger.default.debug(`'${apk}' is not zip-aligned. Aligning`);
  }
  try {
    await _support.fs.access(apk, _fs2.default.W_OK);
  } catch (e) {
    throw new Error(`The file at '${apk}' is not writeable. ` + `Please grant write permissions to this file or to its parent folder '${_path.default.dirname(apk)}' ` + `for the Appium process, so it can zip-align the file`);
  }
  const alignedApk = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.tmp'
  });
  await (0, _support.mkdirp)(_path.default.dirname(alignedApk));
  try {
    await (0, _teen_process.exec)(this.binaries.zipalign, ['-f', '4', apk, alignedApk]);
    await _support.fs.mv(alignedApk, apk, {
      mkdirp: true
    });
    return true;
  } catch (e) {
    if (await _support.fs.exists(alignedApk)) {
      await _support.fs.unlink(alignedApk);
    }
    throw new Error(`zipAlignApk failed. Original error: ${e.stderr || e.message}`);
  }
};
apkSigningMethods.checkApkCert = async function checkApkCert(appPath, pkg, opts = {}) {
  _logger.default.debug(`Checking app cert for ${appPath}`);
  if (!(await _support.fs.exists(appPath))) {
    _logger.default.debug(`'${appPath}' does not exist`);
    return false;
  }
  if (_path.default.extname(appPath) === _helpers.APKS_EXTENSION) {
    appPath = await this.extractBaseApk(appPath);
  }
  const hashMatches = (apksignerOutput, expectedHashes) => {
    for (const [name, value] of _lodash.default.toPairs(expectedHashes)) {
      if (new RegExp(`digest:\\s+${value}\\b`, 'i').test(apksignerOutput)) {
        _logger.default.debug(`${name} hash did match for '${_path.default.basename(appPath)}'`);
        return true;
      }
    }
    return false;
  };
  const {
    requireDefaultCert = true
  } = opts;
  const appHash = await _support.fs.hash(appPath);
  if (SIGNED_APPS_CACHE.has(appHash)) {
    _logger.default.debug(`Using the previously cached signature entry for '${_path.default.basename(appPath)}'`);
    const {
      keystorePath,
      output,
      expected
    } = SIGNED_APPS_CACHE.get(appHash);
    if (this.useKeystore && this.keystorePath === keystorePath || !this.useKeystore) {
      return !this.useKeystore && !requireDefaultCert || hashMatches(output, expected);
    }
  }
  const expected = this.useKeystore ? await this.getKeystoreHash(appPath, pkg) : DEFAULT_CERT_HASH;
  try {
    await (0, _helpers.getApksignerForOs)(this);
    const output = await this.executeApksigner(['verify', '--print-certs', appPath]);
    const hasMatch = hashMatches(output, expected);
    if (hasMatch) {
      _logger.default.info(`'${appPath}' is signed with the ` + `${this.useKeystore ? 'keystore' : 'default'} certificate`);
    } else {
      _logger.default.info(`'${appPath}' is signed with a ` + `non-${this.useKeystore ? 'keystore' : 'default'} certificate`);
    }
    const isSigned = !this.useKeystore && !requireDefaultCert || hasMatch;
    if (isSigned) {
      SIGNED_APPS_CACHE.set(appHash, {
        output,
        expected,
        keystorePath: this.keystorePath
      });
    }
    return isSigned;
  } catch (err) {
    if (_lodash.default.includes(err.stderr, APKSIGNER_VERIFY_FAIL)) {
      _logger.default.info(`'${appPath}' is not signed`);
      return false;
    }
    const errMsg = err.stderr || err.stdout || err.message;
    if (_lodash.default.includes(errMsg, JAVA_PROPS_INIT_ERROR)) {
      _logger.default.warn(errMsg);
      _logger.default.warn(`Assuming '${appPath}' is already signed and continuing anyway`);
      return true;
    }
    throw new Error(`Cannot verify the signature of '${appPath}'. ` + `Original error: ${errMsg}`);
  }
};
apkSigningMethods.getKeystoreHash = async function getKeystoreHash() {
  _logger.default.debug(`Getting hash of the '${this.keystorePath}' keystore`);
  const keytool = _path.default.resolve(await (0, _helpers.getJavaHome)(), 'bin', `keytool${_support.system.isWindows() ? '.exe' : ''}`);
  if (!(await _support.fs.exists(keytool))) {
    throw new Error(`The keytool utility cannot be found at '${keytool}'`);
  }
  const args = ['-v', '-list', '-alias', this.keyAlias, '-keystore', this.keystorePath, '-storepass', this.keystorePassword];
  _logger.default.info(`Running '${keytool}' with arguments: ${_support.util.quote(args)}`);
  try {
    const {
      stdout
    } = await (0, _teen_process.exec)(keytool, args, {
      windowsVerbatimArguments: _support.system.isWindows()
    });
    const result = {};
    for (const hashName of [SHA512, SHA256, SHA1, MD5]) {
      const hashRe = new RegExp(`^\\s*${hashName}:\\s*([a-f0-9:]+)`, 'mi');
      const match = hashRe.exec(stdout);
      if (!match) {
        continue;
      }
      result[hashName] = match[1].replace(/:/g, '').toLowerCase();
    }
    if (_lodash.default.isEmpty(result)) {
      _logger.default.debug(stdout);
      throw new Error('Cannot parse the hash value from the keytool output');
    }
    _logger.default.debug(`Keystore hash: ${JSON.stringify(result)}`);
    return result;
  } catch (e) {
    throw new Error(`Cannot get the hash of '${this.keystorePath}' keystore. ` + `Original error: ${e.stderr || e.message}`);
  }
};
var _default = apkSigningMethods;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfZnMyIiwiX3RlZW5fcHJvY2VzcyIsIl9wYXRoIiwiX2xvZ2dlciIsIl9zdXBwb3J0IiwiX2xydUNhY2hlIiwiX2hlbHBlcnMiLCJERUZBVUxUX1BSSVZBVEVfS0VZIiwicGF0aCIsImpvaW4iLCJERUZBVUxUX0NFUlRJRklDQVRFIiwiQlVORExFVE9PTF9UVVRPUklBTCIsIkFQS1NJR05FUl9WRVJJRllfRkFJTCIsIlNIQTEiLCJTSEEyNTYiLCJTSEE1MTIiLCJNRDUiLCJERUZBVUxUX0NFUlRfSEFTSCIsIkpBVkFfUFJPUFNfSU5JVF9FUlJPUiIsIlNJR05FRF9BUFBTX0NBQ0hFIiwiTFJVIiwibWF4IiwiYXBrU2lnbmluZ01ldGhvZHMiLCJleGVjdXRlQXBrc2lnbmVyIiwiYXJncyIsImFwa1NpZ25lckphciIsImdldEFwa3NpZ25lckZvck9zIiwiZnVsbENtZCIsImdldEphdmFGb3JPcyIsImxvZyIsImRlYnVnIiwidXRpbCIsInF1b3RlIiwic3Rkb3V0Iiwic3RkZXJyIiwiZXhlYyIsInNsaWNlIiwiY3dkIiwiZGlybmFtZSIsIndpbmRvd3NWZXJiYXRpbUFyZ3VtZW50cyIsInN5c3RlbSIsImlzV2luZG93cyIsIm5hbWUiLCJzdHJlYW0iLCJfIiwidHJpbSIsInNwbGl0IiwiZmlsdGVyIiwibGluZSIsImluY2x1ZGVzIiwic2lnbldpdGhEZWZhdWx0Q2VydCIsImFwayIsImZzIiwiZXhpc3RzIiwiRXJyb3IiLCJnZXRSZXNvdXJjZVBhdGgiLCJlIiwibWVzc2FnZSIsInNpZ25XaXRoQ3VzdG9tQ2VydCIsImtleXN0b3JlUGF0aCIsImtleUFsaWFzIiwia2V5c3RvcmVQYXNzd29yZCIsImtleVBhc3N3b3JkIiwiZXJyIiwid2FybiIsInVuc2lnbkFwayIsImphcnNpZ25lciIsInJlc29sdmUiLCJnZXRKYXZhSG9tZSIsInNpZ24iLCJhcHBQYXRoIiwiZW5kc1dpdGgiLCJBUEtTX0VYVEVOU0lPTiIsInVzZUtleXN0b3JlIiwiemlwQWxpZ25BcGsiLCJpbml0WmlwQWxpZ24iLCJiaW5hcmllcyIsInppcGFsaWduIiwiYWNjZXNzIiwiX2ZzIiwiV19PSyIsImFsaWduZWRBcGsiLCJ0ZW1wRGlyIiwicHJlZml4Iiwic3VmZml4IiwibWtkaXJwIiwibXYiLCJ1bmxpbmsiLCJjaGVja0Fwa0NlcnQiLCJwa2ciLCJvcHRzIiwiZXh0bmFtZSIsImV4dHJhY3RCYXNlQXBrIiwiaGFzaE1hdGNoZXMiLCJhcGtzaWduZXJPdXRwdXQiLCJleHBlY3RlZEhhc2hlcyIsInZhbHVlIiwidG9QYWlycyIsIlJlZ0V4cCIsInRlc3QiLCJiYXNlbmFtZSIsInJlcXVpcmVEZWZhdWx0Q2VydCIsImFwcEhhc2giLCJoYXNoIiwiaGFzIiwib3V0cHV0IiwiZXhwZWN0ZWQiLCJnZXQiLCJnZXRLZXlzdG9yZUhhc2giLCJoYXNNYXRjaCIsImluZm8iLCJpc1NpZ25lZCIsInNldCIsImVyck1zZyIsImtleXRvb2wiLCJyZXN1bHQiLCJoYXNoTmFtZSIsImhhc2hSZSIsIm1hdGNoIiwicmVwbGFjZSIsInRvTG93ZXJDYXNlIiwiaXNFbXB0eSIsIkpTT04iLCJzdHJpbmdpZnkiLCJfZGVmYXVsdCIsImV4cG9ydHMiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL3Rvb2xzL2Fway1zaWduaW5nLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgX2ZzIGZyb20gJ2ZzJztcbmltcG9ydCB7IGV4ZWMgfSBmcm9tICd0ZWVuX3Byb2Nlc3MnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgbG9nIGZyb20gJy4uL2xvZ2dlci5qcyc7XG5pbXBvcnQgeyB0ZW1wRGlyLCBzeXN0ZW0sIG1rZGlycCwgZnMsIHV0aWwgfSBmcm9tICdAYXBwaXVtL3N1cHBvcnQnO1xuaW1wb3J0IExSVSBmcm9tICdscnUtY2FjaGUnO1xuaW1wb3J0IHtcbiAgZ2V0SmF2YUZvck9zLCBnZXRBcGtzaWduZXJGb3JPcywgZ2V0SmF2YUhvbWUsIGdldFJlc291cmNlUGF0aCwgQVBLU19FWFRFTlNJT04sIHVuc2lnbkFwayxcbn0gZnJvbSAnLi4vaGVscGVycy5qcyc7XG5cbmNvbnN0IERFRkFVTFRfUFJJVkFURV9LRVkgPSBwYXRoLmpvaW4oJ2tleXMnLCAndGVzdGtleS5wazgnKTtcbmNvbnN0IERFRkFVTFRfQ0VSVElGSUNBVEUgPSBwYXRoLmpvaW4oJ2tleXMnLCAndGVzdGtleS54NTA5LnBlbScpO1xuY29uc3QgQlVORExFVE9PTF9UVVRPUklBTCA9ICdodHRwczovL2RldmVsb3Blci5hbmRyb2lkLmNvbS9zdHVkaW8vY29tbWFuZC1saW5lL2J1bmRsZXRvb2wnO1xuY29uc3QgQVBLU0lHTkVSX1ZFUklGWV9GQUlMID0gJ0RPRVMgTk9UIFZFUklGWSc7XG5jb25zdCBTSEExID0gJ3NoYTEnO1xuY29uc3QgU0hBMjU2ID0gJ3NoYTI1Nic7XG5jb25zdCBTSEE1MTIgPSAnc2hhNTEyJztcbmNvbnN0IE1ENSA9ICdtZDUnO1xuY29uc3QgREVGQVVMVF9DRVJUX0hBU0ggPSB7XG4gIFtTSEEyNTZdOiAnYTQwZGE4MGE1OWQxNzBjYWE5NTBjZjE1YzE4YzQ1NGQ0N2EzOWIyNjk4OWQ4YjY0MGVjZDc0NWJhNzFiZjVkYydcbn07XG5jb25zdCBKQVZBX1BST1BTX0lOSVRfRVJST1IgPSAnamF2YS5sYW5nLkVycm9yOiBQcm9wZXJ0aWVzIGluaXQnO1xuY29uc3QgU0lHTkVEX0FQUFNfQ0FDSEUgPSBuZXcgTFJVKHtcbiAgbWF4OiAzMCxcbn0pO1xuXG5cbmNvbnN0IGFwa1NpZ25pbmdNZXRob2RzID0ge307XG5cbi8qKlxuICogRXhlY3V0ZSBhcGtzaWduZXIgdXRpbGl0eSB3aXRoIGdpdmVuIGFyZ3VtZW50cy5cbiAqXG4gKiBAcGFyYW0gez9BcnJheTxTdHJpbmc+fSBhcmdzIC0gVGhlIGxpc3Qgb2YgdG9vbCBhcmd1bWVudHMuXG4gKiBAcmV0dXJuIHtzdHJpbmd9IC0gQ29tbWFuZCBzdGRvdXRcbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBhcGtzaWduZXIgYmluYXJ5IGlzIG5vdCBwcmVzZW50IG9uIHRoZSBsb2NhbCBmaWxlIHN5c3RlbVxuICogICAgICAgICAgICAgICAgIG9yIHRoZSByZXR1cm4gY29kZSBpcyBub3QgZXF1YWwgdG8gemVyby5cbiAqL1xuYXBrU2lnbmluZ01ldGhvZHMuZXhlY3V0ZUFwa3NpZ25lciA9IGFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVBcGtzaWduZXIgKGFyZ3MgPSBbXSkge1xuICBjb25zdCBhcGtTaWduZXJKYXIgPSBhd2FpdCBnZXRBcGtzaWduZXJGb3JPcyh0aGlzKTtcbiAgY29uc3QgZnVsbENtZCA9IFtcbiAgICBhd2FpdCBnZXRKYXZhRm9yT3MoKSwgJy1YbXgxMDI0TScsICctWHNzMW0nLFxuICAgICctamFyJywgYXBrU2lnbmVySmFyLFxuICAgIC4uLmFyZ3NcbiAgXTtcbiAgbG9nLmRlYnVnKGBTdGFydGluZyBhcGtzaWduZXI6ICR7dXRpbC5xdW90ZShmdWxsQ21kKX1gKTtcbiAgLy8gSXQgaXMgbmVjZXNzYXJ5IHRvIHNwZWNpZnkgQ1dEIGV4cGxpY2l0bHk7IHNlZSBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvMTQ3MjQjaXNzdWVjb21tZW50LTczNzQ0NjcxNVxuICBjb25zdCB7c3Rkb3V0LCBzdGRlcnJ9ID0gYXdhaXQgZXhlYyhmdWxsQ21kWzBdLCBmdWxsQ21kLnNsaWNlKDEpLCB7XG4gICAgY3dkOiBwYXRoLmRpcm5hbWUoYXBrU2lnbmVySmFyKSwgd2luZG93c1ZlcmJhdGltQXJndW1lbnRzOiBzeXN0ZW0uaXNXaW5kb3dzKClcbiAgfSk7XG4gIGZvciAobGV0IFtuYW1lLCBzdHJlYW1dIG9mIFtbJ3N0ZG91dCcsIHN0ZG91dF0sIFsnc3RkZXJyJywgc3RkZXJyXV0pIHtcbiAgICBpZiAoIV8udHJpbShzdHJlYW0pKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBpZiAobmFtZSA9PT0gJ3N0ZG91dCcpIHtcbiAgICAgIC8vIE1ha2UgdGhlIG91dHB1dCBsZXNzIHRhbGthdGl2ZVxuICAgICAgc3RyZWFtID0gc3RyZWFtLnNwbGl0KCdcXG4nKVxuICAgICAgICAuZmlsdGVyKChsaW5lKSA9PiAhbGluZS5pbmNsdWRlcygnV0FSTklORzonKSlcbiAgICAgICAgLmpvaW4oJ1xcbicpO1xuICAgIH1cbiAgICBsb2cuZGVidWcoYGFwa3NpZ25lciAke25hbWV9OiAke3N0cmVhbX1gKTtcbiAgfVxuICByZXR1cm4gc3Rkb3V0O1xufTtcblxuLyoqXG4gKiAoUmUpc2lnbiB0aGUgZ2l2ZW4gYXBrIGZpbGUgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIHdpdGggdGhlIGRlZmF1bHQgY2VydGlmaWNhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwayAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIGFwayBmaWxlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHNpZ25pbmcgZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLnNpZ25XaXRoRGVmYXVsdENlcnQgPSBhc3luYyBmdW5jdGlvbiBzaWduV2l0aERlZmF1bHRDZXJ0IChhcGspIHtcbiAgbG9nLmRlYnVnKGBTaWduaW5nICcke2Fwa30nIHdpdGggZGVmYXVsdCBjZXJ0YCk7XG4gIGlmICghKGF3YWl0IGZzLmV4aXN0cyhhcGspKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHthcGt9IGZpbGUgZG9lc24ndCBleGlzdC5gKTtcbiAgfVxuXG4gIGNvbnN0IGFyZ3MgPSBbXG4gICAgJ3NpZ24nLFxuICAgICctLWtleScsIGF3YWl0IGdldFJlc291cmNlUGF0aChERUZBVUxUX1BSSVZBVEVfS0VZKSxcbiAgICAnLS1jZXJ0JywgYXdhaXQgZ2V0UmVzb3VyY2VQYXRoKERFRkFVTFRfQ0VSVElGSUNBVEUpLFxuICAgIGFwayxcbiAgXTtcbiAgdHJ5IHtcbiAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBcGtzaWduZXIoYXJncyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYENvdWxkIG5vdCBzaWduICcke2Fwa30nIHdpdGggdGhlIGRlZmF1bHQgY2VydGlmaWNhdGUuIGAgK1xuICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2Uuc3RkZXJyIHx8IGUuc3Rkb3V0IHx8IGUubWVzc2FnZX1gKTtcbiAgfVxufTtcblxuLyoqXG4gKiAoUmUpc2lnbiB0aGUgZ2l2ZW4gYXBrIGZpbGUgb24gdGhlIGxvY2FsIGZpbGUgc3lzdGVtIHdpdGggYSBjdXN0b20gY2VydGlmaWNhdGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwayAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIGFwayBmaWxlLlxuICogQHRocm93cyB7RXJyb3J9IElmIHNpZ25pbmcgZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLnNpZ25XaXRoQ3VzdG9tQ2VydCA9IGFzeW5jIGZ1bmN0aW9uIHNpZ25XaXRoQ3VzdG9tQ2VydCAoYXBrKSB7XG4gIGxvZy5kZWJ1ZyhgU2lnbmluZyAnJHthcGt9JyB3aXRoIGN1c3RvbSBjZXJ0YCk7XG4gIGlmICghKGF3YWl0IGZzLmV4aXN0cyh0aGlzLmtleXN0b3JlUGF0aCkpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBLZXlzdG9yZTogJHt0aGlzLmtleXN0b3JlUGF0aH0gZG9lc24ndCBleGlzdC5gKTtcbiAgfVxuICBpZiAoIShhd2FpdCBmcy5leGlzdHMoYXBrKSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCcke2Fwa30nIGRvZXNuJ3QgZXhpc3QuYCk7XG4gIH1cblxuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuZXhlY3V0ZUFwa3NpZ25lcihbJ3NpZ24nLFxuICAgICAgJy0ta3MnLCB0aGlzLmtleXN0b3JlUGF0aCxcbiAgICAgICctLWtzLWtleS1hbGlhcycsIHRoaXMua2V5QWxpYXMsXG4gICAgICAnLS1rcy1wYXNzJywgYHBhc3M6JHt0aGlzLmtleXN0b3JlUGFzc3dvcmR9YCxcbiAgICAgICctLWtleS1wYXNzJywgYHBhc3M6JHt0aGlzLmtleVBhc3N3b3JkfWAsXG4gICAgICBhcGtdKTtcbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgbG9nLndhcm4oYENhbm5vdCB1c2UgYXBrc2lnbmVyIHRvb2wgZm9yIHNpZ25pbmcuIERlZmF1bHRpbmcgdG8gamFyc2lnbmVyLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlcnIuc3RkZXJyIHx8IGVyci5zdGRvdXQgfHwgZXJyLm1lc3NhZ2V9YCk7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChhd2FpdCB1bnNpZ25BcGsoYXBrKSkge1xuICAgICAgICBsb2cuZGVidWcoYCcke2Fwa30nIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSB1bnNpZ25lZGApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9nLmRlYnVnKGAnJHthcGt9JyBkb2VzIG5vdCBuZWVkIHRvIGJlIHVuc2lnbmVkYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBqYXJzaWduZXIgPSBwYXRoLnJlc29sdmUoYXdhaXQgZ2V0SmF2YUhvbWUoKSwgJ2JpbicsXG4gICAgICAgIGBqYXJzaWduZXIke3N5c3RlbS5pc1dpbmRvd3MoKSA/ICcuZXhlJyA6ICcnfWApO1xuICAgICAgY29uc3QgZnVsbENtZCA9IFtqYXJzaWduZXIsXG4gICAgICAgICctc2lnYWxnJywgJ01ENXdpdGhSU0EnLFxuICAgICAgICAnLWRpZ2VzdGFsZycsICdTSEExJyxcbiAgICAgICAgJy1rZXlzdG9yZScsIHRoaXMua2V5c3RvcmVQYXRoLFxuICAgICAgICAnLXN0b3JlcGFzcycsIHRoaXMua2V5c3RvcmVQYXNzd29yZCxcbiAgICAgICAgJy1rZXlwYXNzJywgdGhpcy5rZXlQYXNzd29yZCxcbiAgICAgICAgYXBrLCB0aGlzLmtleUFsaWFzXTtcbiAgICAgIGxvZy5kZWJ1ZyhgU3RhcnRpbmcgamFyc2lnbmVyOiAke3V0aWwucXVvdGUoZnVsbENtZCl9YCk7XG4gICAgICBhd2FpdCBleGVjKGZ1bGxDbWRbMF0sIGZ1bGxDbWQuc2xpY2UoMSksIHsgd2luZG93c1ZlcmJhdGltQXJndW1lbnRzOiBzeXN0ZW0uaXNXaW5kb3dzKCkgfSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb3VsZCBub3Qgc2lnbiB3aXRoIGN1c3RvbSBjZXJ0aWZpY2F0ZS4gYCArXG4gICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIChSZSlzaWduIHRoZSBnaXZlbiBhcGsgZmlsZSBvbiB0aGUgbG9jYWwgZmlsZSBzeXN0ZW0gd2l0aCBlaXRoZXJcbiAqIGN1c3RvbSBvciBkZWZhdWx0IGNlcnRpZmljYXRlIGJhc2VkIG9uIF90aGlzLnVzZUtleXN0b3JlXyBwcm9wZXJ0eSB2YWx1ZVxuICogYW5kIFppcC1hbGlnbnMgaXQgYWZ0ZXIgc2lnbmluZy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwUGF0aCAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIC5hcGsocykgZmlsZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBzaWduaW5nIGZhaWxzLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5zaWduID0gYXN5bmMgZnVuY3Rpb24gc2lnbiAoYXBwUGF0aCkge1xuICBpZiAoYXBwUGF0aC5lbmRzV2l0aChBUEtTX0VYVEVOU0lPTikpIHtcbiAgICBsZXQgbWVzc2FnZSA9ICdTaWduaW5nIG9mIC5hcGtzLWZpbGVzIGlzIG5vdCBzdXBwb3J0ZWQuICc7XG4gICAgaWYgKHRoaXMudXNlS2V5c3RvcmUpIHtcbiAgICAgIG1lc3NhZ2UgKz0gJ0NvbnNpZGVyIG1hbnVhbCBhcHBsaWNhdGlvbiBidW5kbGUgc2lnbmluZyB3aXRoIHRoZSBjdXN0b20ga2V5c3RvcmUgJyArXG4gICAgICAgIGBsaWtlIGl0IGlzIGRlc2NyaWJlZCBhdCAke0JVTkRMRVRPT0xfVFVUT1JJQUx9YDtcbiAgICB9IGVsc2Uge1xuICAgICAgbWVzc2FnZSArPSBgQ29uc2lkZXIgbWFudWFsIGFwcGxpY2F0aW9uIGJ1bmRsZSBzaWduaW5nIHdpdGggdGhlIGtleSBhdCAnJHtERUZBVUxUX1BSSVZBVEVfS0VZfScgYCArXG4gICAgICAgIGBhbmQgdGhlIGNlcnRpZmljYXRlIGF0ICcke0RFRkFVTFRfQ0VSVElGSUNBVEV9Jy4gUmVhZCAke0JVTkRMRVRPT0xfVFVUT1JJQUx9IGZvciBtb3JlIGRldGFpbHMuYDtcbiAgICB9XG4gICAgbG9nLndhcm4obWVzc2FnZSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gaXQgaXMgbmVjZXNzYXJ5IHRvIGFwcGx5IHppcGFsaWduIG9ubHkgYmVmb3JlIHNpZ25pbmdcbiAgLy8gaWYgYXBrc2lnbmVyIGlzIHVzZWRcbiAgYXdhaXQgdGhpcy56aXBBbGlnbkFwayhhcHBQYXRoKTtcblxuICBpZiAodGhpcy51c2VLZXlzdG9yZSkge1xuICAgIGF3YWl0IHRoaXMuc2lnbldpdGhDdXN0b21DZXJ0KGFwcFBhdGgpO1xuICB9IGVsc2Uge1xuICAgIGF3YWl0IHRoaXMuc2lnbldpdGhEZWZhdWx0Q2VydChhcHBQYXRoKTtcbiAgfVxufTtcblxuLyoqXG4gKiBQZXJmb3JtIHppcC1hbGlnbmluZyB0byB0aGUgZ2l2ZW4gbG9jYWwgYXBrIGZpbGUuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGFwayAtIFRoZSBmdWxsIHBhdGggdG8gdGhlIGxvY2FsIGFwayBmaWxlLlxuICogQHJldHVybnMge2Jvb2xlYW59IFRydWUgaWYgdGhlIGFwayBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgYWxpZ25lZFxuICogb3IgZmFsc2UgaWYgdGhlIGFwayBoYXMgYmVlbiBhbHJlYWR5IGFsaWduZWQuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgemlwLWFsaWduIGZhaWxzLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy56aXBBbGlnbkFwayA9IGFzeW5jIGZ1bmN0aW9uIHppcEFsaWduQXBrIChhcGspIHtcbiAgYXdhaXQgdGhpcy5pbml0WmlwQWxpZ24oKTtcbiAgdHJ5IHtcbiAgICBhd2FpdCBleGVjKHRoaXMuYmluYXJpZXMuemlwYWxpZ24sIFsnLWMnLCAnNCcsIGFwa10pO1xuICAgIGxvZy5kZWJ1ZyhgJHthcGt9JyBpcyBhbHJlYWR5IHppcC1hbGlnbmVkLiBEb2luZyBub3RoaW5nYCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgbG9nLmRlYnVnKGAnJHthcGt9JyBpcyBub3QgemlwLWFsaWduZWQuIEFsaWduaW5nYCk7XG4gIH1cbiAgdHJ5IHtcbiAgICBhd2FpdCBmcy5hY2Nlc3MoYXBrLCBfZnMuV19PSyk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSBmaWxlIGF0ICcke2Fwa30nIGlzIG5vdCB3cml0ZWFibGUuIGAgK1xuICAgICAgYFBsZWFzZSBncmFudCB3cml0ZSBwZXJtaXNzaW9ucyB0byB0aGlzIGZpbGUgb3IgdG8gaXRzIHBhcmVudCBmb2xkZXIgJyR7cGF0aC5kaXJuYW1lKGFwayl9JyBgICtcbiAgICAgIGBmb3IgdGhlIEFwcGl1bSBwcm9jZXNzLCBzbyBpdCBjYW4gemlwLWFsaWduIHRoZSBmaWxlYCk7XG4gIH1cbiAgY29uc3QgYWxpZ25lZEFwayA9IGF3YWl0IHRlbXBEaXIucGF0aCh7cHJlZml4OiAnYXBwaXVtJywgc3VmZml4OiAnLnRtcCd9KTtcbiAgYXdhaXQgbWtkaXJwKHBhdGguZGlybmFtZShhbGlnbmVkQXBrKSk7XG4gIHRyeSB7XG4gICAgYXdhaXQgZXhlYyh0aGlzLmJpbmFyaWVzLnppcGFsaWduLCBbJy1mJywgJzQnLCBhcGssIGFsaWduZWRBcGtdKTtcbiAgICBhd2FpdCBmcy5tdihhbGlnbmVkQXBrLCBhcGssIHsgbWtkaXJwOiB0cnVlIH0pO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlKSB7XG4gICAgaWYgKGF3YWl0IGZzLmV4aXN0cyhhbGlnbmVkQXBrKSkge1xuICAgICAgYXdhaXQgZnMudW5saW5rKGFsaWduZWRBcGspO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYHppcEFsaWduQXBrIGZhaWxlZC4gT3JpZ2luYWwgZXJyb3I6ICR7ZS5zdGRlcnIgfHwgZS5tZXNzYWdlfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IENlcnRDaGVja09wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gcmVxdWlyZURlZmF1bHRDZXJ0IFt0cnVlXSBXaGV0aGVyIHRvIHJlcXVpcmUgdGhhdCB0aGUgZGVzdGluYXRpb24gQVBLXG4gKiBpcyBzaWduZWQgd2l0aCB0aGUgZGVmYXVsdCBBcHBpdW0gY2VydGlmaWNhdGUgb3IgYW55IHZhbGlkIGNlcnRpZmljYXRlLiBUaGlzIG9wdGlvblxuICogb25seSBoYXMgZWZmZWN0IGlmIGB1c2VLZXlzdG9yZWAgcHJvcGVydHkgaXMgdW5zZXQuXG4gKi9cblxuLyoqXG4gKiBDaGVjayBpZiB0aGUgYXBwIGlzIGFscmVhZHkgc2lnbmVkIHdpdGggdGhlIGRlZmF1bHQgQXBwaXVtIGNlcnRpZmljYXRlLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBQYXRoIC0gVGhlIGZ1bGwgcGF0aCB0byB0aGUgbG9jYWwgLmFwayhzKSBmaWxlLlxuICogQHBhcmFtIHtzdHJpbmd9IHBnayAtIFRoZSBuYW1lIG9mIGFwcGxpY2F0aW9uIHBhY2thZ2UuXG4gKiBAcGFyYW0ge0NlcnRDaGVja09wdGlvbnN9IG9wdHMgLSBDZXJ0aWZpY2F0ZSBjaGVja2luZyBvcHRpb25zXG4gKiBAcmV0dXJuIHtib29sZWFufSBUcnVlIGlmIGdpdmVuIGFwcGxpY2F0aW9uIGlzIGFscmVhZHkgc2lnbmVkLlxuICovXG5hcGtTaWduaW5nTWV0aG9kcy5jaGVja0Fwa0NlcnQgPSBhc3luYyBmdW5jdGlvbiBjaGVja0Fwa0NlcnQgKGFwcFBhdGgsIHBrZywgb3B0cyA9IHt9KSB7XG4gIGxvZy5kZWJ1ZyhgQ2hlY2tpbmcgYXBwIGNlcnQgZm9yICR7YXBwUGF0aH1gKTtcbiAgaWYgKCFhd2FpdCBmcy5leGlzdHMoYXBwUGF0aCkpIHtcbiAgICBsb2cuZGVidWcoYCcke2FwcFBhdGh9JyBkb2VzIG5vdCBleGlzdGApO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChwYXRoLmV4dG5hbWUoYXBwUGF0aCkgPT09IEFQS1NfRVhURU5TSU9OKSB7XG4gICAgYXBwUGF0aCA9IGF3YWl0IHRoaXMuZXh0cmFjdEJhc2VBcGsoYXBwUGF0aCk7XG4gIH1cblxuICBjb25zdCBoYXNoTWF0Y2hlcyA9IChhcGtzaWduZXJPdXRwdXQsIGV4cGVjdGVkSGFzaGVzKSA9PiB7XG4gICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVdIG9mIF8udG9QYWlycyhleHBlY3RlZEhhc2hlcykpIHtcbiAgICAgIGlmIChuZXcgUmVnRXhwKGBkaWdlc3Q6XFxcXHMrJHt2YWx1ZX1cXFxcYmAsICdpJykudGVzdChhcGtzaWduZXJPdXRwdXQpKSB7XG4gICAgICAgIGxvZy5kZWJ1ZyhgJHtuYW1lfSBoYXNoIGRpZCBtYXRjaCBmb3IgJyR7cGF0aC5iYXNlbmFtZShhcHBQYXRoKX0nYCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgY29uc3Qge1xuICAgIHJlcXVpcmVEZWZhdWx0Q2VydCA9IHRydWUsXG4gIH0gPSBvcHRzO1xuXG4gIGNvbnN0IGFwcEhhc2ggPSBhd2FpdCBmcy5oYXNoKGFwcFBhdGgpO1xuICBpZiAoU0lHTkVEX0FQUFNfQ0FDSEUuaGFzKGFwcEhhc2gpKSB7XG4gICAgbG9nLmRlYnVnKGBVc2luZyB0aGUgcHJldmlvdXNseSBjYWNoZWQgc2lnbmF0dXJlIGVudHJ5IGZvciAnJHtwYXRoLmJhc2VuYW1lKGFwcFBhdGgpfSdgKTtcbiAgICBjb25zdCB7a2V5c3RvcmVQYXRoLCBvdXRwdXQsIGV4cGVjdGVkfSA9IFNJR05FRF9BUFBTX0NBQ0hFLmdldChhcHBIYXNoKTtcbiAgICBpZiAodGhpcy51c2VLZXlzdG9yZSAmJiB0aGlzLmtleXN0b3JlUGF0aCA9PT0ga2V5c3RvcmVQYXRoIHx8ICF0aGlzLnVzZUtleXN0b3JlKSB7XG4gICAgICByZXR1cm4gKCF0aGlzLnVzZUtleXN0b3JlICYmICFyZXF1aXJlRGVmYXVsdENlcnQpIHx8IGhhc2hNYXRjaGVzKG91dHB1dCwgZXhwZWN0ZWQpO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGV4cGVjdGVkID0gdGhpcy51c2VLZXlzdG9yZVxuICAgID8gYXdhaXQgdGhpcy5nZXRLZXlzdG9yZUhhc2goYXBwUGF0aCwgcGtnKVxuICAgIDogREVGQVVMVF9DRVJUX0hBU0g7XG4gIHRyeSB7XG4gICAgYXdhaXQgZ2V0QXBrc2lnbmVyRm9yT3ModGhpcyk7XG4gICAgY29uc3Qgb3V0cHV0ID0gYXdhaXQgdGhpcy5leGVjdXRlQXBrc2lnbmVyKFsndmVyaWZ5JywgJy0tcHJpbnQtY2VydHMnLCBhcHBQYXRoXSk7XG4gICAgY29uc3QgaGFzTWF0Y2ggPSBoYXNoTWF0Y2hlcyhvdXRwdXQsIGV4cGVjdGVkKTtcbiAgICBpZiAoaGFzTWF0Y2gpIHtcbiAgICAgIGxvZy5pbmZvKGAnJHthcHBQYXRofScgaXMgc2lnbmVkIHdpdGggdGhlIGAgK1xuICAgICAgICBgJHt0aGlzLnVzZUtleXN0b3JlID8gJ2tleXN0b3JlJyA6ICdkZWZhdWx0J30gY2VydGlmaWNhdGVgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9nLmluZm8oYCcke2FwcFBhdGh9JyBpcyBzaWduZWQgd2l0aCBhIGAgK1xuICAgICAgICBgbm9uLSR7dGhpcy51c2VLZXlzdG9yZSA/ICdrZXlzdG9yZScgOiAnZGVmYXVsdCd9IGNlcnRpZmljYXRlYCk7XG4gICAgfVxuICAgIGNvbnN0IGlzU2lnbmVkID0gKCF0aGlzLnVzZUtleXN0b3JlICYmICFyZXF1aXJlRGVmYXVsdENlcnQpIHx8IGhhc01hdGNoO1xuICAgIGlmIChpc1NpZ25lZCkge1xuICAgICAgU0lHTkVEX0FQUFNfQ0FDSEUuc2V0KGFwcEhhc2gsIHtcbiAgICAgICAgb3V0cHV0LFxuICAgICAgICBleHBlY3RlZCxcbiAgICAgICAga2V5c3RvcmVQYXRoOiB0aGlzLmtleXN0b3JlUGF0aCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gaXNTaWduZWQ7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIGNoZWNrIGlmIHRoZXJlIGlzIG5vIHNpZ25hdHVyZVxuICAgIGlmIChfLmluY2x1ZGVzKGVyci5zdGRlcnIsIEFQS1NJR05FUl9WRVJJRllfRkFJTCkpIHtcbiAgICAgIGxvZy5pbmZvKGAnJHthcHBQYXRofScgaXMgbm90IHNpZ25lZGApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBjb25zdCBlcnJNc2cgPSBlcnIuc3RkZXJyIHx8IGVyci5zdGRvdXQgfHwgZXJyLm1lc3NhZ2U7XG4gICAgaWYgKF8uaW5jbHVkZXMoZXJyTXNnLCBKQVZBX1BST1BTX0lOSVRfRVJST1IpKSB7XG4gICAgICAvLyBUaGlzIGVycm9yIHBvcHMgdXAgcmFuZG9tbHkgYW5kIHdlIGFyZSBub3QgcXVpdGUgc3VyZSB3aHkuXG4gICAgICAvLyBNeSBndWVzcyAtIGEgcmFjZSBjb25kaXRpb24gaW4gamF2YSB2bSBpbml0aWFsaXphdGlvbi5cbiAgICAgIC8vIE5ldmVydGhlbGVzcywgbGV0cyBtYWtlIEFwcGl1bSB0byBiZWxpZXZlIHRoZSBmaWxlIGlzIGFscmVhZHkgc2lnbmVkLFxuICAgICAgLy8gYmVjYXVzZSBpdCB3b3VsZCBiZSB0cnVlIGZvciA5OSUgb2YgVUlBdXRvbWF0b3IyLWJhc2VkXG4gICAgICAvLyB0ZXN0cywgd2hlcmUgd2UgcHJlc2lnbiBzZXJ2ZXIgYmluYXJpZXMgd2hpbGUgcHVibGlzaGluZyB0aGVpciBOUE0gbW9kdWxlLlxuICAgICAgLy8gSWYgdGhlc2UgYXJlIG5vdCBzaWduZWQsIGUuZy4gaW4gY2FzZSBvZiBFc3ByZXNzbywgdGhlbiB0aGUgbmV4dCBzdGVwKHMpXG4gICAgICAvLyB3b3VsZCBhbnl3YXkgZmFpbC5cbiAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvMTQ3MjQgZm9yIG1vcmUgZGV0YWlscy5cbiAgICAgIGxvZy53YXJuKGVyck1zZyk7XG4gICAgICBsb2cud2FybihgQXNzdW1pbmcgJyR7YXBwUGF0aH0nIGlzIGFscmVhZHkgc2lnbmVkIGFuZCBjb250aW51aW5nIGFueXdheWApO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IHZlcmlmeSB0aGUgc2lnbmF0dXJlIG9mICcke2FwcFBhdGh9Jy4gYCArXG4gICAgICBgT3JpZ2luYWwgZXJyb3I6ICR7ZXJyTXNnfWApO1xuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IEtleXN0b3JlSGFzaFxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBtZDUgdGhlIG1kNSBoYXNoIHZhbHVlIG9mIHRoZSBrZXlzdG9yZVxuICogQHByb3BlcnR5IHs/c3RyaW5nfSBzaGExIHRoZSBzaGExIGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHNoYTI1NiB0aGUgc2hhMjU2IGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKiBAcHJvcGVydHkgez9zdHJpbmd9IHNoYTUxMiB0aGUgc2hhNTEyIGhhc2ggdmFsdWUgb2YgdGhlIGtleXN0b3JlXG4gKi9cblxuLyoqXG4gKiBSZXRyaWV2ZSB0aGUgdGhlIGhhc2ggb2YgdGhlIGdpdmVuIGtleXN0b3JlLlxuICpcbiAqIEByZXR1cm4ge0tleXN0b3JlSGFzaH1cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiBnZXR0aW5nIGtleXN0b3JlIGhhc2ggZmFpbHMuXG4gKi9cbmFwa1NpZ25pbmdNZXRob2RzLmdldEtleXN0b3JlSGFzaCA9IGFzeW5jIGZ1bmN0aW9uIGdldEtleXN0b3JlSGFzaCAoKSB7XG4gIGxvZy5kZWJ1ZyhgR2V0dGluZyBoYXNoIG9mIHRoZSAnJHt0aGlzLmtleXN0b3JlUGF0aH0nIGtleXN0b3JlYCk7XG4gIGNvbnN0IGtleXRvb2wgPSBwYXRoLnJlc29sdmUoYXdhaXQgZ2V0SmF2YUhvbWUoKSwgJ2JpbicsXG4gICAgYGtleXRvb2wke3N5c3RlbS5pc1dpbmRvd3MoKSA/ICcuZXhlJyA6ICcnfWApO1xuICBpZiAoIWF3YWl0IGZzLmV4aXN0cyhrZXl0b29sKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgVGhlIGtleXRvb2wgdXRpbGl0eSBjYW5ub3QgYmUgZm91bmQgYXQgJyR7a2V5dG9vbH0nYCk7XG4gIH1cbiAgY29uc3QgYXJncyA9IFtcbiAgICAnLXYnLCAnLWxpc3QnLFxuICAgICctYWxpYXMnLCB0aGlzLmtleUFsaWFzLFxuICAgICcta2V5c3RvcmUnLCB0aGlzLmtleXN0b3JlUGF0aCxcbiAgICAnLXN0b3JlcGFzcycsIHRoaXMua2V5c3RvcmVQYXNzd29yZFxuICBdO1xuICBsb2cuaW5mbyhgUnVubmluZyAnJHtrZXl0b29sfScgd2l0aCBhcmd1bWVudHM6ICR7dXRpbC5xdW90ZShhcmdzKX1gKTtcbiAgdHJ5IHtcbiAgICBjb25zdCB7c3Rkb3V0fSA9IGF3YWl0IGV4ZWMoa2V5dG9vbCwgYXJncywgeyB3aW5kb3dzVmVyYmF0aW1Bcmd1bWVudHM6IHN5c3RlbS5pc1dpbmRvd3MoKSB9KTtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGhhc2hOYW1lIG9mIFtTSEE1MTIsIFNIQTI1NiwgU0hBMSwgTUQ1XSkge1xuICAgICAgY29uc3QgaGFzaFJlID0gbmV3IFJlZ0V4cChgXlxcXFxzKiR7aGFzaE5hbWV9OlxcXFxzKihbYS1mMC05Ol0rKWAsICdtaScpO1xuICAgICAgY29uc3QgbWF0Y2ggPSBoYXNoUmUuZXhlYyhzdGRvdXQpO1xuICAgICAgaWYgKCFtYXRjaCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHJlc3VsdFtoYXNoTmFtZV0gPSBtYXRjaFsxXS5yZXBsYWNlKC86L2csICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgIH1cbiAgICBpZiAoXy5pc0VtcHR5KHJlc3VsdCkpIHtcbiAgICAgIGxvZy5kZWJ1ZyhzdGRvdXQpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgcGFyc2UgdGhlIGhhc2ggdmFsdWUgZnJvbSB0aGUga2V5dG9vbCBvdXRwdXQnKTtcbiAgICB9XG4gICAgbG9nLmRlYnVnKGBLZXlzdG9yZSBoYXNoOiAke0pTT04uc3RyaW5naWZ5KHJlc3VsdCl9YCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfSBjYXRjaCAoZSkge1xuICAgIHRocm93IG5ldyBFcnJvcihgQ2Fubm90IGdldCB0aGUgaGFzaCBvZiAnJHt0aGlzLmtleXN0b3JlUGF0aH0nIGtleXN0b3JlLiBgICtcbiAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn07XG5cbmV4cG9ydCBkZWZhdWx0IGFwa1NpZ25pbmdNZXRob2RzO1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFBLElBQUFBLE9BQUEsR0FBQUMsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLElBQUEsR0FBQUYsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFFLGFBQUEsR0FBQUYsT0FBQTtBQUNBLElBQUFHLEtBQUEsR0FBQUosc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFJLE9BQUEsR0FBQUwsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFLLFFBQUEsR0FBQUwsT0FBQTtBQUNBLElBQUFNLFNBQUEsR0FBQVAsc0JBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFPLFFBQUEsR0FBQVAsT0FBQTtBQUlBLE1BQU1RLG1CQUFtQixHQUFHQyxhQUFJLENBQUNDLElBQUksQ0FBQyxNQUFNLEVBQUUsYUFBYSxDQUFDO0FBQzVELE1BQU1DLG1CQUFtQixHQUFHRixhQUFJLENBQUNDLElBQUksQ0FBQyxNQUFNLEVBQUUsa0JBQWtCLENBQUM7QUFDakUsTUFBTUUsbUJBQW1CLEdBQUcsOERB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