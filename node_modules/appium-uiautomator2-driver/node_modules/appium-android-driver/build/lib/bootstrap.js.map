{"version":3,"file":"bootstrap.js","names":["_uiautomator","_interopRequireDefault","require","_net","_path","_lodash","_driver","_bluebird","_support","log","logger","getLogger","COMMAND_TYPES","ACTION","SHUTDOWN","exports","SEND_COMMAND_TIMEOUT","getModuleRoot","_","memoize","currentDir","path","dirname","resolve","__filename","isAtFsRoot","manifestPath","join","fs","exists","JSON","parse","readFile","name","ign","length","Error","AndroidBootstrap","constructor","adb","systemPort","webSocket","undefined","ignoreUnexpectedShutdown","onUnexpectedShutdown","_onUnexpectedShutdownPromise","reject","B","_resolve","_reject","cancel","start","appPackage","disableAndroidWatchers","acceptSslCerts","startDetector","s","test","bootstrapJar","init","forwardPort","process","uiAutomator","on","stdout","stderr","alertRe","debug","sockets","emit","message","stdoutLines","split","uiautoLog","line","trim","innerLine","exec","logMethod","info","bind","stderrLines","socketClient","net","connect","err","once","errorAndThrow","sendCommand","type","extra","cmd","Object","assign","cmdJson","stringify","truncate","write","setEncoding","streamData","sendCommandTimeoutHandler","data","clearTimeout","removeAllListeners","status","value","errorFromCode","isString","error","stack","setTimeout","errMsg","sendAction","action","params","shutdown","warn","UiAutomator","EVENT_CHANGED","msg","state","STATE_STOPPED","ignore","_ignoreUnexpectedShutdown","_default","default"],"sources":["../../lib/bootstrap.js"],"sourcesContent":["import UiAutomator from './uiautomator';\nimport net from 'net';\nimport path from 'path';\nimport _ from 'lodash';\nimport { errorFromCode } from 'appium/driver';\nimport B from 'bluebird';\nimport { logger, fs } from '@appium/support';\n\n\nconst log = logger.getLogger('AndroidBootstrap');\nconst COMMAND_TYPES = {\n  ACTION: 'action',\n  SHUTDOWN: 'shutdown'\n};\nconst SEND_COMMAND_TIMEOUT = 1 * 60 * 1000;\n\n/**\n * Calculates the path to the current module's root folder\n *\n * @returns {string} The full path to module root\n * @throws {Error} If the current module root folder cannot be determined\n */\nconst getModuleRoot = _.memoize(async function getModuleRoot () {\n  let currentDir = path.dirname(path.resolve(__filename));\n  let isAtFsRoot = false;\n  while (!isAtFsRoot) {\n    const manifestPath = path.join(currentDir, 'package.json');\n    try {\n      if (await fs.exists(manifestPath) &&\n          JSON.parse(await fs.readFile(manifestPath, 'utf8')).name === 'appium-android-driver') {\n        return currentDir;\n      }\n    } catch (ign) {}\n    currentDir = path.dirname(currentDir);\n    isAtFsRoot = currentDir.length <= path.dirname(currentDir).length;\n  }\n  throw new Error('Cannot find the root folder of the appium-android-driver Node.js module');\n});\n\nclass AndroidBootstrap {\n  constructor (adb, systemPort = 4724, webSocket = undefined) {\n    this.adb = adb;\n    this.systemPort = systemPort;\n    this.webSocket = webSocket;\n    this.ignoreUnexpectedShutdown = false;\n  }\n\n  get onUnexpectedShutdown () {\n    if (!this._onUnexpectedShutdownPromise) {\n      let reject;\n      this._onUnexpectedShutdownPromise = new B(function _onUnexpectedShutdownPromise (_resolve, _reject) {\n        reject = _reject;\n      });\n      this._onUnexpectedShutdownPromise.cancel = reject;\n    }\n    return this._onUnexpectedShutdownPromise;\n  }\n\n  async start (appPackage, disableAndroidWatchers = false, acceptSslCerts = false) {\n    try {\n      const startDetector = (s) => /Appium Socket Server Ready/.test(s);\n      const bootstrapJar = path.resolve(await getModuleRoot(), 'bootstrap', 'bin', 'AppiumBootstrap.jar');\n\n      await this.init();\n      await this.adb.forwardPort(this.systemPort, 4724);\n      this.process = await this.uiAutomator.start(\n        bootstrapJar, 'io.appium.android.bootstrap.Bootstrap',\n        startDetector,\n        '-e', 'pkg', appPackage,\n        '-e', 'disableAndroidWatchers', disableAndroidWatchers,\n        '-e', 'acceptSslCerts', acceptSslCerts\n      );\n\n      // process the output\n      this.process.on('output', (stdout, stderr) => {\n        const alertRe = /Emitting system alert message/;\n        if (alertRe.test(stdout)) {\n          log.debug('Emitting alert message...');\n          if (this.webSocket) {\n            this.webSocket.sockets.emit('alert', {message: stdout});\n          }\n        }\n\n        // the bootstrap logger wraps its own log lines with\n        // [APPIUM-UIAUTO] ... [APPIUM-UIAUTO]\n        // and leaves actual UiAutomator logs as they are\n        let stdoutLines = (stdout || '').split('\\n');\n        const uiautoLog = /\\[APPIUM-UIAUTO\\](.+)\\[\\/APPIUM-UIAUTO\\]/;\n        for (let line of stdoutLines) {\n          if (line.trim()) {\n            if (uiautoLog.test(line)) {\n              let innerLine = uiautoLog.exec(line)[1].trim();\n              let logMethod = log.info.bind(log);\n              // if the bootstrap log considers something debug, log that as\n              // debug and not info\n              if (/\\[debug\\]/.test(innerLine)) {\n                logMethod = log.debug.bind(log);\n              }\n              logMethod(`[BOOTSTRAP LOG] ${innerLine}`);\n            } else {\n              log.debug(`[UIAUTO STDOUT] ${line}`);\n            }\n          }\n        }\n\n        let stderrLines = (stderr || '').split('\\n');\n        for (let line of stderrLines) {\n          if (line.trim()) {\n            log.debug(`[UIAUTO STDERR] ${line}`);\n          }\n        }\n      });\n\n      // only return when the socket client has connected\n      return await new B((resolve, reject) => {\n        try {\n          this.socketClient = net.connect(this.systemPort, '127.0.0.1');\n          // Windows: the socket errors out when ADB restarts. Let's catch it to avoid crashing.\n          this.socketClient.on('error', (err) => {\n            if (!this.ignoreUnexpectedShutdown) {\n              throw new Error(`Android bootstrap socket crashed: ${err}`);\n            }\n          });\n          this.socketClient.once('connect', () => {\n            log.info('Android bootstrap socket is now connected');\n            resolve();\n          });\n        } catch (err) {\n          reject(err);\n        }\n      });\n    } catch (err) {\n      log.errorAndThrow(`Error occured while starting AndroidBootstrap. Original error: ${err}`);\n    }\n  }\n\n  async sendCommand (type, extra = {}) {\n    if (!this.socketClient) {\n      throw new Error('Socket connection closed unexpectedly');\n    }\n\n    return await new B((resolve, reject) => {\n      let cmd = Object.assign({cmd: type}, extra);\n      let cmdJson = `${JSON.stringify(cmd)} \\n`;\n      log.debug(`Sending command to android: ${_.truncate(cmdJson, {length: 1000}).trim()}`);\n      this.socketClient.write(cmdJson);\n      this.socketClient.setEncoding('utf8');\n      let streamData = '';\n      let sendCommandTimeoutHandler = null;\n      this.socketClient.on('data', (data) => {\n        if (sendCommandTimeoutHandler) {\n          clearTimeout(sendCommandTimeoutHandler);\n        }\n        log.debug('Received command result from bootstrap');\n        try {\n          streamData = JSON.parse(streamData + data);\n          // we successfully parsed JSON so we've got all the data,\n          // remove the socket listener and evaluate\n          this.socketClient.removeAllListeners('data');\n          if (streamData.status === 0) {\n            return resolve(streamData.value);\n          }\n          reject(errorFromCode(streamData.status, streamData.value));\n        } catch (err) {\n          if (!_.isString(streamData)) {\n            log.error('Got an unexpected error inside socket listener');\n            log.error(err.stack);\n            return reject(errorFromCode(13, err.message));\n          }\n          log.debug(`Stream still not complete, waiting up to ${SEND_COMMAND_TIMEOUT}ms for the data to arrive`);\n          streamData += data;\n          sendCommandTimeoutHandler = setTimeout(() => {\n            const errMsg = `Server socket stopped responding. The recent response was '${streamData}'`;\n            log.error(errMsg);\n            this.socketClient.removeAllListeners('data');\n            reject(errorFromCode(13, errMsg));\n          }, SEND_COMMAND_TIMEOUT);\n        }\n      });\n    });\n  }\n\n  async sendAction (action, params = {}) {\n    let extra = {action, params};\n    return await this.sendCommand(COMMAND_TYPES.ACTION, extra);\n  }\n\n  async shutdown () {\n    if (!this.uiAutomator) {\n      log.warn('Cannot shut down Android bootstrap; it has already shut down');\n      return;\n    }\n\n    // remove listners so we don't trigger unexpected shutdown\n    this.uiAutomator.removeAllListeners(UiAutomator.EVENT_CHANGED);\n    if (this.socketClient) {\n      await this.sendCommand(COMMAND_TYPES.SHUTDOWN);\n    }\n    await this.uiAutomator.shutdown();\n    this.uiAutomator = null;\n  }\n\n  // this helper function makes unit testing easier.\n  async init () { // eslint-disable-line require-await\n    this.uiAutomator = new UiAutomator(this.adb);\n\n    // Handle unexpected UiAutomator shutdown\n    this.uiAutomator.on(UiAutomator.EVENT_CHANGED, (msg) => {\n      if (msg.state === UiAutomator.STATE_STOPPED) {\n        this.uiAutomator = null;\n        this.onUnexpectedShutdown.cancel(new Error('UiAUtomator shut down unexpectedly'));\n      }\n    });\n  }\n\n  set ignoreUnexpectedShutdown (ignore) {\n    log.debug(`${ignore ? 'Ignoring' : 'Watching for'} bootstrap disconnect`);\n    this._ignoreUnexpectedShutdown = ignore;\n  }\n\n  get ignoreUnexpectedShutdown () {\n    return this._ignoreUnexpectedShutdown;\n  }\n}\n\nexport { AndroidBootstrap, COMMAND_TYPES };\nexport default AndroidBootstrap;\n"],"mappings":"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"}