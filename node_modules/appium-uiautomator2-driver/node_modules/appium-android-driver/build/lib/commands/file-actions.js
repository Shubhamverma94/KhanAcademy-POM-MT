"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.commands = void 0;
require("source-map-support/register");
var _lodash = _interopRequireDefault(require("lodash"));
var _support = require("@appium/support");
var _path = _interopRequireDefault(require("path"));
var _driver = require("appium/driver");
var _utils = require("../utils");
const CONTAINER_PATH_MARKER = '@';
const CONTAINER_PATH_PATTERN = new RegExp(`^${CONTAINER_PATH_MARKER}([^/]+)/(.+)`);
const ANDROID_MEDIA_RESCAN_INTENT = 'android.intent.action.MEDIA_SCANNER_SCAN_FILE';
const commands = {};
exports.commands = commands;
function parseContainerPath(remotePath) {
  const match = CONTAINER_PATH_PATTERN.exec(remotePath);
  if (!match) {
    throw new Error(`It is expected that package identifier is separated from the relative path with a single slash. ` + `'${remotePath}' is given instead`);
  }
  return [match[1], _path.default.posix.resolve(`/data/data/${match[1]}`, match[2])];
}
async function scanMedia(adb, remotePath, log = null) {
  log === null || log === void 0 ? void 0 : log.debug(`Performing media scan of '${remotePath}'`);
  try {
    if ((await adb.getApiLevel()) >= 29) {
      await adb.scanMedia(remotePath);
    } else {
      await adb.shell(['am', 'broadcast', '-a', ANDROID_MEDIA_RESCAN_INTENT, '-d', `file://${remotePath}`]);
    }
  } catch (e) {
    log === null || log === void 0 ? void 0 : log.warn(`Ignoring an unexpected error upon media scanning of '${remotePath}': ${e.stderr || e.message}`);
  }
}
function escapePath(p) {
  return p.replace(/'/g, `\\'`);
}
commands.pullFile = async function pullFile(remotePath) {
  if (remotePath.endsWith('/')) {
    throw new _driver.errors.InvalidArgumentError(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }
  let tmpDestination = null;
  if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
    const [packageId, pathInContainer] = parseContainerPath(remotePath);
    this.log.debug(`Parsed package identifier '${packageId}' from '${remotePath}'. Will get the data from '${pathInContainer}'`);
    tmpDestination = `/data/local/tmp/${_path.default.posix.basename(pathInContainer)}`;
    try {
      await this.adb.shell(['run-as', packageId, `chmod 777 '${escapePath(pathInContainer)}'`]);
      await this.adb.shell(['run-as', packageId, `cp -f '${escapePath(pathInContainer)}' '${escapePath(tmpDestination)}'`]);
    } catch (e) {
      this.log.errorAndThrow(`Cannot access the container of '${packageId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
    }
  }
  const localFile = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.tmp'
  });
  try {
    await this.adb.pull(tmpDestination || remotePath, localFile);
    return (await _support.util.toInMemoryBase64(localFile)).toString();
  } finally {
    if (await _support.fs.exists(localFile)) {
      await _support.fs.unlink(localFile);
    }
    if (tmpDestination) {
      await this.adb.shell(['rm', '-f', tmpDestination]);
    }
  }
};
commands.mobilePullFile = async function mobilePullFile(opts = {}) {
  const {
    remotePath
  } = (0, _utils.requireArgs)('remotePath', opts);
  return await this.pullFile(remotePath);
};
commands.pushFile = async function pushFile(remotePath, base64Data) {
  if (remotePath.endsWith('/')) {
    throw new _driver.errors.InvalidArgumentError(`It is expected that remote path points to a file and not to a folder. ` + `'${remotePath}' is given instead`);
  }
  const localFile = await _support.tempDir.path({
    prefix: 'appium',
    suffix: '.tmp'
  });
  if (_lodash.default.isArray(base64Data)) {
    base64Data = Buffer.from(base64Data).toString('utf8');
  }
  const content = Buffer.from(base64Data, 'base64');
  let tmpDestination = null;
  try {
    await _support.fs.writeFile(localFile, content.toString('binary'), 'binary');
    if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
      const [packageId, pathInContainer] = parseContainerPath(remotePath);
      this.log.debug(`Parsed package identifier '${packageId}' from '${remotePath}'. ` + `Will put the data into '${pathInContainer}'`);
      tmpDestination = `/data/local/tmp/${_path.default.posix.basename(pathInContainer)}`;
      try {
        await this.adb.shell(['run-as', packageId, `mkdir -p '${escapePath(_path.default.posix.dirname(pathInContainer))}'`]);
        await this.adb.shell(['run-as', packageId, `touch '${escapePath(pathInContainer)}'`]);
        await this.adb.shell(['run-as', packageId, `chmod 777 '${escapePath(pathInContainer)}'`]);
        await this.adb.push(localFile, tmpDestination);
        await this.adb.shell(['run-as', packageId, `cp -f '${escapePath(tmpDestination)}' '${escapePath(pathInContainer)}'`]);
      } catch (e) {
        this.log.errorAndThrow(`Cannot access the container of '${packageId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
      }
    } else {
      await this.adb.push(localFile, remotePath);
      await scanMedia(this.adb, remotePath, this.log);
    }
  } finally {
    if (await _support.fs.exists(localFile)) {
      await _support.fs.unlink(localFile);
    }
    if (tmpDestination) {
      await this.adb.shell(['rm', '-f', tmpDestination]);
    }
  }
};
commands.mobilePushFile = async function mobilePushFile(opts = {}) {
  const {
    remotePath,
    payload
  } = (0, _utils.requireArgs)(['remotePath', 'payload'], opts);
  return await this.pushFile(remotePath, payload);
};
commands.pullFolder = async function pullFolder(remotePath) {
  const tmpRoot = await _support.tempDir.openDir();
  try {
    await this.adb.pull(remotePath, tmpRoot);
    return (await _support.zip.toInMemoryZip(tmpRoot, {
      encodeToBase64: true
    })).toString();
  } finally {
    await _support.fs.rimraf(tmpRoot);
  }
};
commands.mobilePullFolder = async function mobilePullFolder(opts = {}) {
  const {
    remotePath
  } = (0, _utils.requireArgs)('remotePath', opts);
  return await this.pullFolder(remotePath);
};
async function deleteFileOrFolder(adb, remotePath) {
  const performRemoteFsCheck = async (p, op, runAs = null) => {
    const passFlag = '__PASS__';
    const checkCmd = `[ -${op} '${escapePath(p)}' ] && echo ${passFlag}`;
    const fullCmd = runAs ? `run-as ${runAs} ${checkCmd}` : checkCmd;
    try {
      return _lodash.default.includes(await adb.shell([fullCmd]), passFlag);
    } catch (ign) {
      return false;
    }
  };
  const isFile = async (p, runAs = null) => await performRemoteFsCheck(p, 'f', runAs);
  const isDir = async (p, runAs = null) => await performRemoteFsCheck(p, 'd', runAs);
  const isPresent = async (p, runAs = null) => await performRemoteFsCheck(p, 'e', runAs);
  let dstPath = remotePath;
  let pkgId = null;
  if (remotePath.startsWith(CONTAINER_PATH_MARKER)) {
    const [packageId, pathInContainer] = parseContainerPath(remotePath);
    this.log.debug(`Parsed package identifier '${packageId}' from '${remotePath}'`);
    dstPath = pathInContainer;
    pkgId = packageId;
  }
  if (pkgId) {
    try {
      await adb.shell(['run-as', pkgId, 'ls']);
    } catch (e) {
      this.log.errorAndThrow(`Cannot access the container of '${pkgId}' application. ` + `Is the application installed and has 'debuggable' build option set to true? ` + `Original error: ${e.message}`);
    }
  }
  if (!(await isPresent(dstPath, pkgId))) {
    this.log.info(`The item at '${dstPath}' does not exist. Perhaps, already deleted?`);
    return false;
  }
  const expectsFile = !remotePath.endsWith('/');
  if (expectsFile && !(await isFile(dstPath, pkgId))) {
    this.log.errorAndThrow(`The item at '${dstPath}' is not a file`);
  } else if (!expectsFile && !(await isDir(dstPath, pkgId))) {
    this.log.errorAndThrow(`The item at '${dstPath}' is not a folder`);
  }
  if (pkgId) {
    await adb.shell(['run-as', pkgId, `rm -f${expectsFile ? '' : 'r'} '${escapePath(dstPath)}'`]);
  } else {
    await adb.shell(['rm', `-f${expectsFile ? '' : 'r'}`, dstPath]);
  }
  if (await isPresent(dstPath, pkgId)) {
    this.log.errorAndThrow(`The item at '${dstPath}' still exists after being deleted. ` + `Is it writable?`);
  }
  return true;
}
commands.mobileDeleteFile = async function mobileDeleteFile(opts = {}) {
  const {
    remotePath
  } = opts;
  if (!remotePath) {
    throw new _driver.errors.InvalidArgumentError(`The 'remotePath' argument is mandatory`);
  }
  if (remotePath.endsWith('/')) {
    throw new _driver.errors.InvalidArgumentError(`It is expected that remote path points to a folder and not to a file. ` + `'${remotePath}' is given instead`);
  }
  return await deleteFileOrFolder(this.adb, remotePath);
};
var _default = commands;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbG9kYXNoIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfc3VwcG9ydCIsIl9wYXRoIiwiX2RyaXZlciIsIl91dGlscyIsIkNPTlRBSU5FUl9QQVRIX01BUktFUiIsIkNPTlRBSU5FUl9QQVRIX1BBVFRFUk4iLCJSZWdFeHAiLCJBTkRST0lEX01FRElBX1JFU0NBTl9JTlRFTlQiLCJjb21tYW5kcyIsImV4cG9ydHMiLCJwYXJzZUNvbnRhaW5lclBhdGgiLCJyZW1vdGVQYXRoIiwibWF0Y2giLCJleGVjIiwiRXJyb3IiLCJwYXRoIiwicG9zaXgiLCJyZXNvbHZlIiwic2Nhbk1lZGlhIiwiYWRiIiwibG9nIiwiZGVidWciLCJnZXRBcGlMZXZlbCIsInNoZWxsIiwiZSIsIndhcm4iLCJzdGRlcnIiLCJtZXNzYWdlIiwiZXNjYXBlUGF0aCIsInAiLCJyZXBsYWNlIiwicHVsbEZpbGUiLCJlbmRzV2l0aCIsImVycm9ycyIsIkludmFsaWRBcmd1bWVudEVycm9yIiwidG1wRGVzdGluYXRpb24iLCJzdGFydHNXaXRoIiwicGFja2FnZUlkIiwicGF0aEluQ29udGFpbmVyIiwiYmFzZW5hbWUiLCJlcnJvckFuZFRocm93IiwibG9jYWxGaWxlIiwidGVtcERpciIsInByZWZpeCIsInN1ZmZpeCIsInB1bGwiLCJ1dGlsIiwidG9Jbk1lbW9yeUJhc2U2NCIsInRvU3RyaW5nIiwiZnMiLCJleGlzdHMiLCJ1bmxpbmsiLCJtb2JpbGVQdWxsRmlsZSIsIm9wdHMiLCJyZXF1aXJlQXJncyIsInB1c2hGaWxlIiwiYmFzZTY0RGF0YSIsIl8iLCJpc0FycmF5IiwiQnVmZmVyIiwiZnJvbSIsImNvbnRlbnQiLCJ3cml0ZUZpbGUiLCJkaXJuYW1lIiwicHVzaCIsIm1vYmlsZVB1c2hGaWxlIiwicGF5bG9hZCIsInB1bGxGb2xkZXIiLCJ0bXBSb290Iiwib3BlbkRpciIsInppcCIsInRvSW5NZW1vcnlaaXAiLCJlbmNvZGVUb0Jhc2U2NCIsInJpbXJhZiIsIm1vYmlsZVB1bGxGb2xkZXIiLCJkZWxldGVGaWxlT3JGb2xkZXIiLCJwZXJmb3JtUmVtb3RlRnNDaGVjayIsIm9wIiwicnVuQXMiLCJwYXNzRmxhZyIsImNoZWNrQ21kIiwiZnVsbENtZCIsImluY2x1ZGVzIiwiaWduIiwiaXNGaWxlIiwiaXNEaXIiLCJpc1ByZXNlbnQiLCJkc3RQYXRoIiwicGtnSWQiLCJpbmZvIiwiZXhwZWN0c0ZpbGUiLCJtb2JpbGVEZWxldGVGaWxlIiwiX2RlZmF1bHQiLCJkZWZhdWx0Il0sInNvdXJjZXMiOlsiLi4vLi4vLi4vbGliL2NvbW1hbmRzL2ZpbGUtYWN0aW9ucy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgZnMsIHV0aWwsIHppcCwgdGVtcERpciB9IGZyb20gJ0BhcHBpdW0vc3VwcG9ydCc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IGVycm9ycyB9IGZyb20gJ2FwcGl1bS9kcml2ZXInO1xuaW1wb3J0IHsgcmVxdWlyZUFyZ3MgfSBmcm9tICcuLi91dGlscyc7XG5cblxuY29uc3QgQ09OVEFJTkVSX1BBVEhfTUFSS0VSID0gJ0AnO1xuLy8gaHR0cHM6Ly9yZWdleDEwMS5jb20vci9QTGRCMEcvMlxuY29uc3QgQ09OVEFJTkVSX1BBVEhfUEFUVEVSTiA9IG5ldyBSZWdFeHAoYF4ke0NPTlRBSU5FUl9QQVRIX01BUktFUn0oW14vXSspLyguKylgKTtcbmNvbnN0IEFORFJPSURfTUVESUFfUkVTQ0FOX0lOVEVOVCA9ICdhbmRyb2lkLmludGVudC5hY3Rpb24uTUVESUFfU0NBTk5FUl9TQ0FOX0ZJTEUnO1xuXG5cbmNvbnN0IGNvbW1hbmRzID0ge307XG5cbi8qKlxuICogUGFyc2VzIHRoZSBhY3R1YWwgZGVzdGluYXRpb24gcGF0aCBmcm9tIHRoZSBnaXZlbiB2YWx1ZVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSByZW1vdGVQYXRoIFRoZSBwcmVmb3JtYXR0ZWQgcmVtb3RlIHBhdGgsIHdoaWNoIGxvb2tzIGxpa2VcbiAqIGBAbXkuYXBwLmlkL215L3BhdGhgXG4gKiBAcmV0dXJucyB7QXJyYXk8c3RyaW5nPn0gQW4gYXJyYXksIHdoZXJlIHRoZSBmaXJzdCBpdGVtIGlzIHRoZSBwYXJzZWQgcGFja2FnZVxuICogaWRlbnRpZmllciBhbmQgdGhlIHNlY29uZCBvbmUgaXMgdGhlIGFjdHVhbCBkZXN0aW5hdGlvbiBwYXRoIGluc2lkZSB0aGUgcGFja2FnZS5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgZ2l2ZW4gc3RyaW5nIGNhbm5vdCBiZSBwYXJzZWRcbiAqL1xuZnVuY3Rpb24gcGFyc2VDb250YWluZXJQYXRoIChyZW1vdGVQYXRoKSB7XG4gIGNvbnN0IG1hdGNoID0gQ09OVEFJTkVSX1BBVEhfUEFUVEVSTi5leGVjKHJlbW90ZVBhdGgpO1xuICBpZiAoIW1hdGNoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBJdCBpcyBleHBlY3RlZCB0aGF0IHBhY2thZ2UgaWRlbnRpZmllciBpcyBzZXBhcmF0ZWQgZnJvbSB0aGUgcmVsYXRpdmUgcGF0aCB3aXRoIGEgc2luZ2xlIHNsYXNoLiBgICtcbiAgICAgIGAnJHtyZW1vdGVQYXRofScgaXMgZ2l2ZW4gaW5zdGVhZGApO1xuICB9XG4gIHJldHVybiBbbWF0Y2hbMV0sIHBhdGgucG9zaXgucmVzb2x2ZShgL2RhdGEvZGF0YS8ke21hdGNoWzFdfWAsIG1hdGNoWzJdKV07XG59XG5cbi8qKlxuICogU2NhbnMgdGhlIGdpdmVuIGZpbGUvZm9sZGVyIG9uIHRoZSByZW1vdGUgZGV2aWNlXG4gKiBhbmQgYWRkcyBtYXRjaGluZyBpdGVtcyB0byB0aGUgZGV2aWNlJ3MgbWVkaWEgbGlicmFyeS5cbiAqIEV4Y2VwdGlvbnMgYXJlIGlnbm9yZWQgYW5kIHdyaXR0ZW4gaW50byB0aGUgbG9nLlxuICpcbiAqIEBwYXJhbSB7QURCfSBhZGIgQURCIGluc3RhbmNlXG4gKiBAcGFyYW0ge09iamVjdD99IGxvZyBMb2dnZXIgaW5zdGFuY2VcbiAqIEBwYXJhbSB7c3RyaW5nfSByZW1vdGVQYXRoIFRoZSBmaWxlL2ZvbGRlciBwYXRoIG9uIHRoZSByZW1vdGUgZGV2aWNlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNjYW5NZWRpYSAoYWRiLCByZW1vdGVQYXRoLCBsb2cgPSBudWxsKSB7XG4gIGxvZz8uZGVidWcoYFBlcmZvcm1pbmcgbWVkaWEgc2NhbiBvZiAnJHtyZW1vdGVQYXRofSdgKTtcbiAgdHJ5IHtcbiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYXBwaXVtL2FwcGl1bS9pc3N1ZXMvMTYxODRcbiAgICBpZiAoYXdhaXQgYWRiLmdldEFwaUxldmVsKCkgPj0gMjkpIHtcbiAgICAgIGF3YWl0IGFkYi5zY2FuTWVkaWEocmVtb3RlUGF0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGF3YWl0IGFkYi5zaGVsbChbXG4gICAgICAgICdhbScsICdicm9hZGNhc3QnLFxuICAgICAgICAnLWEnLCBBTkRST0lEX01FRElBX1JFU0NBTl9JTlRFTlQsXG4gICAgICAgICctZCcsIGBmaWxlOi8vJHtyZW1vdGVQYXRofWBcbiAgICAgIF0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZSkge1xuICAgIGxvZz8ud2FybihgSWdub3JpbmcgYW4gdW5leHBlY3RlZCBlcnJvciB1cG9uIG1lZGlhIHNjYW5uaW5nIG9mICcke3JlbW90ZVBhdGh9JzogJHtlLnN0ZGVyciB8fCBlLm1lc3NhZ2V9YCk7XG4gIH1cbn1cblxuLyoqXG4gKiBBIHNtYWxsIGhlbHBlciwgd2hpY2ggZXNjYXBlcyBzaW5nbGUgcXVvdGVzIGluIHBhdGhzLFxuICogc28gdGhleSBhcmUgc2FmZSB0byBiZSBwYXNzZWQgYXMgYXJndW1lbnRzIG9mIHNoZWxsIGNvbW1hbmRzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHAgVGhlIGluaXRpYWwgcmVtb3RlIHBhdGhcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBlc2NhcGVkIHBhdGggdmFsdWVcbiAqL1xuZnVuY3Rpb24gZXNjYXBlUGF0aCAocCkge1xuICByZXR1cm4gcC5yZXBsYWNlKC8nL2csIGBcXFxcJ2ApO1xufVxuXG4vKipcbiAqIFB1bGxzIGEgcmVtb3RlIGZpbGUgZnJvbSB0aGUgZGV2aWNlLlxuICogSXQgaXMgcmVxdWlyZWQsIHRoYXQgYSBwYWNrYWdlIGhhcyBkZWJ1Z2dpbmcgZmxhZyBlbmFibGVkXG4gKiBpbiBvcmRlciB0byBhY2Nlc3MgaXRzIGZpbGVzLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSByZW1vdGVQYXRoIFRoZSBmdWxsIHBhdGggdG8gdGhlIHJlbW90ZSBmaWxlXG4gKiBvciBhIHNwZWNpYWxseSBmb3JtYXR0ZWQgcGF0aCwgd2hpY2ggcG9pbnRzIHRvIGFuIGl0ZW0gaW5zaWRlIGFwcCBidW5kbGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEJhc2U2NCBlbmNvZGVkIGNvbnRlbnQgb2YgdGhlIHB1bGxlZCBmaWxlXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHB1bGwgb3BlcmF0aW9uIGZhaWxlZFxuICovXG5jb21tYW5kcy5wdWxsRmlsZSA9IGFzeW5jIGZ1bmN0aW9uIHB1bGxGaWxlIChyZW1vdGVQYXRoKSB7XG4gIGlmIChyZW1vdGVQYXRoLmVuZHNXaXRoKCcvJykpIHtcbiAgICB0aHJvdyBuZXcgZXJyb3JzLkludmFsaWRBcmd1bWVudEVycm9yKGBJdCBpcyBleHBlY3RlZCB0aGF0IHJlbW90ZSBwYXRoIHBvaW50cyB0byBhIGZpbGUgYW5kIG5vdCB0byBhIGZvbGRlci4gYCArXG4gICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgKTtcbiAgfVxuICBsZXQgdG1wRGVzdGluYXRpb24gPSBudWxsO1xuICBpZiAocmVtb3RlUGF0aC5zdGFydHNXaXRoKENPTlRBSU5FUl9QQVRIX01BUktFUikpIHtcbiAgICBjb25zdCBbcGFja2FnZUlkLCBwYXRoSW5Db250YWluZXJdID0gcGFyc2VDb250YWluZXJQYXRoKHJlbW90ZVBhdGgpO1xuICAgIHRoaXMubG9nLmRlYnVnKGBQYXJzZWQgcGFja2FnZSBpZGVudGlmaWVyICcke3BhY2thZ2VJZH0nIGZyb20gJyR7cmVtb3RlUGF0aH0nLiBXaWxsIGdldCB0aGUgZGF0YSBmcm9tICcke3BhdGhJbkNvbnRhaW5lcn0nYCk7XG4gICAgdG1wRGVzdGluYXRpb24gPSBgL2RhdGEvbG9jYWwvdG1wLyR7cGF0aC5wb3NpeC5iYXNlbmFtZShwYXRoSW5Db250YWluZXIpfWA7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncnVuLWFzJywgcGFja2FnZUlkLCBgY2htb2QgNzc3ICcke2VzY2FwZVBhdGgocGF0aEluQ29udGFpbmVyKX0nYF0pO1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoW1xuICAgICAgICAncnVuLWFzJywgcGFja2FnZUlkLFxuICAgICAgICBgY3AgLWYgJyR7ZXNjYXBlUGF0aChwYXRoSW5Db250YWluZXIpfScgJyR7ZXNjYXBlUGF0aCh0bXBEZXN0aW5hdGlvbil9J2BcbiAgICAgIF0pO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYENhbm5vdCBhY2Nlc3MgdGhlIGNvbnRhaW5lciBvZiAnJHtwYWNrYWdlSWR9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICBgSXMgdGhlIGFwcGxpY2F0aW9uIGluc3RhbGxlZCBhbmQgaGFzICdkZWJ1Z2dhYmxlJyBidWlsZCBvcHRpb24gc2V0IHRvIHRydWU/IGAgK1xuICAgICAgICAgICAgICAgICAgICAgICAgYE9yaWdpbmFsIGVycm9yOiAke2UubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cbiAgY29uc3QgbG9jYWxGaWxlID0gYXdhaXQgdGVtcERpci5wYXRoKHtwcmVmaXg6ICdhcHBpdW0nLCBzdWZmaXg6ICcudG1wJ30pO1xuICB0cnkge1xuICAgIGF3YWl0IHRoaXMuYWRiLnB1bGwodG1wRGVzdGluYXRpb24gfHwgcmVtb3RlUGF0aCwgbG9jYWxGaWxlKTtcbiAgICByZXR1cm4gKGF3YWl0IHV0aWwudG9Jbk1lbW9yeUJhc2U2NChsb2NhbEZpbGUpKS50b1N0cmluZygpO1xuICB9IGZpbmFsbHkge1xuICAgIGlmIChhd2FpdCBmcy5leGlzdHMobG9jYWxGaWxlKSkge1xuICAgICAgYXdhaXQgZnMudW5saW5rKGxvY2FsRmlsZSk7XG4gICAgfVxuICAgIGlmICh0bXBEZXN0aW5hdGlvbikge1xuICAgICAgYXdhaXQgdGhpcy5hZGIuc2hlbGwoWydybScsICctZicsIHRtcERlc3RpbmF0aW9uXSk7XG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFB1bGxGaWxlT3B0aW9uc1xuICogQHByb3BlcnR5IHtzdHJpbmd9IHJlbW90ZVBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgcmVtb3RlIGZpbGVcbiAqIG9yIGEgc3BlY2lhbGx5IGZvcm1hdHRlZCBwYXRoLCB3aGljaCBwb2ludHMgdG8gYW4gaXRlbSBpbnNpZGUgYW4gYXBwIGJ1bmRsZSxcbiAqIGZvciBleGFtcGxlIGBAbXkuYXBwLmlkL215L3BhdGhgLiBJdCBpcyBtYW5kYXRvcnkgZm9yIHRoZSBhcHAgYnVuZGxlIHRvIGhhdmVcbiAqIGRlYnVnZ2luZyBlbmFibGVkIGluIG9yZGVyIHRvIHVzZSB0aGUgbGF0dGVyIHJlbW90ZVBhdGggZm9ybWF0LlxuICovXG5cbi8qKlxuICogUHVsbHMgYSByZW1vdGUgZmlsZSBmcm9tIHRoZSBkZXZpY2UuXG4gKlxuICogQHBhcmFtIHtQdWxsRmlsZU9wdGlvbnN9IG9wdHNcbiAqIEByZXR1cm5zIHtzdHJpbmd9IFRoZSBzYW1lIGFzIGBwdWxsRmlsZWBcbiAqL1xuY29tbWFuZHMubW9iaWxlUHVsbEZpbGUgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVQdWxsRmlsZSAob3B0cyA9IHt9KSB7XG4gIGNvbnN0IHsgcmVtb3RlUGF0aCB9ID0gcmVxdWlyZUFyZ3MoJ3JlbW90ZVBhdGgnLCBvcHRzKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHVsbEZpbGUocmVtb3RlUGF0aCk7XG59O1xuXG4vKipcbiAqIFB1c2hlcyB0aGUgZ2l2ZW4gZGF0YSB0byBhIGZpbGUgb24gdGhlIHJlbW90ZSBkZXZpY2VcbiAqIEl0IGlzIHJlcXVpcmVkLCB0aGF0IGEgcGFja2FnZSBoYXMgZGVidWdnaW5nIGZsYWcgZW5hYmxlZFxuICogaW4gb3JkZXIgdG8gYWNjZXNzIGl0cyBmaWxlcy5cbiAqIEFmdGVyIGEgZmlsZSBpcyBwdXNoZWQgaXQgZ2V0cyBhdXRvbWF0aWNhbGx5IHNjYW5uZWQgZm9yIHBvc3NpYmxlXG4gKiBtZWRpYSBvY2N1cnJlbmNlcy4gSWYgdGhlIHNjYW4gc3VjY2VlZHMgdGhlbiB0aGUgZmlsZSBpcyBhZGRlZCB0byB0aGVcbiAqIG1lZGlhIGxpYnJhcnkuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZVBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgcmVtb3RlIGZpbGUgb3JcbiAqIGEgZmlsZSBpbnNpZGUgYSBwYWNrYWdlIGJ1bmRsZVxuICogQHBhcmFtIHtzdHJpbmd9IGJhc2U2NERhdGEgQmFzZTY0IGVuY29kZWQgZGF0YSB0byBiZSB3cml0dGVuIHRvIHRoZVxuICogcmVtb3RlIGZpbGUuIFRoZSByZW1vdGUgZmlsZSB3aWxsIGJlIHNpbGVudGx5IG92ZXJyaWRkZW4gaWYgaXQgYWxyZWFkeSBleGlzdHMuXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIHB1c2hpbmcgdGhlIGRhdGFcbiAqL1xuY29tbWFuZHMucHVzaEZpbGUgPSBhc3luYyBmdW5jdGlvbiBwdXNoRmlsZSAocmVtb3RlUGF0aCwgYmFzZTY0RGF0YSkge1xuICBpZiAocmVtb3RlUGF0aC5lbmRzV2l0aCgnLycpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihcbiAgICAgIGBJdCBpcyBleHBlY3RlZCB0aGF0IHJlbW90ZSBwYXRoIHBvaW50cyB0byBhIGZpbGUgYW5kIG5vdCB0byBhIGZvbGRlci4gYCArXG4gICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgXG4gICAgKTtcbiAgfVxuICBjb25zdCBsb2NhbEZpbGUgPSBhd2FpdCB0ZW1wRGlyLnBhdGgoe3ByZWZpeDogJ2FwcGl1bScsIHN1ZmZpeDogJy50bXAnfSk7XG4gIGlmIChfLmlzQXJyYXkoYmFzZTY0RGF0YSkpIHtcbiAgICAvLyBzb21lIGNsaWVudHMgKGFoZW0pIGphdmEsIHNlbmQgYSBieXRlIGFycmF5IGVuY29kaW5nIHV0ZjggY2hhcmFjdGVyc1xuICAgIC8vIGluc3RlYWQgb2YgYSBzdHJpbmcsIHdoaWNoIHdvdWxkIGJlIGluZmluaXRlbHkgYmV0dGVyIVxuICAgIGJhc2U2NERhdGEgPSBCdWZmZXIuZnJvbShiYXNlNjREYXRhKS50b1N0cmluZygndXRmOCcpO1xuICB9XG4gIGNvbnN0IGNvbnRlbnQgPSBCdWZmZXIuZnJvbShiYXNlNjREYXRhLCAnYmFzZTY0Jyk7XG4gIGxldCB0bXBEZXN0aW5hdGlvbiA9IG51bGw7XG4gIHRyeSB7XG4gICAgYXdhaXQgZnMud3JpdGVGaWxlKGxvY2FsRmlsZSwgY29udGVudC50b1N0cmluZygnYmluYXJ5JyksICdiaW5hcnknKTtcbiAgICBpZiAocmVtb3RlUGF0aC5zdGFydHNXaXRoKENPTlRBSU5FUl9QQVRIX01BUktFUikpIHtcbiAgICAgIGNvbnN0IFtwYWNrYWdlSWQsIHBhdGhJbkNvbnRhaW5lcl0gPSBwYXJzZUNvbnRhaW5lclBhdGgocmVtb3RlUGF0aCk7XG4gICAgICB0aGlzLmxvZy5kZWJ1ZyhgUGFyc2VkIHBhY2thZ2UgaWRlbnRpZmllciAnJHtwYWNrYWdlSWR9JyBmcm9tICcke3JlbW90ZVBhdGh9Jy4gYCArXG4gICAgICAgIGBXaWxsIHB1dCB0aGUgZGF0YSBpbnRvICcke3BhdGhJbkNvbnRhaW5lcn0nYCk7XG4gICAgICB0bXBEZXN0aW5hdGlvbiA9IGAvZGF0YS9sb2NhbC90bXAvJHtwYXRoLnBvc2l4LmJhc2VuYW1lKHBhdGhJbkNvbnRhaW5lcil9YDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFxuICAgICAgICAgIFsncnVuLWFzJywgcGFja2FnZUlkLCBgbWtkaXIgLXAgJyR7ZXNjYXBlUGF0aChwYXRoLnBvc2l4LmRpcm5hbWUocGF0aEluQ29udGFpbmVyKSl9J2BdXG4gICAgICAgICk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncnVuLWFzJywgcGFja2FnZUlkLCBgdG91Y2ggJyR7ZXNjYXBlUGF0aChwYXRoSW5Db250YWluZXIpfSdgXSk7XG4gICAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncnVuLWFzJywgcGFja2FnZUlkLCBgY2htb2QgNzc3ICcke2VzY2FwZVBhdGgocGF0aEluQ29udGFpbmVyKX0nYF0pO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5wdXNoKGxvY2FsRmlsZSwgdG1wRGVzdGluYXRpb24pO1xuICAgICAgICBhd2FpdCB0aGlzLmFkYi5zaGVsbChbXG4gICAgICAgICAgJ3J1bi1hcycsIHBhY2thZ2VJZCxcbiAgICAgICAgICBgY3AgLWYgJyR7ZXNjYXBlUGF0aCh0bXBEZXN0aW5hdGlvbil9JyAnJHtlc2NhcGVQYXRoKHBhdGhJbkNvbnRhaW5lcil9J2BcbiAgICAgICAgXSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHRoaXMubG9nLmVycm9yQW5kVGhyb3coYENhbm5vdCBhY2Nlc3MgdGhlIGNvbnRhaW5lciBvZiAnJHtwYWNrYWdlSWR9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBJcyB0aGUgYXBwbGljYXRpb24gaW5zdGFsbGVkIGFuZCBoYXMgJ2RlYnVnZ2FibGUnIGJ1aWxkIG9wdGlvbiBzZXQgdG8gdHJ1ZT8gYCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIGFkYiBwdXNoIGNyZWF0ZXMgZm9sZGVycyBhbmQgb3ZlcndyaXRlcyBleGlzdGluZyBmaWxlcy5cbiAgICAgIGF3YWl0IHRoaXMuYWRiLnB1c2gobG9jYWxGaWxlLCByZW1vdGVQYXRoKTtcblxuICAgICAgLy8gaWYgd2UgaGF2ZSBwdXNoZWQgYSBmaWxlLCBpdCBtaWdodCBiZSBhIG1lZGlhIGZpbGUsIHNvIGVuc3VyZSB0aGF0XG4gICAgICAvLyBhcHBzIGtub3cgYWJvdXQgaXRcbiAgICAgIGF3YWl0IHNjYW5NZWRpYSh0aGlzLmFkYiwgcmVtb3RlUGF0aCwgdGhpcy5sb2cpO1xuICAgIH1cbiAgfSBmaW5hbGx5IHtcbiAgICBpZiAoYXdhaXQgZnMuZXhpc3RzKGxvY2FsRmlsZSkpIHtcbiAgICAgIGF3YWl0IGZzLnVubGluayhsb2NhbEZpbGUpO1xuICAgIH1cbiAgICBpZiAodG1wRGVzdGluYXRpb24pIHtcbiAgICAgIGF3YWl0IHRoaXMuYWRiLnNoZWxsKFsncm0nLCAnLWYnLCB0bXBEZXN0aW5hdGlvbl0pO1xuICAgIH1cbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBQdXNoRmlsZU9wdGlvbnNcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSByZW1vdGVQYXRoIFRoZSBmdWxsIHBhdGggdG8gdGhlIHJlbW90ZSBmaWxlXG4gKiBvciBhIHNwZWNpYWxseSBmb3JtYXR0ZWQgcGF0aCwgd2hpY2ggcG9pbnRzIHRvIGFuIGl0ZW0gaW5zaWRlIGFuIGFwcCBidW5kbGUsXG4gKiBmb3IgZXhhbXBsZSBgQG15LmFwcC5pZC9teS9wYXRoYC4gSXQgaXMgbWFuZGF0b3J5IGZvciB0aGUgYXBwIGJ1bmRsZSB0byBoYXZlXG4gKiBkZWJ1Z2dpbmcgZW5hYmxlZCBpbiBvcmRlciB0byB1c2UgdGhlIGxhdHRlciByZW1vdGVQYXRoIGZvcm1hdC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwYXlsb2FkIEJhc2U2NC1lbmNvZGVkIGNvbnRlbnQgb2YgdGhlIGZpbGUgdG8gYmUgcHVzaGVkLlxuICovXG5cbi8qKlxuICogUHVzaGVzIHRoZSBnaXZlbiBkYXRhIHRvIGEgZmlsZSBvbiB0aGUgcmVtb3RlIGRldmljZS5cbiAqXG4gKiBAcGFyYW0ge1B1c2hGaWxlT3B0aW9uc30gb3B0c1xuICovXG5jb21tYW5kcy5tb2JpbGVQdXNoRmlsZSA9IGFzeW5jIGZ1bmN0aW9uIG1vYmlsZVB1c2hGaWxlIChvcHRzID0ge30pIHtcbiAgY29uc3QgeyByZW1vdGVQYXRoLCBwYXlsb2FkIH0gPSByZXF1aXJlQXJncyhbJ3JlbW90ZVBhdGgnLCAncGF5bG9hZCddLCBvcHRzKTtcbiAgcmV0dXJuIGF3YWl0IHRoaXMucHVzaEZpbGUocmVtb3RlUGF0aCwgcGF5bG9hZCk7XG59O1xuXG4vKipcbiAqIFB1bGxzIHRoZSB3aG9sZSBmb2xkZXIgZnJvbSB0aGUgcmVtb3RlIGRldmljZVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSByZW1vdGVQYXRoIFRoZSBmdWxsIHBhdGggdG8gYSBmb2xkZXIgb24gdGhlXG4gKiByZW1vdGUgZGV2aWNlIG9yIGEgZm9sZGVyIGluc2lkZSBhbiBhcHBsaWNhdGlvbiBidW5kbGVcbiAqIEByZXR1cm5zIHtzdHJpbmd9IEJhc2U2NC1lbmNvZGVkIGFuZCB6aXBwZWQgY29udGVudCBvZiB0aGUgZm9sZGVyXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlcmUgd2FzIGEgZmFpbHVyZSB3aGlsZSBnZXR0aW5nIHRoZSBmb2xkZXIgY29udGVudFxuICovXG5jb21tYW5kcy5wdWxsRm9sZGVyID0gYXN5bmMgZnVuY3Rpb24gcHVsbEZvbGRlciAocmVtb3RlUGF0aCkge1xuICBjb25zdCB0bXBSb290ID0gYXdhaXQgdGVtcERpci5vcGVuRGlyKCk7XG4gIHRyeSB7XG4gICAgYXdhaXQgdGhpcy5hZGIucHVsbChyZW1vdGVQYXRoLCB0bXBSb290KTtcbiAgICByZXR1cm4gKGF3YWl0IHppcC50b0luTWVtb3J5WmlwKHRtcFJvb3QsIHtcbiAgICAgIGVuY29kZVRvQmFzZTY0OiB0cnVlLFxuICAgIH0pKS50b1N0cmluZygpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGZzLnJpbXJhZih0bXBSb290KTtcbiAgfVxufTtcblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBQdWxsRm9sZGVyT3B0aW9uc1xuICogQHByb3BlcnR5IHtzdHJpbmd9IHJlbW90ZVBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgcmVtb3RlIGZvbGRlci5cbiAqL1xuXG4vKipcbiAqIFB1bGxzIHRoZSB3aG9sZSBmb2xkZXIgZnJvbSB0aGUgZGV2aWNlIHVuZGVyIHRlc3QuXG4gKlxuICogQHBhcmFtIHtQdWxsRm9sZGVyT3B0aW9uc30gb3B0c1xuICogQHJldHVybnMge3N0cmluZ30gVGhlIHNhbWUgYXMgYHB1bGxGb2xkZXJgXG4gKi9cbmNvbW1hbmRzLm1vYmlsZVB1bGxGb2xkZXIgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVQdWxsRm9sZGVyIChvcHRzID0ge30pIHtcbiAgY29uc3QgeyByZW1vdGVQYXRoIH0gPSByZXF1aXJlQXJncygncmVtb3RlUGF0aCcsIG9wdHMpO1xuICByZXR1cm4gYXdhaXQgdGhpcy5wdWxsRm9sZGVyKHJlbW90ZVBhdGgpO1xufTtcblxuLyoqXG4gKiBEZWxldGVzIHRoZSBnaXZlbiBmb2xkZXIgb3IgZmlsZSBmcm9tIHRoZSByZW1vdGUgZGV2aWNlXG4gKlxuICogQHBhcmFtIHtBREJ9IGFkYlxuICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZVBhdGggVGhlIGZ1bGwgcGF0aCB0byB0aGUgcmVtb3RlIGZvbGRlclxuICogb3IgZmlsZSAoZm9sZGVyIG5hbWVzIG11c3QgZW5kIHdpdGggYSBzaW5nbGUgc2xhc2gpXG4gKiBAdGhyb3dzIHtFcnJvcn0gSWYgdGhlIHByb3ZpZGVkIHJlbW90ZSBwYXRoIGlzIGludmFsaWQgb3JcbiAqIHRoZSBwYWNrYWdlIGNvbnRlbnQgY2Fubm90IGJlIGFjY2Vzc2VkXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSByZW1vdGUgaXRlbSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgZGVsZXRlZC5cbiAqIElmIHRoZSByZW1vdGUgcGF0aCBpcyB2YWxpZCwgYnV0IHRoZSByZW1vdGUgcGF0aCBkb2VzIG5vdCBleGlzdFxuICogdGhpcyBmdW5jdGlvbiByZXR1cm4gYGZhbHNlYC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGVsZXRlRmlsZU9yRm9sZGVyIChhZGIsIHJlbW90ZVBhdGgpIHtcbiAgY29uc3QgcGVyZm9ybVJlbW90ZUZzQ2hlY2sgPSBhc3luYyAocCwgb3AsIHJ1bkFzID0gbnVsbCkgPT4ge1xuICAgIGNvbnN0IHBhc3NGbGFnID0gJ19fUEFTU19fJztcbiAgICBjb25zdCBjaGVja0NtZCA9IGBbIC0ke29wfSAnJHtlc2NhcGVQYXRoKHApfScgXSAmJiBlY2hvICR7cGFzc0ZsYWd9YDtcbiAgICBjb25zdCBmdWxsQ21kID0gcnVuQXMgPyBgcnVuLWFzICR7cnVuQXN9ICR7Y2hlY2tDbWR9YCA6IGNoZWNrQ21kO1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gXy5pbmNsdWRlcyhhd2FpdCBhZGIuc2hlbGwoW2Z1bGxDbWRdKSwgcGFzc0ZsYWcpO1xuICAgIH0gY2F0Y2ggKGlnbikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcbiAgY29uc3QgaXNGaWxlID0gYXN5bmMgKHAsIHJ1bkFzID0gbnVsbCkgPT4gYXdhaXQgcGVyZm9ybVJlbW90ZUZzQ2hlY2socCwgJ2YnLCBydW5Bcyk7XG4gIGNvbnN0IGlzRGlyID0gYXN5bmMgKHAsIHJ1bkFzID0gbnVsbCkgPT4gYXdhaXQgcGVyZm9ybVJlbW90ZUZzQ2hlY2socCwgJ2QnLCBydW5Bcyk7XG4gIGNvbnN0IGlzUHJlc2VudCA9IGFzeW5jIChwLCBydW5BcyA9IG51bGwpID0+IGF3YWl0IHBlcmZvcm1SZW1vdGVGc0NoZWNrKHAsICdlJywgcnVuQXMpO1xuXG4gIGxldCBkc3RQYXRoID0gcmVtb3RlUGF0aDtcbiAgbGV0IHBrZ0lkID0gbnVsbDtcbiAgaWYgKHJlbW90ZVBhdGguc3RhcnRzV2l0aChDT05UQUlORVJfUEFUSF9NQVJLRVIpKSB7XG4gICAgY29uc3QgW3BhY2thZ2VJZCwgcGF0aEluQ29udGFpbmVyXSA9IHBhcnNlQ29udGFpbmVyUGF0aChyZW1vdGVQYXRoKTtcbiAgICB0aGlzLmxvZy5kZWJ1ZyhgUGFyc2VkIHBhY2thZ2UgaWRlbnRpZmllciAnJHtwYWNrYWdlSWR9JyBmcm9tICcke3JlbW90ZVBhdGh9J2ApO1xuICAgIGRzdFBhdGggPSBwYXRoSW5Db250YWluZXI7XG4gICAgcGtnSWQgPSBwYWNrYWdlSWQ7XG4gIH1cblxuICBpZiAocGtnSWQpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgYWRiLnNoZWxsKFsncnVuLWFzJywgcGtnSWQsICdscyddKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBDYW5ub3QgYWNjZXNzIHRoZSBjb250YWluZXIgb2YgJyR7cGtnSWR9JyBhcHBsaWNhdGlvbi4gYCArXG4gICAgICAgIGBJcyB0aGUgYXBwbGljYXRpb24gaW5zdGFsbGVkIGFuZCBoYXMgJ2RlYnVnZ2FibGUnIGJ1aWxkIG9wdGlvbiBzZXQgdG8gdHJ1ZT8gYCArXG4gICAgICAgIGBPcmlnaW5hbCBlcnJvcjogJHtlLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgaWYgKCFhd2FpdCBpc1ByZXNlbnQoZHN0UGF0aCwgcGtnSWQpKSB7XG4gICAgdGhpcy5sb2cuaW5mbyhgVGhlIGl0ZW0gYXQgJyR7ZHN0UGF0aH0nIGRvZXMgbm90IGV4aXN0LiBQZXJoYXBzLCBhbHJlYWR5IGRlbGV0ZWQ/YCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgZXhwZWN0c0ZpbGUgPSAhcmVtb3RlUGF0aC5lbmRzV2l0aCgnLycpO1xuICBpZiAoZXhwZWN0c0ZpbGUgJiYgIWF3YWl0IGlzRmlsZShkc3RQYXRoLCBwa2dJZCkpIHtcbiAgICB0aGlzLmxvZy5lcnJvckFuZFRocm93KGBUaGUgaXRlbSBhdCAnJHtkc3RQYXRofScgaXMgbm90IGEgZmlsZWApO1xuICB9IGVsc2UgaWYgKCFleHBlY3RzRmlsZSAmJiAhYXdhaXQgaXNEaXIoZHN0UGF0aCwgcGtnSWQpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGl0ZW0gYXQgJyR7ZHN0UGF0aH0nIGlzIG5vdCBhIGZvbGRlcmApO1xuICB9XG5cbiAgaWYgKHBrZ0lkKSB7XG4gICAgYXdhaXQgYWRiLnNoZWxsKFxuICAgICAgWydydW4tYXMnLCBwa2dJZCwgYHJtIC1mJHtleHBlY3RzRmlsZSA/ICcnIDogJ3InfSAnJHtlc2NhcGVQYXRoKGRzdFBhdGgpfSdgXSk7XG4gIH0gZWxzZSB7XG4gICAgYXdhaXQgYWRiLnNoZWxsKFsncm0nLCBgLWYke2V4cGVjdHNGaWxlID8gJycgOiAncid9YCwgZHN0UGF0aF0pO1xuICB9XG4gIGlmIChhd2FpdCBpc1ByZXNlbnQoZHN0UGF0aCwgcGtnSWQpKSB7XG4gICAgdGhpcy5sb2cuZXJyb3JBbmRUaHJvdyhgVGhlIGl0ZW0gYXQgJyR7ZHN0UGF0aH0nIHN0aWxsIGV4aXN0cyBhZnRlciBiZWluZyBkZWxldGVkLiBgICtcbiAgICAgIGBJcyBpdCB3cml0YWJsZT9gKTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBEZWxldGVGaWxlT3B0c1xuICogQHByb3BlcnR5IHshc3RyaW5nfSByZW1vdGVQYXRoIFRoZSBmdWxsIHBhdGggdG8gdGhlIHJlbW90ZSBmaWxlXG4gKiBvciBhIGZpbGUgaW5zaWRlIGFuIGFwcGxpY2F0aW9uIGJ1bmRsZSAoZm9yIGV4YW1wbGUgYEBteS5hcHAuaWQvcGF0aC9pbi9idW5kbGVgKVxuICovXG5cbi8qKlxuICogRGVsZXRlcyBhIGZpbGUgb24gdGhlIHJlbW90ZSBkZXZpY2VcbiAqXG4gKiBAcGFyYW0ge0RlbGV0ZUZpbGVPcHRzfSBvcHRzXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gYHRydWVgIGlmIHRoZSByZW1vdGUgZmlsZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHkgZGVsZXRlZC5cbiAqIElmIHRoZSBwYXRoIHRvIGEgcmVtb3RlIGZpbGUgaXMgdmFsaWQsIGJ1dCB0aGUgZmlsZSBpdHNlbGYgZG9lcyBub3QgZXhpc3RcbiAqIHRoZW4gYGZhbHNlYCBpcyByZXR1cm5lZC5cbiAqIEB0aHJvd3Mge0Vycm9yfSBJZiB0aGUgYXJndW1lbnQgaXMgaW52YWxpZCBvciB0aGVyZSB3YXMgYW4gZXJyb3Igd2hpbGVcbiAqIGRlbGV0aW5nIHRoZSBmaWxlXG4gKi9cbmNvbW1hbmRzLm1vYmlsZURlbGV0ZUZpbGUgPSBhc3luYyBmdW5jdGlvbiBtb2JpbGVEZWxldGVGaWxlIChvcHRzID0ge30pIHtcbiAgY29uc3Qge3JlbW90ZVBhdGh9ID0gb3B0cztcbiAgaWYgKCFyZW1vdGVQYXRoKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihgVGhlICdyZW1vdGVQYXRoJyBhcmd1bWVudCBpcyBtYW5kYXRvcnlgKTtcbiAgfVxuICBpZiAocmVtb3RlUGF0aC5lbmRzV2l0aCgnLycpKSB7XG4gICAgdGhyb3cgbmV3IGVycm9ycy5JbnZhbGlkQXJndW1lbnRFcnJvcihcbiAgICAgIGBJdCBpcyBleHBlY3RlZCB0aGF0IHJlbW90ZSBwYXRoIHBvaW50cyB0byBhIGZvbGRlciBhbmQgbm90IHRvIGEgZmlsZS4gYCArXG4gICAgICBgJyR7cmVtb3RlUGF0aH0nIGlzIGdpdmVuIGluc3RlYWRgXG4gICAgKTtcbiAgfVxuICByZXR1cm4gYXdhaXQgZGVsZXRlRmlsZU9yRm9sZGVyKHRoaXMuYWRiLCByZW1vdGVQYXRoKTtcbn07XG5cbmV4cG9ydCB7IGNvbW1hbmRzIH07XG5leHBvcnQgZGVmYXVsdCBjb21tYW5kcztcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxPQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxRQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxLQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBRyxPQUFB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