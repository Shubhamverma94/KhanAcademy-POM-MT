{"version":3,"file":"network.js","names":["_lodash","_interopRequireDefault","require","_driver","_support","_bluebird","commands","helpers","extensions","exports","AIRPLANE_MODE_MASK","WIFI_MASK","DATA_MASK","GEO_EPSILON","Number","MIN_VALUE","WIFI_KEY_NAME","DATA_KEY_NAME","AIRPLANE_MODE_KEY_NAME","SUPPORTED_SERVICE_NAMES","getNetworkConnection","log","info","airplaneModeOn","adb","isAirplaneModeOn","connection","wifiOn","isWifiOn","dataOn","isDataOn","mobileSetConnectivity","opts","wifi","data","airplaneMode","_","every","isUndefined","errors","InvalidArgumentError","JSON","stringify","currentState","mobileGetConnectivity","services","setters","Boolean","push","setWifiState","isEmulator","setDataState","setAirplaneMode","getApiLevel","broadcastAirplaneMode","isEmpty","B","all","isArray","unsupportedServices","difference","util","pluralize","length","statePromises","resolve","includes","undefined","values","fromPairs","map","k","value","setNetworkConnection","type","shouldEnableAirplaneMode","shouldEnableWifi","shouldEnableDataConnection","isAirplaneModeEnabled","isWiFiEnabled","isDataEnabled","wrapBootstrapDisconnect","toggleData","setWifiAndData","toggleWiFi","toggleFlightMode","flightMode","setGeoLocation","location","getGeoLocation","e","warn","message","latitude","longitude","altitude","mobileRefreshGpsCache","timeoutMs","refreshGeoLocationCache","parseFloat","isLocationServicesEnabled","iLocationServicesEnabled","getLocationProviders","toggleLocationServices","isGpsEnabled","debug","toggleGPSLocationProvider","wrapped","bootstrap","ignoreUnexpectedShutdown","restart","start","appPackage","disableAndroidWatchers","acceptSslCerts","Object","assign","_default","default"],"sources":["../../../lib/commands/network.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors } from 'appium/driver';\nimport { util } from 'appium/support';\nimport B from 'bluebird';\n\nlet commands = {}, helpers = {}, extensions = {};\n\nconst AIRPLANE_MODE_MASK = 0b001;\nconst WIFI_MASK = 0b010;\nconst DATA_MASK = 0b100;\n// The value close to zero, but not zero, is needed\n// to trick JSON generation and send a float value instead of an integer,\n// This allows strictly-typed clients, like Java, to properly\n// parse it. Otherwise float 0.0 is always represented as integer 0 in JS.\n// The value must not be greater than DBL_EPSILON (https://opensource.apple.com/source/Libc/Libc-498/include/float.h)\nconst GEO_EPSILON = Number.MIN_VALUE;\nconst WIFI_KEY_NAME = 'wifi';\nconst DATA_KEY_NAME = 'data';\nconst AIRPLANE_MODE_KEY_NAME = 'airplaneMode';\nconst SUPPORTED_SERVICE_NAMES = [WIFI_KEY_NAME, DATA_KEY_NAME, AIRPLANE_MODE_KEY_NAME];\n\ncommands.getNetworkConnection = async function getNetworkConnection () {\n  this.log.info('Getting network connection');\n  let airplaneModeOn = await this.adb.isAirplaneModeOn();\n  let connection = airplaneModeOn ? AIRPLANE_MODE_MASK : 0;\n\n  // no need to check anything else if we are in airplane mode\n  if (!airplaneModeOn) {\n    let wifiOn = await this.isWifiOn();\n    connection |= (wifiOn ? WIFI_MASK : 0);\n    let dataOn = await this.adb.isDataOn();\n    connection |= (dataOn ? DATA_MASK : 0);\n  }\n\n  return connection;\n};\n\n/**\n * decoupling to override the behaviour in other drivers like UiAutomator2.\n */\ncommands.isWifiOn = async function isWifiOn () {\n  return await this.adb.isWifiOn();\n};\n\n/**\n * @typedef {Object} SetConnectivityOptions\n * @property {boolean?} wifi Either to enable or disable Wi-Fi.\n * An unset value means to not change the state for the given service.\n * @property {boolean?} data Either to enable or disable mobile data connection.\n * An unset value means to not change the state for the given service.\n * @property {boolean?} airplaneMode Either to enable to disable the Airplane Mode\n * An unset value means to not change the state for the given service.\n */\n\n/**\n * Set the connectivity state for different services\n *\n * @param {SetConnectivityOptions} opts\n * @throws {Error} If none of known properties were provided or there was an error\n * while changing connectivity states\n */\ncommands.mobileSetConnectivity = async function mobileSetConnectivity (opts = {}) {\n  const {\n    wifi,\n    data,\n    airplaneMode,\n  } = opts;\n\n  if (_.every([wifi, data, airplaneMode], _.isUndefined)) {\n    throw new errors.InvalidArgumentError(\n      `Either one of ${JSON.stringify(SUPPORTED_SERVICE_NAMES)} options must be provided`\n    );\n  }\n\n  const currentState = await this.mobileGetConnectivity({\n    services: [\n      ...(_.isUndefined(wifi) ? [] : [WIFI_KEY_NAME]),\n      ...(_.isUndefined(data) ? [] : [DATA_KEY_NAME]),\n      ...(_.isUndefined(airplaneMode) ? [] : [AIRPLANE_MODE_KEY_NAME]),\n    ]\n  });\n  const setters = [];\n  if (!_.isUndefined(wifi) && currentState.wifi !== Boolean(wifi)) {\n    setters.push(this.adb.setWifiState(wifi, this.isEmulator()));\n  }\n  if (!_.isUndefined(data) && currentState.data !== Boolean(data)) {\n    setters.push(this.adb.setDataState(data, this.isEmulator()));\n  }\n  if (!_.isUndefined(airplaneMode) && currentState.airplaneMode !== Boolean(airplaneMode)) {\n    setters.push(async () => {\n      await this.adb.setAirplaneMode(airplaneMode);\n      if (this.adb.getApiLevel() < 30) {\n        await this.adb.broadcastAirplaneMode(airplaneMode);\n      }\n    });\n  }\n  if (!_.isEmpty(setters)) {\n    await B.all(setters);\n  }\n};\n\n/**\n * @typedef {Object} GetConnectivityResult\n * @property {boolean} wifi True if wifi is enabled\n * @property {boolean} data True if mobile data connection is enabled\n * @property {boolean} airplaneMode True if Airplane Mode is enabled\n */\n\n/**\n * @typedef {Object} GetConnectivityOptions\n * @property {string[]|string?} services one or more services to get the connectivity for.\n * Supported service names are: wifi, data, airplaneMode.\n */\n\n/**\n * Retrieves the connectivity properties from the device under test\n *\n * @param {GetConnectivityOptions?} opts If no service names are provided then the\n * connectivity state is returned for all of them.\n * @returns {GetConnectivityResult}\n */\ncommands.mobileGetConnectivity = async function mobileGetConnectivity (opts = {}) {\n  let {\n    services = SUPPORTED_SERVICE_NAMES,\n  } = opts;\n  if (!_.isArray(services)) {\n    services = [services];\n  }\n  const unsupportedServices = _.difference(services, SUPPORTED_SERVICE_NAMES);\n  if (!_.isEmpty(unsupportedServices)) {\n    throw new errors.InvalidArgumentError(\n      `${util.pluralize('Service name', unsupportedServices.length, false)} ${unsupportedServices} ` +\n      `${unsupportedServices.length === 1 ? 'is' : 'are'} not known. Only the following services are ` +\n      `suported: ${SUPPORTED_SERVICE_NAMES}`\n    );\n  }\n\n  const statePromises = {\n    wifi: B.resolve(services.includes(WIFI_KEY_NAME) ? this.adb.isWifiOn() : undefined),\n    data: B.resolve(services.includes(DATA_KEY_NAME) ? this.adb.isDataOn() : undefined),\n    airplaneMode: B.resolve(\n      services.includes(AIRPLANE_MODE_KEY_NAME) ? this.adb.isAirplaneModeOn() : undefined\n    ),\n  };\n  await B.all(_.values(statePromises));\n  return _.fromPairs(services.map((k) => [k, statePromises[k].value()]));\n};\n\ncommands.setNetworkConnection = async function setNetworkConnection (type) {\n  this.log.info('Setting network connection');\n  // decode the input\n  const shouldEnableAirplaneMode = (type & AIRPLANE_MODE_MASK) !== 0;\n  const shouldEnableWifi = (type & WIFI_MASK) !== 0;\n  const shouldEnableDataConnection = (type & DATA_MASK) !== 0;\n\n  const currentState = await this.getNetworkConnection();\n  const isAirplaneModeEnabled = (currentState & AIRPLANE_MODE_MASK) !== 0;\n  const isWiFiEnabled = (currentState & WIFI_MASK) !== 0;\n  const isDataEnabled = (currentState & DATA_MASK) !== 0;\n\n  if (shouldEnableAirplaneMode !== isAirplaneModeEnabled) {\n    await this.wrapBootstrapDisconnect(async () => {\n      await this.adb.setAirplaneMode(shouldEnableAirplaneMode);\n    });\n    await this.wrapBootstrapDisconnect(async () => {\n      if (await this.adb.getApiLevel() < 30) {\n        await this.adb.broadcastAirplaneMode(shouldEnableAirplaneMode);\n      }\n    });\n  } else {\n    this.log.info(\n      `Not changing airplane mode, since it is already ${shouldEnableAirplaneMode ? 'enabled' : 'disabled'}`\n    );\n  }\n\n  if (shouldEnableWifi === isWiFiEnabled && shouldEnableDataConnection === isDataEnabled) {\n    this.log.info('Not changing data connection/Wi-Fi states, since they are already set to expected values');\n    if (await this.adb.isAirplaneModeOn()) {\n      return AIRPLANE_MODE_MASK | currentState;\n    }\n    return ~AIRPLANE_MODE_MASK & currentState;\n  }\n\n  await this.wrapBootstrapDisconnect(async () => {\n    if (shouldEnableWifi !== isWiFiEnabled) {\n      await this.setWifiState(shouldEnableWifi);\n    } else {\n      this.log.info(`Not changing Wi-Fi state, since it is already ` +\n        `${shouldEnableWifi ? 'enabled' : 'disabled'}`);\n    }\n\n    if (shouldEnableAirplaneMode) {\n      this.log.info('Not changing data connection state, because airplane mode is enabled');\n    } else if (shouldEnableDataConnection === isDataEnabled) {\n      this.log.info(`Not changing data connection state, since it is already ` +\n        `${shouldEnableDataConnection ? 'enabled' : 'disabled'}`);\n    } else {\n      await this.adb.setDataState(shouldEnableDataConnection, this.isEmulator());\n    }\n  });\n\n  return await this.getNetworkConnection();\n};\n\n/**\n * decoupling to override behaviour in other drivers like UiAutomator2.\n */\ncommands.setWifiState = async function setWifiState (wifi) {\n  await this.adb.setWifiState(wifi, this.isEmulator());\n};\n\ncommands.toggleData = async function toggleData () {\n  let data = !(await this.adb.isDataOn());\n  this.log.info(`Turning network data ${data ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setWifiAndData({data}, this.isEmulator());\n  });\n};\n\ncommands.toggleWiFi = async function toggleWiFi () {\n  let wifi = !(await this.adb.isWifiOn());\n  this.log.info(`Turning WiFi ${wifi ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setWifiAndData({wifi}, this.isEmulator());\n  });\n};\n\ncommands.toggleFlightMode = async function toggleFlightMode () {\n  /*\n   * TODO: Implement isRealDevice(). This method fails on\n   * real devices, it should throw a NotYetImplementedError\n   */\n  let flightMode = !(await this.adb.isAirplaneModeOn());\n  this.log.info(`Turning flight mode ${flightMode ? 'on' : 'off'}`);\n  await this.wrapBootstrapDisconnect(async () => {\n    await this.adb.setAirplaneMode(flightMode);\n  });\n  await this.wrapBootstrapDisconnect(async () => {\n    if (await this.adb.getApiLevel() < 30) {\n      await this.adb.broadcastAirplaneMode(flightMode);\n    }\n  });\n};\n\ncommands.setGeoLocation = async function setGeoLocation (location) {\n  await this.adb.setGeoLocation(location, this.isEmulator());\n  try {\n    return await this.getGeoLocation();\n  } catch (e) {\n    this.log.warn(`Could not get the current geolocation info: ${e.message}`);\n    this.log.warn(`Returning the default zero'ed values`);\n    return {\n      latitude: GEO_EPSILON,\n      longitude: GEO_EPSILON,\n      altitude: GEO_EPSILON,\n    };\n  }\n};\n\n/**\n * @typedef {Object} GpsCacheRefreshOptions\n * @property {number} timeoutMs [20000] The maximum number of milliseconds\n * to block until GPS cache is refreshed. Providing zero or a negative\n * value to it skips waiting completely.\n */\n\n/**\n * Sends an async request to refresh the GPS cache.\n * This feature only works if the device under test has\n * Google Play Services installed. In case the vanilla\n * LocationManager is used the device API level must be at\n * version 30 (Android R) or higher.\n *\n * @param {GpsCacheRefreshOptions} opts\n */\ncommands.mobileRefreshGpsCache = async function mobileRefreshGpsCache (opts = {}) {\n  const { timeoutMs } = opts;\n  await this.adb.refreshGeoLocationCache(timeoutMs);\n};\n\ncommands.getGeoLocation = async function getGeoLocation () {\n  const {latitude, longitude, altitude} = await this.adb.getGeoLocation();\n  return {\n    latitude: parseFloat(latitude) || GEO_EPSILON,\n    longitude: parseFloat(longitude) || GEO_EPSILON,\n    altitude: parseFloat(altitude) || GEO_EPSILON,\n  };\n};\n\n/**\n * Checks if GPS is enabled\n *\n * @returns {Promise<Boolean>} True if yes\n */\ncommands.isLocationServicesEnabled = async function iLocationServicesEnabled () {\n  return (await this.adb.getLocationProviders()).includes('gps');\n};\n\n/**\n * Toggles GPS state\n */\ncommands.toggleLocationServices = async function toggleLocationServices () {\n  this.log.info('Toggling location services');\n  const isGpsEnabled = await this.isLocationServicesEnabled();\n  this.log.debug(\n    `Current GPS state: ${isGpsEnabled}. ` +\n    `The service is going to be ${isGpsEnabled ? 'disabled' : 'enabled'}`\n  );\n  await this.adb.toggleGPSLocationProvider(!isGpsEnabled);\n};\n\nhelpers.wrapBootstrapDisconnect = async function wrapBootstrapDisconnect (wrapped) {\n  if (!this.bootstrap) {\n    return await wrapped();\n  }\n\n  this.bootstrap.ignoreUnexpectedShutdown = true;\n  try {\n    await wrapped();\n    await this.adb.restart();\n    await this.bootstrap.start(this.opts.appPackage, this.opts.disableAndroidWatchers, this.opts.acceptSslCerts);\n  } finally {\n    this.bootstrap.ignoreUnexpectedShutdown = false;\n  }\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}