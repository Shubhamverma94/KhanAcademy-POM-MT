{"version":3,"file":"element.js","names":["_androidHelpers","_interopRequireDefault","require","_asyncbox","_support","commands","helpers","extensions","exports","getAttribute","attribute","elementId","p","bootstrap","sendAction","getName","elementDisplayed","elementEnabled","elementSelected","setElementValue","keys","replace","text","Array","join","params","unicodeKeyboard","opts","doSetElementValue","setValue","replaceValue","setValueImmediate","click","adb","inputText","getText","clear","length","log","debug","retryInterval","remainingLength","lengthToSend","clearTextField","getLocation","getLocationInView","getSize","getElementRect","touchLongClick","x","y","duration","androidHelpers","removeNullProperties","touchDown","touchUp","touchMove","complexTap","tapCount","touchCount","tap","count","util","hasValue","Error","i","Object","assign","_default","default"],"sources":["../../../lib/commands/element.js"],"sourcesContent":["import androidHelpers from '../android-helpers';\nimport { retryInterval } from 'asyncbox';\nimport { util } from '@appium/support';\n\n\nlet commands = {}, helpers = {}, extensions = {};\n\ncommands.getAttribute = async function getAttribute (attribute, elementId) {\n  let p = {attribute, elementId};\n  return await this.bootstrap.sendAction('element:getAttribute', p);\n};\n\ncommands.getName = async function getName (elementId) {\n  return await this.getAttribute('className', elementId);\n};\n\ncommands.elementDisplayed = async function elementDisplayed (elementId) {\n  return await this.getAttribute('displayed', elementId) === 'true';\n};\n\ncommands.elementEnabled = async function elementEnabled (elementId) {\n  return await this.getAttribute('enabled', elementId) === 'true';\n};\n\ncommands.elementSelected = async function elementSelected (elementId) {\n  return await this.getAttribute('selected', elementId) === 'true';\n};\n\nhelpers.setElementValue = async function setElementValue (keys, elementId, replace = false) {\n  let text = keys;\n  if (keys instanceof Array) {\n    text = keys.join('');\n  }\n\n  let params = {\n    elementId,\n    text,\n    replace,\n    unicodeKeyboard: this.opts.unicodeKeyboard\n  };\n\n  return await this.doSetElementValue(params);\n};\n\n/**\n * Reason for isolating doSetElementValue from setElementValue is for reusing setElementValue\n * across android-drivers (like appium-uiautomator2-driver) and to avoid code duplication.\n * Other android-drivers (like appium-uiautomator2-driver) need to override doSetElementValue\n * to facilitate setElementValue.\n */\nhelpers.doSetElementValue = async function doSetElementValue (params) {\n  return await this.bootstrap.sendAction('element:setText', params);\n};\n\ncommands.setValue = async function setValue (keys, elementId) {\n  return await this.setElementValue(keys, elementId, false);\n};\n\ncommands.replaceValue = async function replaceValue (keys, elementId) {\n  return await this.setElementValue(keys, elementId, true);\n};\n\ncommands.setValueImmediate = async function setValueImmediate (keys, elementId) {\n  let text = keys;\n  if (keys instanceof Array) {\n    text = keys.join('');\n  }\n\n  // first, make sure we are focused on the element\n  await this.click(elementId);\n\n  // then send through adb\n  await this.adb.inputText(text);\n};\n\ncommands.getText = async function getText (elementId) {\n  return await this.bootstrap.sendAction('element:getText', {elementId});\n};\n\ncommands.clear = async function clear (elementId) {\n  let text = (await this.getText(elementId)) || '';\n  let length = text.length;\n  if (length === 0) {\n    // if length is zero there are two possibilities:\n    //   1. there is nothing in the text field\n    //   2. it is a password field\n    // since there is little overhead to the adb call, delete 100 elements\n    // if we get zero, just in case it is #2\n    length = 100;\n  }\n  await this.click(elementId);\n  this.log.debug(`Sending up to ${length} clear characters to device`);\n  return await retryInterval(5, 500, async () => {\n    let remainingLength = length;\n    while (remainingLength > 0) {\n      let lengthToSend = remainingLength < 50 ? remainingLength : 50;\n      this.log.debug(`Sending ${lengthToSend} clear characters to device`);\n      await this.adb.clearTextField(lengthToSend);\n      remainingLength -= lengthToSend;\n    }\n  });\n};\n\ncommands.click = async function click (elementId) {\n  return await this.bootstrap.sendAction('element:click', {elementId});\n};\n\ncommands.getLocation = async function getLocation (elementId) {\n  return await this.bootstrap.sendAction('element:getLocation', {elementId});\n};\n\ncommands.getLocationInView = async function getLocationInView (elementId) {\n  return await this.getLocation(elementId);\n};\n\ncommands.getSize = async function getSize (elementId) {\n  return await this.bootstrap.sendAction('element:getSize', {elementId});\n};\n\ncommands.getElementRect = async function getElementRect (elementId) {\n  return await this.bootstrap.sendAction('element:getRect', {elementId});\n};\n\ncommands.touchLongClick = async function touchLongClick (elementId, x, y, duration) {\n  let params = {elementId, x, y, duration};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchLongClick', params);\n};\n\ncommands.touchDown = async function touchDown (elementId, x, y) {\n  let params = {elementId, x, y};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchDown', params);\n};\n\ncommands.touchUp = async function touchUp (elementId, x, y) {\n  let params = {elementId, x, y};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchUp', params);\n};\n\ncommands.touchMove = async function touchMove (elementId, x, y) {\n  let params = {elementId, x, y};\n  androidHelpers.removeNullProperties(params);\n  return await this.bootstrap.sendAction('element:touchMove', params);\n};\n\ncommands.complexTap = async function complexTap (tapCount, touchCount, duration, x, y) {\n  return await this.bootstrap.sendAction('click', {x, y});\n};\n\ncommands.tap = async function (elementId = null, x = null, y = null, count = 1) {\n  if (!util.hasValue(elementId) && !util.hasValue(x) && !util.hasValue(y)) {\n    throw new Error(`Either element to tap or both absolute coordinates should be defined`);\n  }\n  for (let i = 0; i < count; i++) {\n    if (util.hasValue(elementId)) {\n      // FIXME: bootstrap ignores relative coordinates\n      await this.bootstrap.sendAction('element:click', {elementId, x, y});\n    } else {\n      await this.bootstrap.sendAction('click', {x, y});\n    }\n  }\n};\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers };\nexport default extensions;\n"],"mappings":"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"}