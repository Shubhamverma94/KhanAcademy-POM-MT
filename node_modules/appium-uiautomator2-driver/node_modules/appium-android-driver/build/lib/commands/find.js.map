{"version":3,"file":"find.js","names":["_lodash","_interopRequireDefault","require","_driver","helpers","extensions","exports","doFindElementOrEls","params","bootstrap","sendAction","findElOrEls","strategy","selector","mult","context","Error","multiple","element","doFind","err","isErrorType","errors","ProxyRequestError","getActualError","NoSuchElementError","_","isEmpty","implicitWaitForCondition","message","match","Object","assign","_default","default"],"sources":["../../../lib/commands/find.js"],"sourcesContent":["import _ from 'lodash';\nimport { errors, isErrorType } from 'appium/driver';\n\n\nlet helpers = {}, extensions = {};\n\n/**\n * Reason for isolating doFindElementOrEls from findElOrEls is for reusing findElOrEls\n * across android-drivers (like appium-uiautomator2-driver) to avoid code duplication.\n * Other android-drivers (like appium-uiautomator2-driver) need to override doFindElementOrEls\n * to facilitate findElOrEls.\n */\nhelpers.doFindElementOrEls = async function doFindElementOrEls (params) {\n  return await this.bootstrap.sendAction('find', params);\n};\n\n// stategy: locator strategy\n// selector: the actual selector for finding an element\n// mult: multiple elements or just one?\n// context: finding an element from the root context? or starting from another element\nhelpers.findElOrEls = async function findElOrEls (strategy, selector, mult, context = '') {\n  if (!selector) {\n    throw new Error('Must provide a selector when finding elements');\n  }\n\n  let params = {\n    strategy,\n    selector,\n    context,\n    multiple: mult\n  };\n\n  let element;\n  let doFind = async () => {\n    try {\n      element = await this.doFindElementOrEls(params);\n    } catch (err) {\n\n      // if the error that comes back is from a proxied request, we need to\n      // unwrap it to its actual protocol error first\n      if (isErrorType(err, errors.ProxyRequestError)) {\n        err = err.getActualError(); // eslint-disable-line no-ex-assign\n      }\n\n      // now we have to inspect the error to determine if it is a no such\n      // element error, based on the shape of the error object from\n      // appium/driver\n      if (isErrorType(err, errors.NoSuchElementError)) {\n        // we are fine with this, just indicate a retry\n        return false;\n      }\n      throw err;\n    }\n\n    // we want to return false if we want to potentially try again\n    return !_.isEmpty(element);\n  };\n\n  try {\n    await this.implicitWaitForCondition(doFind);\n  } catch (err) {\n    if (err.message && err.message.match(/Condition unmet/)) {\n      // only get here if we are looking for multiple elements\n      // condition was not met setting res to empty array\n      element = [];\n    } else {\n      throw err;\n    }\n  }\n\n  if (mult) {\n    return element;\n  }\n  if (_.isEmpty(element)) {\n    throw new errors.NoSuchElementError();\n  }\n  return element;\n};\n\nObject.assign(extensions, helpers);\nexport { helpers };\nexport default extensions;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAD,OAAA;AAGA,IAAIE,OAAO,GAAG,CAAC,CAAC;EAAEC,UAAU,GAAG,CAAC,CAAC;AAACC,OAAA,CAAAF,OAAA,GAAAA,OAAA;AAQlCA,OAAO,CAACG,kBAAkB,GAAG,eAAeA,kBAAkBA,CAAEC,MAAM,EAAE;EACtE,OAAO,MAAM,IAAI,CAACC,SAAS,CAACC,UAAU,CAAC,MAAM,EAAEF,MAAM,CAAC;AACxD,CAAC;AAMDJ,OAAO,CAACO,WAAW,GAAG,eAAeA,WAAWA,CAAEC,QAAQ,EAAEC,QAAQ,EAAEC,IAAI,EAAEC,OAAO,GAAG,EAAE,EAAE;EACxF,IAAI,CAACF,QAAQ,EAAE;IACb,MAAM,IAAIG,KAAK,CAAC,+CAA+C,CAAC;EAClE;EAEA,IAAIR,MAAM,GAAG;IACXI,QAAQ;IACRC,QAAQ;IACRE,OAAO;IACPE,QAAQ,EAAEH;EACZ,CAAC;EAED,IAAII,OAAO;EACX,IAAIC,MAAM,GAAG,MAAAA,CAAA,KAAY;IACvB,IAAI;MACFD,OAAO,GAAG,MAAM,IAAI,CAACX,kBAAkB,CAACC,MAAM,CAAC;IACjD,CAAC,CAAC,OAAOY,GAAG,EAAE;MAIZ,IAAI,IAAAC,mBAAW,EAACD,GAAG,EAAEE,cAAM,CAACC,iBAAiB,CAAC,EAAE;QAC9CH,GAAG,GAAGA,GAAG,CAACI,cAAc,CAAC,CAAC;MAC5B;MAKA,IAAI,IAAAH,mBAAW,EAACD,GAAG,EAAEE,cAAM,CAACG,kBAAkB,CAAC,EAAE;QAE/C,OAAO,KAAK;MACd;MACA,MAAML,GAAG;IACX;IAGA,OAAO,CAACM,eAAC,CAACC,OAAO,CAACT,OAAO,CAAC;EAC5B,CAAC;EAED,IAAI;IACF,MAAM,IAAI,CAACU,wBAAwB,CAACT,MAAM,CAAC;EAC7C,CAAC,CAAC,OAAOC,GAAG,EAAE;IACZ,IAAIA,GAAG,CAACS,OAAO,IAAIT,GAAG,CAACS,OAAO,CAACC,KAAK,CAAC,iBAAiB,CAAC,EAAE;MAGvDZ,OAAO,GAAG,EAAE;IACd,CAAC,MAAM;MACL,MAAME,GAAG;IACX;EACF;EAEA,IAAIN,IAAI,EAAE;IACR,OAAOI,OAAO;EAChB;EACA,IAAIQ,eAAC,CAACC,OAAO,CAACT,OAAO,CAAC,EAAE;IACtB,MAAM,IAAII,cAAM,CAACG,kBAAkB,CAAC,CAAC;EACvC;EACA,OAAOP,OAAO;AAChB,CAAC;AAEDa,MAAM,CAACC,MAAM,CAAC3B,UAAU,EAAED,OAAO,CAAC;AAAC,IAAA6B,QAAA,GAEpB5B,UAAU;AAAAC,OAAA,CAAA4B,OAAA,GAAAD,QAAA"}