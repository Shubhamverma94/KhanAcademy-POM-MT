{"version":3,"file":"context.js","names":["_lodash","_interopRequireDefault","require","_appiumChromedriver","_portfinder","_bluebird","_support","_driver","_webviewHelpers","_interopRequireWildcard","_androidHelpers","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","CHROMEDRIVER_AUTODOWNLOAD_FEATURE","commands","helpers","extensions","exports","getCurrentContext","curContext","defaultContextName","getContexts","webviewsMapping","webviewHelpers","getWebViewsMapping","adb","opts","assignContexts","setContext","name","util","hasValue","WEBVIEW_WIN","defaultWebviewName","contexts","_","includes","errors","NoSuchContextError","switchContext","mobileGetContexts","androidDeviceSocket","ensureWebviewsHavePages","webviewDevtoolsPort","enableWebviewDetailsCollection","assign","isChromeSession","webviews","parseWebviewNames","NATIVE_WIN","log","debug","JSON","stringify","isChromedriverContext","startChromedriverProxy","recreateChromeDriverSessions","stopChromedriverProxies","suspendChromedriverProxy","Error","WEBVIEW_BASE","autoWebviewName","appPackage","isWebContext","context","cd","sessionChromedrivers","setupExistingChromedriver","cloneDeep","chromeUseRunningApp","extractChromeAndroidPackageFromContextName","androidPackage","match","length","chromeAndroidPackage","map","wm","webviewName","knownPackage","KNOWN_CHROME_PACKAGE_NAMES","appState","queryAppState","APP_STATE","RUNNING_IN_BACKGROUND","RUNNING_IN_FOREGROUND","info","setupNewChromedriver","curDeviceId","on","Chromedriver","EVENT_CHANGED","msg","state","STATE_STOPPED","onChromedriverStop","chromedriver","proxyReqRes","proxyReq","bind","proxyCommand","jwproxy","command","jwpProxyActive","warn","err","startUnexpectedShutdown","keys","removeAllListeners","stop","message","viewName","CHROMIUM_WIN","shouldDismissChromeWelcome","chromeOptions","isArray","args","dismissChromeWelcome","activity","getCurrentActivity","el","findElOrEls","click","ELEMENT","e","startChromeSession","knownPackages","chromeBundleId","chromeAndroidActivity","appActivity","hasWorkingWebview","restart","getChromedriverPort","portSpec","getPort","B","promisify","PortFinder","port","foundPort","potentialPort","stopPort","parseInt","isChromedriverAutodownloadEnabled","_this$log","isFeatureEnabled","_this$isChromedriverA","_this$log6","chromeDriverPort","_this$log2","chromedriverPort","_this$log3","chromedriverPorts","details","getWebviewDetails","undefined","isEmpty","_this$log4","executable","chromedriverExecutable","cmdArgs","chromedriverArgs","verbose","showChromedriverLog","executableDir","chromedriverExecutableDir","mappingPath","chromedriverChromeMappingFile","bundleId","useSystemExecutable","chromedriverUseSystemExecutable","disableBuildCheck","chromedriverDisableBuildCheck","isAutodownloadEnabled","opt","endsWith","_this$log5","merge","caps","createChromedriverCaps","start","_default"],"sources":["../../../lib/commands/context.js"],"sourcesContent":["import _ from 'lodash';\nimport Chromedriver from 'appium-chromedriver';\nimport PortFinder from 'portfinder';\nimport B from 'bluebird';\nimport { util } from '@appium/support';\nimport { errors } from 'appium/driver';\nimport {\n  default as webviewHelpers,\n  NATIVE_WIN, WEBVIEW_BASE, WEBVIEW_WIN, CHROMIUM_WIN, KNOWN_CHROME_PACKAGE_NAMES\n} from '../webview-helpers';\nimport { APP_STATE } from '../android-helpers';\n\nconst CHROMEDRIVER_AUTODOWNLOAD_FEATURE = 'chromedriver_autodownload';\n\nlet commands = {}, helpers = {}, extensions = {};\n\n\n/* -------------------------------\n * Actual MJSONWP command handlers\n * ------------------------------- */\ncommands.getCurrentContext = async function getCurrentContext () { // eslint-disable-line require-await\n  // if the current context is `null`, indicating no context\n  // explicitly set, it is the default context\n  return this.curContext || this.defaultContextName();\n};\n\ncommands.getContexts = async function getContexts () {\n  const webviewsMapping = await webviewHelpers.getWebViewsMapping(this.adb, this.opts);\n  return this.assignContexts(webviewsMapping);\n};\n\ncommands.setContext = async function setContext (name) {\n  if (!util.hasValue(name)) {\n    name = this.defaultContextName();\n  } else if (name === WEBVIEW_WIN) {\n    // handle setContext \"WEBVIEW\"\n    name = this.defaultWebviewName();\n  }\n  // if we're already in the context we want, do nothing\n  if (name === this.curContext) {\n    return;\n  }\n\n  const webviewsMapping = await webviewHelpers.getWebViewsMapping(this.adb, this.opts);\n  const contexts = this.assignContexts(webviewsMapping);\n  // if the context we want doesn't exist, fail\n  if (!_.includes(contexts, name)) {\n    throw new errors.NoSuchContextError();\n  }\n\n  await this.switchContext(name, webviewsMapping);\n  this.curContext = name;\n};\n\n/**\n * @typedef {Object} WebviewsMapping\n * @property {string} proc The name of the Devtools Unix socket\n * @property {string} webview The web view alias. Looks like `WEBVIEW_`\n * prefix plus PID or package name\n * @property {?Object} info Webview information as it is retrieved by\n * /json/version CDP endpoint\n * @property {?Array<Object>} pages Webview pages list as it is retrieved by\n * /json/list CDP endpoint\n * @propery {?string} webviewName An actual webview name for switching context.\n * This value becomes null when failing to find a PID for a webview.\n *\n * The following json demonstrates the example of WebviewsMapping object.\n * Note that `description` in `page` can be an empty string most likely when it comes to Mobile Chrome)\n * {\n *   \"proc\": \"@webview_devtools_remote_22138\",\n *   \"webview\": \"WEBVIEW_22138\",\n *   \"info\": {\n *     \"Android-Package\": \"io.appium.settings\",\n *     \"Browser\": \"Chrome/74.0.3729.185\",\n *     \"Protocol-Version\": \"1.3\",\n *     \"User-Agent\": \"Mozilla/5.0 (Linux; Android 10; Android SDK built for x86 Build/QSR1.190920.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/74.0.3729.185 Mobile Safari/537.36\",\n *     \"V8-Version\": \"7.4.288.28\",\n *     \"WebKit-Version\": \"537.36 (@22955682f94ce09336197bfb8dffea991fa32f0d)\",\n *     \"webSocketDebuggerUrl\": \"ws://127.0.0.1:10900/devtools/browser\"\n *   },\n *   \"pages\": [\n *     {\n *       \"description\": \"{\\\"attached\\\":true,\\\"empty\\\":false,\\\"height\\\":1458,\\\"screenX\\\":0,\\\"screenY\\\":336,\\\"visible\\\":true,\\\"width\\\":1080}\",\n *       \"devtoolsFrontendUrl\": \"http://chrome-devtools-frontend.appspot.com/serve_rev/@22955682f94ce09336197bfb8dffea991fa32f0d/inspector.html?ws=127.0.0.1:10900/devtools/page/27325CC50B600D31B233F45E09487B1F\",\n *       \"id\": \"27325CC50B600D31B233F45E09487B1F\",\n *       \"title\": \"Releases · appium/appium · GitHub\",\n *       \"type\": \"page\",\n *       \"url\": \"https://github.com/appium/appium/releases\",\n *       \"webSocketDebuggerUrl\": \"ws://127.0.0.1:10900/devtools/page/27325CC50B600D31B233F45E09487B1F\"\n *     }\n *   ],\n *   \"webviewName\": \"WEBVIEW_com.io.appium.setting\"\n * }\n */\n\n/**\n * Returns a webviewsMapping based on CDP endpoints\n *\n * @return {Array<WebviewsMapping>} webviewsMapping\n */\ncommands.mobileGetContexts = async function mobileGetContexts () {\n  const opts = {\n    androidDeviceSocket: this.opts.androidDeviceSocket,\n    ensureWebviewsHavePages: true,\n    webviewDevtoolsPort: this.opts.webviewDevtoolsPort,\n    enableWebviewDetailsCollection: true\n  };\n  return await webviewHelpers.getWebViewsMapping(this.adb, opts);\n};\n\nhelpers.assignContexts = function assignContexts (webviewsMapping) {\n  const opts = Object.assign({isChromeSession: this.isChromeSession}, this.opts);\n  const webviews = webviewHelpers.parseWebviewNames(webviewsMapping, opts);\n  this.contexts = [NATIVE_WIN, ...webviews];\n  this.log.debug(`Available contexts: ${JSON.stringify(this.contexts)}`);\n  return this.contexts;\n};\n\nhelpers.switchContext = async function switchContext (name, webviewsMapping) {\n  // We have some options when it comes to webviews. If we want a\n  // Chromedriver webview, we can only control one at a time.\n  if (this.isChromedriverContext(name)) {\n    // start proxying commands directly to chromedriver\n    await this.startChromedriverProxy(name, webviewsMapping);\n  } else if (this.isChromedriverContext(this.curContext)) {\n    // if we're moving to a non-chromedriver webview, and our current context\n    // _is_ a chromedriver webview, if caps recreateChromeDriverSessions is set\n    // to true then kill chromedriver session using stopChromedriverProxies or\n    // else simply suspend proxying to the latter\n    if (this.opts.recreateChromeDriverSessions) {\n      this.log.debug('recreateChromeDriverSessions set to true; killing existing chromedrivers');\n      await this.stopChromedriverProxies();\n    } else {\n      await this.suspendChromedriverProxy();\n    }\n  } else {\n    throw new Error(`Didn't know how to handle switching to context '${name}'`);\n  }\n};\n\n\n/* ---------------------------------\n * On-object context-related helpers\n * --------------------------------- */\n\n// The reason this is a function and not just a constant is that both android-\n// driver and selendroid-driver use this logic, and each one returns\n// a different default context name\nhelpers.defaultContextName = function defaultContextName () {\n  return NATIVE_WIN;\n};\n\nhelpers.defaultWebviewName = function defaultWebviewName () {\n  return WEBVIEW_BASE + (this.opts.autoWebviewName || this.opts.appPackage);\n};\n\nhelpers.isWebContext = function isWebContext () {\n  return this.curContext !== null && this.curContext !== NATIVE_WIN;\n};\n\n// Turn on proxying to an existing Chromedriver session or a new one\nhelpers.startChromedriverProxy = async function startChromedriverProxy (context, webviewsMapping) {\n  this.log.debug(`Connecting to chrome-backed webview context '${context}'`);\n\n  let cd;\n  if (this.sessionChromedrivers[context]) {\n    // in the case where we've already set up a chromedriver for a context,\n    // we want to reconnect to it, not create a whole new one\n    this.log.debug(`Found existing Chromedriver for context '${context}'. Using it.`);\n    cd = this.sessionChromedrivers[context];\n    await setupExistingChromedriver(this.log, cd);\n  } else {\n    let opts = _.cloneDeep(this.opts);\n    opts.chromeUseRunningApp = true;\n\n    // if requested, tell chromedriver to attach to the android package we have\n    // associated with the context name, rather than the package of the AUT.\n    // And turn this on by default for chrome--if chrome pops up with a webview\n    // and someone wants to switch to it, we should let chromedriver connect to\n    // chrome rather than staying stuck on the AUT\n    if (opts.extractChromeAndroidPackageFromContextName || context === `${WEBVIEW_BASE}chrome`) {\n      let androidPackage = context.match(`${WEBVIEW_BASE}(.+)`);\n      if (androidPackage && androidPackage.length > 0) {\n        opts.chromeAndroidPackage = androidPackage[1];\n      }\n      if (!opts.extractChromeAndroidPackageFromContextName) {\n        if (_.has(this.opts, 'enableWebviewDetailsCollection') && !this.opts.enableWebviewDetailsCollection) {\n          // When enableWebviewDetailsCollection capability is explicitly disabled, try to identify\n          // chromeAndroidPackage based on contexts, known chrome variant packages and queryAppState result\n          // since webviewsMapping does not have info object\n          const contexts = webviewsMapping.map((wm) => wm.webviewName);\n          for (const knownPackage of KNOWN_CHROME_PACKAGE_NAMES) {\n            if (_.includes(contexts, `${WEBVIEW_BASE}${knownPackage}`)) {\n              continue;\n            }\n            const appState = await this.queryAppState(knownPackage);\n            if (_.includes([APP_STATE.RUNNING_IN_BACKGROUND, APP_STATE.RUNNING_IN_FOREGROUND], appState)) {\n              opts.chromeAndroidPackage = knownPackage;\n              this.log.debug(`Identified chromeAndroidPackage as '${opts.chromeAndroidPackage}' ` +\n                `for context '${context}' by querying states of Chrome app packages`);\n              break;\n            }\n          }\n        } else {\n          for (const wm of webviewsMapping) {\n            if (wm.webviewName === context && _.has(wm?.info, 'Android-Package')) {\n              opts.chromeAndroidPackage = wm.info['Android-Package'];\n              this.log.debug(`Identified chromeAndroidPackage as '${opts.chromeAndroidPackage}' ` +\n                `for context '${context}' by CDP`);\n              break;\n            }\n          }\n        }\n      }\n    }\n\n    cd = await this.setupNewChromedriver(opts, this.adb.curDeviceId, this.adb, context);\n    // bind our stop/exit handler, passing in context so we know which\n    // one stopped unexpectedly\n    cd.on(Chromedriver.EVENT_CHANGED, (msg) => {\n      if (msg.state === Chromedriver.STATE_STOPPED) {\n        this.onChromedriverStop(context);\n      }\n    });\n    // save the chromedriver object under the context\n    this.sessionChromedrivers[context] = cd;\n  }\n  // hook up the local variables so we can proxy this biz\n  this.chromedriver = cd;\n  this.proxyReqRes = this.chromedriver.proxyReq.bind(this.chromedriver);\n  this.proxyCommand = this.chromedriver.jwproxy.command.bind(this.chromedriver.jwproxy);\n  this.jwpProxyActive = true;\n};\n\n// Stop proxying to any Chromedriver\nhelpers.suspendChromedriverProxy = function suspendChromedriverProxy () {\n  this.chromedriver = null;\n  this.proxyReqRes = null;\n  this.proxyCommand = null;\n  this.jwpProxyActive = false;\n};\n\n// Handle an out-of-band Chromedriver stop event\nhelpers.onChromedriverStop = async function onChromedriverStop (context) {\n  this.log.warn(`Chromedriver for context ${context} stopped unexpectedly`);\n  if (context === this.curContext) {\n    // we exited unexpectedly while automating the current context and so want\n    // to shut down the session and respond with an error\n    let err = new Error('Chromedriver quit unexpectedly during session');\n    await this.startUnexpectedShutdown(err);\n  } else {\n    // if a Chromedriver in the non-active context barfs, we don't really\n    // care, we'll just make a new one next time we need the context.\n    this.log.warn(\"Chromedriver quit unexpectedly, but it wasn't the active \" +\n      'context, ignoring');\n    delete this.sessionChromedrivers[context];\n  }\n};\n\n// Intentionally stop all the chromedrivers currently active, and ignore\n// their exit events\nhelpers.stopChromedriverProxies = async function stopChromedriverProxies () {\n  this.suspendChromedriverProxy(); // make sure we turn off the proxy flag\n  for (let context of _.keys(this.sessionChromedrivers)) {\n    let cd = this.sessionChromedrivers[context];\n    this.log.debug(`Stopping chromedriver for context ${context}`);\n    // stop listening for the stopped state event\n    cd.removeAllListeners(Chromedriver.EVENT_CHANGED);\n    try {\n      await cd.stop();\n    } catch (err) {\n      this.log.warn(`Error stopping Chromedriver: ${err.message}`);\n    }\n    delete this.sessionChromedrivers[context];\n  }\n};\n\nhelpers.isChromedriverContext = function isChromedriverContext (viewName) {\n  return _.includes(viewName, WEBVIEW_WIN) || viewName === CHROMIUM_WIN;\n};\n\nhelpers.shouldDismissChromeWelcome = function shouldDismissChromeWelcome () {\n  return !!this.opts.chromeOptions &&\n         _.isArray(this.opts.chromeOptions.args) &&\n         this.opts.chromeOptions.args.includes('--no-first-run');\n};\n\nhelpers.dismissChromeWelcome = async function dismissChromeWelcome () {\n  this.log.info('Trying to dismiss Chrome welcome');\n  let activity = await this.getCurrentActivity();\n  if (activity !== 'org.chromium.chrome.browser.firstrun.FirstRunActivity') {\n    this.log.info('Chrome welcome dialog never showed up! Continuing');\n    return;\n  }\n  let el = await this.findElOrEls('id', 'com.android.chrome:id/terms_accept', false);\n  await this.click(el.ELEMENT);\n  try {\n    let el = await this.findElOrEls('id', 'com.android.chrome:id/negative_button', false);\n    await this.click(el.ELEMENT);\n  } catch (e) {\n    // DO NOTHING, THIS DEVICE DIDNT LAUNCH THE SIGNIN DIALOG\n    // IT MUST BE A NON GMS DEVICE\n    this.log.warn(`This device did not show Chrome SignIn dialog, ${e.message}`);\n  }\n};\n\nhelpers.startChromeSession = async function startChromeSession () {\n  this.log.info('Starting a chrome-based browser session');\n  let opts = _.cloneDeep(this.opts);\n\n  const knownPackages = [\n    'org.chromium.chrome.shell',\n    'com.android.chrome',\n    'com.chrome.beta',\n    'org.chromium.chrome',\n    'org.chromium.webview_shell',\n  ];\n\n  if (_.includes(knownPackages, this.opts.appPackage)) {\n    opts.chromeBundleId = this.opts.appPackage;\n  } else {\n    opts.chromeAndroidActivity = this.opts.appActivity;\n  }\n  this.chromedriver = await this.setupNewChromedriver(opts, this.adb.curDeviceId, this.adb);\n  this.chromedriver.on(Chromedriver.EVENT_CHANGED, (msg) => {\n    if (msg.state === Chromedriver.STATE_STOPPED) {\n      this.onChromedriverStop(CHROMIUM_WIN);\n    }\n  });\n\n  // Now that we have a Chrome session, we ensure that the context is\n  // appropriately set and that this chromedriver is added to the list\n  // of session chromedrivers so we can switch back and forth\n  this.curContext = CHROMIUM_WIN;\n  this.sessionChromedrivers[CHROMIUM_WIN] = this.chromedriver;\n  this.proxyReqRes = this.chromedriver.proxyReq.bind(this.chromedriver);\n  this.proxyCommand = this.chromedriver.jwproxy.command.bind(this.chromedriver.jwproxy);\n  this.jwpProxyActive = true;\n\n  if (this.shouldDismissChromeWelcome()) {\n    // dismiss Chrome welcome dialog\n    await this.dismissChromeWelcome();\n  }\n};\n\n\n/* --------------------------\n * Internal library functions\n * -------------------------- */\n\nasync function setupExistingChromedriver (log, chromedriver) {\n  // check the status by sending a simple window-based command to ChromeDriver\n  // if there is an error, we want to recreate the ChromeDriver session\n  if (!await chromedriver.hasWorkingWebview()) {\n    log.debug('ChromeDriver is not associated with a window. ' +\n                 'Re-initializing the session.');\n    await chromedriver.restart();\n  }\n  return chromedriver;\n}\n\n/**\n * Find a free port to have Chromedriver listen on.\n *\n * @param {array} portSpec - Array which is a list of ports. A list item may\n * also itself be an array of length 2 specifying a start and end port of\n * a range. Some valid port specs:\n *    - [8000, 8001, 8002]\n *    - [[8000, 8005]]\n *    - [8000, [9000, 9100]]\n * @param {Object?} log Logger instance\n *\n * @return {number} A free port\n */\nasync function getChromedriverPort (portSpec, log = null) {\n  const getPort = B.promisify(PortFinder.getPort, {context: PortFinder});\n\n  // if the user didn't give us any specific information about chromedriver\n  // port ranges, just find any free port\n  if (!portSpec) {\n    const port = await getPort();\n    log?.debug(`A port was not given, using random free port: ${port}`);\n    return port;\n  }\n\n  // otherwise find the free port based on a list or range provided by the user\n  log?.debug(`Finding a free port for chromedriver using spec ${JSON.stringify(portSpec)}`);\n  let foundPort = null;\n  for (const potentialPort of portSpec) {\n    let port, stopPort;\n    if (_.isArray(potentialPort)) {\n      ([port, stopPort] = potentialPort);\n    } else {\n      port = parseInt(potentialPort, 10); // ensure we have a number and not a string\n      stopPort = port;\n    }\n    try {\n      log?.debug(`Checking port range ${port}:${stopPort}`);\n      foundPort = await getPort({port, stopPort});\n      break;\n    } catch (e) {\n      log?.debug(`Nothing in port range ${port}:${stopPort} was available`);\n    }\n  }\n\n  if (foundPort === null) {\n    throw new Error(`Could not find a free port for chromedriver using ` +\n                    `chromedriverPorts spec ${JSON.stringify(portSpec)}`);\n  }\n\n  log?.debug(`Using free port ${foundPort} for chromedriver`);\n  return foundPort;\n}\n\nhelpers.isChromedriverAutodownloadEnabled = function isChromedriverAutodownloadEnabled () {\n  if (this.isFeatureEnabled(CHROMEDRIVER_AUTODOWNLOAD_FEATURE)) {\n    return true;\n  }\n  this?.log?.debug(`Automated Chromedriver download is disabled. ` +\n    `Use '${CHROMEDRIVER_AUTODOWNLOAD_FEATURE}' server feature to enable it`);\n  return false;\n};\n\nhelpers.setupNewChromedriver = async function setupNewChromedriver (opts, curDeviceId, adb, context = null) {\n  if (opts.chromeDriverPort) {\n    this?.log?.warn(`The 'chromeDriverPort' capability is deprecated. Please use 'chromedriverPort' instead`);\n    opts.chromedriverPort = opts.chromeDriverPort;\n  }\n\n  if (opts.chromedriverPort) {\n    this?.log?.debug(`Using user-specified port ${opts.chromedriverPort} for chromedriver`);\n  } else {\n    // if a single port wasn't given, we'll look for a free one\n    opts.chromedriverPort = await getChromedriverPort(opts.chromedriverPorts, this?.log);\n  }\n\n  const details = context ? webviewHelpers.getWebviewDetails(adb, context) : undefined;\n  if (!_.isEmpty(details)) {\n    this?.log?.debug('Passing web view details to the Chromedriver constructor: ' +\n      JSON.stringify(details, null, 2));\n  }\n\n  const chromedriver = new Chromedriver({\n    port: opts.chromedriverPort,\n    executable: opts.chromedriverExecutable,\n    adb,\n    cmdArgs: opts.chromedriverArgs,\n    verbose: !!opts.showChromedriverLog,\n    executableDir: opts.chromedriverExecutableDir,\n    mappingPath: opts.chromedriverChromeMappingFile,\n    bundleId: opts.chromeBundleId,\n    useSystemExecutable: opts.chromedriverUseSystemExecutable,\n    disableBuildCheck: opts.chromedriverDisableBuildCheck,\n    details,\n    isAutodownloadEnabled: this?.isChromedriverAutodownloadEnabled?.()\n  });\n\n  // make sure there are chromeOptions\n  opts.chromeOptions = opts.chromeOptions || {};\n  // try out any prefixed chromeOptions,\n  // and strip the prefix\n  for (const opt of _.keys(opts)) {\n    if (opt.endsWith(':chromeOptions')) {\n      this?.log?.warn(`Merging '${opt}' into 'chromeOptions'. This may cause unexpected behavior`);\n      _.merge(opts.chromeOptions, opts[opt]);\n    }\n  }\n\n  const caps = webviewHelpers.createChromedriverCaps(opts, curDeviceId, details);\n  this?.log?.debug(`Before starting chromedriver, androidPackage is '${caps.chromeOptions.androidPackage}'`);\n  await chromedriver.start(caps);\n  return chromedriver;\n};\nconst setupNewChromedriver = helpers.setupNewChromedriver;\n\n\nObject.assign(extensions, commands, helpers);\nexport { commands, helpers, setupNewChromedriver };\nexport default extensions;\n"],"mappings":"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"}