{"version":3,"file":"shell.js","names":["_lodash","_interopRequireDefault","require","_teen_process","_support","_driver","_utils","commands","exports","mobileShell","opts","ensureFeatureEnabled","ADB_SHELL_FEATURE","command","args","timeout","includeStderr","_","isString","errors","InvalidArgumentError","adbArgs","adb","executable","defaultArgs","isArray","log","debug","path","util","quote","stdout","stderr","exec","err","errorAndThrow","message","_default","default"],"sources":["../../../lib/commands/shell.js"],"sourcesContent":["import _ from 'lodash';\nimport { exec } from 'teen_process';\nimport { util } from '@appium/support';\nimport { errors } from 'appium/driver';\nimport { ADB_SHELL_FEATURE } from '../utils';\n\nconst commands = {};\n\ncommands.mobileShell = async function mobileShell (opts = {}) {\n  this.ensureFeatureEnabled(ADB_SHELL_FEATURE);\n\n  const {\n    command,\n    args = [],\n    timeout = 20000,\n    includeStderr,\n  } = opts;\n\n  if (!_.isString(command)) {\n    throw new errors.InvalidArgumentError(`The 'command' argument is mandatory`);\n  }\n\n  const adbArgs = [\n    ...this.adb.executable.defaultArgs,\n    'shell',\n    command,\n    ...(_.isArray(args) ? args : [args])\n  ];\n  this.log.debug(`Running '${this.adb.executable.path} ${util.quote(adbArgs)}'`);\n  try {\n    const {stdout, stderr} = await exec(this.adb.executable.path, adbArgs, {timeout});\n    if (includeStderr) {\n      return {\n        stdout,\n        stderr\n      };\n    }\n    return stdout;\n  } catch (err) {\n    this.log.errorAndThrow(`Cannot execute the '${command}' shell command. ` +\n      `Original error: ${err.message}. ` +\n      `StdOut: ${err.stdout}. StdErr: ${err.stderr}`);\n  }\n};\n\nexport { commands };\nexport default commands;\n"],"mappings":";;;;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,aAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAF,OAAA;AACA,IAAAG,OAAA,GAAAH,OAAA;AACA,IAAAI,MAAA,GAAAJ,OAAA;AAEA,MAAMK,QAAQ,GAAG,CAAC,CAAC;AAACC,OAAA,CAAAD,QAAA,GAAAA,QAAA;AAEpBA,QAAQ,CAACE,WAAW,GAAG,eAAeA,WAAWA,CAAEC,IAAI,GAAG,CAAC,CAAC,EAAE;EAC5D,IAAI,CAACC,oBAAoB,CAACC,wBAAiB,CAAC;EAE5C,MAAM;IACJC,OAAO;IACPC,IAAI,GAAG,EAAE;IACTC,OAAO,GAAG,KAAK;IACfC;EACF,CAAC,GAAGN,IAAI;EAER,IAAI,CAACO,eAAC,CAACC,QAAQ,CAACL,OAAO,CAAC,EAAE;IACxB,MAAM,IAAIM,cAAM,CAACC,oBAAoB,CAAE,qCAAoC,CAAC;EAC9E;EAEA,MAAMC,OAAO,GAAG,CACd,GAAG,IAAI,CAACC,GAAG,CAACC,UAAU,CAACC,WAAW,EAClC,OAAO,EACPX,OAAO,EACP,IAAII,eAAC,CAACQ,OAAO,CAACX,IAAI,CAAC,GAAGA,IAAI,GAAG,CAACA,IAAI,CAAC,CAAC,CACrC;EACD,IAAI,CAACY,GAAG,CAACC,KAAK,CAAE,YAAW,IAAI,CAACL,GAAG,CAACC,UAAU,CAACK,IAAK,IAAGC,aAAI,CAACC,KAAK,CAACT,OAAO,CAAE,GAAE,CAAC;EAC9E,IAAI;IACF,MAAM;MAACU,MAAM;MAAEC;IAAM,CAAC,GAAG,MAAM,IAAAC,kBAAI,EAAC,IAAI,CAACX,GAAG,CAACC,UAAU,CAACK,IAAI,EAAEP,OAAO,EAAE;MAACN;IAAO,CAAC,CAAC;IACjF,IAAIC,aAAa,EAAE;MACjB,OAAO;QACLe,MAAM;QACNC;MACF,CAAC;IACH;IACA,OAAOD,MAAM;EACf,CAAC,CAAC,OAAOG,GAAG,EAAE;IACZ,IAAI,CAACR,GAAG,CAACS,aAAa,CAAE,uBAAsBtB,OAAQ,mBAAkB,GACrE,mBAAkBqB,GAAG,CAACE,OAAQ,IAAG,GACjC,WAAUF,GAAG,CAACH,MAAO,aAAYG,GAAG,CAACF,MAAO,EAAC,CAAC;EACnD;AACF,CAAC;AAAC,IAAAK,QAAA,GAGa9B,QAAQ;AAAAC,OAAA,CAAA8B,OAAA,GAAAD,QAAA"}