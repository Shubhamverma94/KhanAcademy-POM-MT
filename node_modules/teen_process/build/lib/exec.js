"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
exports.exec = exec;

require("source-map-support/register");

var _child_process = require("child_process");

var _shellQuote = require("shell-quote");

var _bluebird = _interopRequireDefault(require("bluebird"));

var _lodash = _interopRequireDefault(require("lodash"));

var _helpers = require("./helpers");

const MAX_BUFFER_SIZE = 100 * 1024 * 1024;

async function exec(cmd, args = [], opts = {}) {
  const rep = (0, _shellQuote.quote)([cmd, ...args]);
  opts = _lodash.default.defaults(opts, {
    timeout: null,
    encoding: 'utf8',
    killSignal: 'SIGTERM',
    cwd: undefined,
    env: process.env,
    ignoreOutput: false,
    stdio: 'inherit',
    isBuffer: false,
    shell: undefined,
    logger: undefined,
    maxStdoutBufferSize: MAX_BUFFER_SIZE,
    maxStderrBufferSize: MAX_BUFFER_SIZE
  });
  const isBuffer = Boolean(opts.isBuffer);
  return await new _bluebird.default((resolve, reject) => {
    let proc = (0, _child_process.spawn)(cmd, args, {
      cwd: opts.cwd,
      env: opts.env,
      shell: opts.shell
    });
    let stdoutArr = [],
        stderrArr = [],
        timer = null;
    proc.on('error', err => {
      if (err.errno === 'ENOENT') {
        err = (0, _helpers.formatEnoent)(err, cmd, opts.cwd);
      }

      reject(err);
    });

    if (proc.stdin) {
      proc.stdin.on('error', err => {
        reject(new Error(`Standard input '${err.syscall}' error: ${err.stack}`));
      });
    }

    const handleStream = (streamType, streamProps) => {
      if (!proc[streamType]) {
        return;
      }

      proc[streamType].on('error', err => {
        reject(new Error(`${_lodash.default.capitalize(streamType)} '${err.syscall}' error: ${err.stack}`));
      });

      if (opts.ignoreOutput) {
        proc[streamType].on('data', () => {});
        return;
      }

      const {
        chunks,
        maxSize
      } = streamProps;
      let size = 0;
      proc[streamType].on('data', chunk => {
        chunks.push(chunk);
        size += chunk.length;

        while (chunks.length > 1 && size >= maxSize) {
          size -= chunks[0].length;
          chunks.shift();
        }

        if (opts.logger && _lodash.default.isFunction(opts.logger.debug)) {
          opts.logger.debug(chunk.toString());
        }
      });
    };

    handleStream('stdout', {
      maxSize: opts.maxStdoutBufferSize,
      chunks: stdoutArr
    });
    handleStream('stderr', {
      maxSize: opts.maxStderrBufferSize,
      chunks: stderrArr
    });

    function getStdio(isBuffer) {
      let stdout, stderr;

      if (isBuffer) {
        stdout = Buffer.concat(stdoutArr);
        stderr = Buffer.concat(stderrArr);
      } else {
        stdout = Buffer.concat(stdoutArr).toString(opts.encoding);
        stderr = Buffer.concat(stderrArr).toString(opts.encoding);
      }

      return {
        stdout,
        stderr
      };
    }

    proc.on('close', code => {
      if (timer) {
        clearTimeout(timer);
      }

      let {
        stdout,
        stderr
      } = getStdio(isBuffer);

      if (code === 0) {
        resolve({
          stdout,
          stderr,
          code
        });
      } else {
        let err = new Error(`Command '${rep}' exited with code ${code}`);
        err = Object.assign(err, {
          stdout,
          stderr,
          code
        });
        reject(err);
      }
    });

    if (opts.timeout) {
      timer = setTimeout(() => {
        let {
          stdout,
          stderr
        } = getStdio(isBuffer);
        let err = new Error(`Command '${rep}' timed out after ${opts.timeout}ms`);
        err = Object.assign(err, {
          stdout,
          stderr,
          code: null
        });
        reject(err);
        proc.kill(opts.killSignal);
      }, opts.timeout);
    }
  });
}

var _default = exec;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJNQVhfQlVGRkVSX1NJWkUiLCJleGVjIiwiY21kIiwiYXJncyIsIm9wdHMiLCJyZXAiLCJxdW90ZSIsIl8iLCJkZWZhdWx0cyIsInRpbWVvdXQiLCJlbmNvZGluZyIsImtpbGxTaWduYWwiLCJjd2QiLCJ1bmRlZmluZWQiLCJlbnYiLCJwcm9jZXNzIiwiaWdub3JlT3V0cHV0Iiwic3RkaW8iLCJpc0J1ZmZlciIsInNoZWxsIiwibG9nZ2VyIiwibWF4U3Rkb3V0QnVmZmVyU2l6ZSIsIm1heFN0ZGVyckJ1ZmZlclNpemUiLCJCb29sZWFuIiwiQiIsInJlc29sdmUiLCJyZWplY3QiLCJwcm9jIiwic3Bhd24iLCJzdGRvdXRBcnIiLCJzdGRlcnJBcnIiLCJ0aW1lciIsIm9uIiwiZXJyIiwiZXJybm8iLCJmb3JtYXRFbm9lbnQiLCJzdGRpbiIsIkVycm9yIiwic3lzY2FsbCIsInN0YWNrIiwiaGFuZGxlU3RyZWFtIiwic3RyZWFtVHlwZSIsInN0cmVhbVByb3BzIiwiY2FwaXRhbGl6ZSIsImNodW5rcyIsIm1heFNpemUiLCJzaXplIiwiY2h1bmsiLCJwdXNoIiwibGVuZ3RoIiwic2hpZnQiLCJpc0Z1bmN0aW9uIiwiZGVidWciLCJ0b1N0cmluZyIsImdldFN0ZGlvIiwic3Rkb3V0Iiwic3RkZXJyIiwiQnVmZmVyIiwiY29uY2F0IiwiY29kZSIsImNsZWFyVGltZW91dCIsIk9iamVjdCIsImFzc2lnbiIsInNldFRpbWVvdXQiLCJraWxsIl0sInNvdXJjZXMiOlsiLi4vLi4vbGliL2V4ZWMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyogZXNsaW50LWRpc2FibGUgcHJvbWlzZS9wcmVmZXItYXdhaXQtdG8tY2FsbGJhY2tzICovXG5cbmltcG9ydCB7IHNwYXduIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgeyBxdW90ZSB9IGZyb20gJ3NoZWxsLXF1b3RlJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBmb3JtYXRFbm9lbnQgfSBmcm9tICcuL2hlbHBlcnMnO1xuXG5jb25zdCBNQVhfQlVGRkVSX1NJWkUgPSAxMDAgKiAxMDI0ICogMTAyNDtcblxuLyoqXG4gKiBTcGF3bnMgYSBwcm9jZXNzXG4gKiBAdGVtcGxhdGUge1RlZW5Qcm9jZXNzRXhlY09wdGlvbnN9IFRcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbWQgLSBQcm9ncmFtIHRvIGV4ZWN1dGVcbiAqIEBwYXJhbSB7c3RyaW5nW119IFthcmdzXSAtIEFyZ3VtZW50cyB0byBwYXNzIHRvIHRoZSBwcm9ncmFtXG4gKiBAcGFyYW0ge1R9IFtvcHRzXSAtIE9wdGlvbnNcbiAqIEByZXR1cm5zIHtQcm9taXNlPEJ1ZmZlclByb3A8VD4gZXh0ZW5kcyB0cnVlID8gVGVlblByb2Nlc3NFeGVjQnVmZmVyUmVzdWx0IDogVGVlblByb2Nlc3NFeGVjU3RyaW5nUmVzdWx0Pn1cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZXhlYyAoY21kLCBhcmdzID0gW10sIG9wdHMgPSAvKiogQHR5cGUge1R9ICovKHt9KSkge1xuICAvLyBnZXQgYSBxdW90ZWQgcmVwcmVzZW50YXRpb24gb2YgdGhlIGNvbW1hbmQgZm9yIGVycm9yIHN0cmluZ3NcbiAgY29uc3QgcmVwID0gcXVvdGUoW2NtZCwgLi4uYXJnc10pO1xuXG4gIC8vIGV4dGVuZCBkZWZhdWx0IG9wdGlvbnM7IHdlJ3JlIGJhc2ljYWxseSByZS1pbXBsZW1lbnRpbmcgZXhlYydzIG9wdGlvbnNcbiAgLy8gZm9yIHVzZSBoZXJlIHdpdGggc3Bhd24gdW5kZXIgdGhlIGhvb2RcbiAgb3B0cyA9IC8qKiBAdHlwZSB7VH0gKi8oXy5kZWZhdWx0cyhvcHRzLCB7XG4gICAgdGltZW91dDogbnVsbCxcbiAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgIGtpbGxTaWduYWw6ICdTSUdURVJNJyxcbiAgICBjd2Q6IHVuZGVmaW5lZCxcbiAgICBlbnY6IHByb2Nlc3MuZW52LFxuICAgIGlnbm9yZU91dHB1dDogZmFsc2UsXG4gICAgc3RkaW86ICdpbmhlcml0JyxcbiAgICBpc0J1ZmZlcjogZmFsc2UsXG4gICAgc2hlbGw6IHVuZGVmaW5lZCxcbiAgICBsb2dnZXI6IHVuZGVmaW5lZCxcbiAgICBtYXhTdGRvdXRCdWZmZXJTaXplOiBNQVhfQlVGRkVSX1NJWkUsXG4gICAgbWF4U3RkZXJyQnVmZmVyU2l6ZTogTUFYX0JVRkZFUl9TSVpFLFxuICB9KSk7XG5cbiAgY29uc3QgaXNCdWZmZXIgPSBCb29sZWFuKG9wdHMuaXNCdWZmZXIpO1xuXG4gIC8vIHRoaXMgaXMgYW4gYXN5bmMgZnVuY3Rpb24sIHNvIHJldHVybiBhIHByb21pc2VcbiAgcmV0dXJuIGF3YWl0IG5ldyBCKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAvLyBzcGF3biB0aGUgY2hpbGQgcHJvY2VzcyB3aXRoIG9wdGlvbnM7IHdlIGRvbid0IGN1cnJlbnRseSBleHBvc2UgYW55IG9mXG4gICAgLy8gdGhlIG90aGVyICdzcGF3bicgb3B0aW9ucyB0aHJvdWdoIHRoZSBBUElcbiAgICBsZXQgcHJvYyA9IHNwYXduKGNtZCwgYXJncywge2N3ZDogb3B0cy5jd2QsIGVudjogb3B0cy5lbnYsIHNoZWxsOiBvcHRzLnNoZWxsfSk7XG4gICAgbGV0IHN0ZG91dEFyciA9IFtdLCBzdGRlcnJBcnIgPSBbXSwgdGltZXIgPSBudWxsO1xuXG4gICAgLy8gaWYgdGhlIHByb2Nlc3MgZXJyb3JzIG91dCwgcmVqZWN0IHRoZSBwcm9taXNlXG4gICAgcHJvYy5vbignZXJyb3InLCAvKiogQHBhcmFtIHtOb2RlSlMuRXJybm9FeGNlcHRpb259IGVyciAqLyhlcnIpID0+IHtcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgIGlmIChlcnIuZXJybm8gPT09ICdFTk9FTlQnKSB7XG4gICAgICAgIGVyciA9IGZvcm1hdEVub2VudChlcnIsIGNtZCwgb3B0cy5jd2QpO1xuICAgICAgfVxuICAgICAgcmVqZWN0KGVycik7XG4gICAgfSk7XG4gICAgaWYgKHByb2Muc3RkaW4pIHtcbiAgICAgIHByb2Muc3RkaW4ub24oJ2Vycm9yJywgLyoqIEBwYXJhbSB7Tm9kZUpTLkVycm5vRXhjZXB0aW9ufSBlcnIgKi8oZXJyKSA9PiB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoYFN0YW5kYXJkIGlucHV0ICcke2Vyci5zeXNjYWxsfScgZXJyb3I6ICR7ZXJyLnN0YWNrfWApKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCBoYW5kbGVTdHJlYW0gPSAoc3RyZWFtVHlwZSwgc3RyZWFtUHJvcHMpID0+IHtcbiAgICAgIGlmICghcHJvY1tzdHJlYW1UeXBlXSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHByb2Nbc3RyZWFtVHlwZV0ub24oJ2Vycm9yJywgKGVycikgPT4ge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKGAke18uY2FwaXRhbGl6ZShzdHJlYW1UeXBlKX0gJyR7ZXJyLnN5c2NhbGx9JyBlcnJvcjogJHtlcnIuc3RhY2t9YCkpO1xuICAgICAgfSk7XG5cbiAgICAgIGlmIChvcHRzLmlnbm9yZU91dHB1dCkge1xuICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvaXNzdWVzLzQyMzZcbiAgICAgICAgcHJvY1tzdHJlYW1UeXBlXS5vbignZGF0YScsICgpID0+IHt9KTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSBzdHJlYW0gaWYgd2UgZG9uJ3Qgd2FudCB0byBpZ25vcmUgaXRcbiAgICAgIGNvbnN0IHtjaHVua3MsIG1heFNpemV9ID0gc3RyZWFtUHJvcHM7XG4gICAgICBsZXQgc2l6ZSA9IDA7XG4gICAgICBwcm9jW3N0cmVhbVR5cGVdLm9uKCdkYXRhJywgKGNodW5rKSA9PiB7XG4gICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTtcbiAgICAgICAgc2l6ZSArPSBjaHVuay5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChjaHVua3MubGVuZ3RoID4gMSAmJiBzaXplID49IG1heFNpemUpIHtcbiAgICAgICAgICBzaXplIC09IGNodW5rc1swXS5sZW5ndGg7XG4gICAgICAgICAgY2h1bmtzLnNoaWZ0KCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdHMubG9nZ2VyICYmIF8uaXNGdW5jdGlvbihvcHRzLmxvZ2dlci5kZWJ1ZykpIHtcbiAgICAgICAgICBvcHRzLmxvZ2dlci5kZWJ1ZyhjaHVuay50b1N0cmluZygpKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfTtcbiAgICBoYW5kbGVTdHJlYW0oJ3N0ZG91dCcsIHtcbiAgICAgIG1heFNpemU6IG9wdHMubWF4U3Rkb3V0QnVmZmVyU2l6ZSxcbiAgICAgIGNodW5rczogc3Rkb3V0QXJyLFxuICAgIH0pO1xuICAgIGhhbmRsZVN0cmVhbSgnc3RkZXJyJywge1xuICAgICAgbWF4U2l6ZTogb3B0cy5tYXhTdGRlcnJCdWZmZXJTaXplLFxuICAgICAgY2h1bmtzOiBzdGRlcnJBcnIsXG4gICAgfSk7XG5cbiAgICAvKipcbiAgICAgKiBAdGVtcGxhdGUge2Jvb2xlYW59IFVcbiAgICAgKiBAcGFyYW0ge1V9IGlzQnVmZmVyXG4gICAgICogQHJldHVybnMge1UgZXh0ZW5kcyB0cnVlID8ge3N0ZG91dDogQnVmZmVyLCBzdGRlcnI6IEJ1ZmZlcn0gOiB7c3Rkb3V0OiBzdHJpbmcsIHN0ZGVycjogc3RyaW5nfX1cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBnZXRTdGRpbyAoaXNCdWZmZXIpIHtcbiAgICAgIGxldCBzdGRvdXQsIHN0ZGVycjtcbiAgICAgIGlmIChpc0J1ZmZlcikge1xuICAgICAgICBzdGRvdXQgPSBCdWZmZXIuY29uY2F0KHN0ZG91dEFycik7XG4gICAgICAgIHN0ZGVyciA9IEJ1ZmZlci5jb25jYXQoc3RkZXJyQXJyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0ZG91dCA9IEJ1ZmZlci5jb25jYXQoc3Rkb3V0QXJyKS50b1N0cmluZyhvcHRzLmVuY29kaW5nKTtcbiAgICAgICAgc3RkZXJyID0gQnVmZmVyLmNvbmNhdChzdGRlcnJBcnIpLnRvU3RyaW5nKG9wdHMuZW5jb2RpbmcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIC8qKiBAdHlwZSB7VSBleHRlbmRzIHRydWUgPyB7c3Rkb3V0OiBCdWZmZXIsIHN0ZGVycjogQnVmZmVyfSA6IHtzdGRvdXQ6IHN0cmluZywgc3RkZXJyOiBzdHJpbmd9fSAqLyh7c3Rkb3V0LCBzdGRlcnJ9KTtcbiAgICB9XG5cbiAgICAvLyBpZiB0aGUgcHJvY2VzcyBlbmRzLCBlaXRoZXIgcmVzb2x2ZSBvciByZWplY3QgdGhlIHByb21pc2UgYmFzZWQgb24gdGhlXG4gICAgLy8gZXhpdCBjb2RlIG9mIHRoZSBwcm9jZXNzLiBlaXRoZXIgd2F5LCBhdHRhY2ggc3Rkb3V0LCBzdGRlcnIsIGFuZCBjb2RlLlxuICAgIC8vIEFsc28gY2xlYW4gdXAgdGhlIHRpbWVyIGlmIGl0IGV4aXN0c1xuICAgIHByb2Mub24oJ2Nsb3NlJywgKGNvZGUpID0+IHtcbiAgICAgIGlmICh0aW1lcikge1xuICAgICAgICBjbGVhclRpbWVvdXQodGltZXIpO1xuICAgICAgfVxuICAgICAgbGV0IHtzdGRvdXQsIHN0ZGVycn0gPSBnZXRTdGRpbyhpc0J1ZmZlcik7XG4gICAgICBpZiAoY29kZSA9PT0gMCkge1xuICAgICAgICByZXNvbHZlKC8qKiBAdHlwZSB7QnVmZmVyUHJvcDxUPiBleHRlbmRzIHRydWUgPyBUZWVuUHJvY2Vzc0V4ZWNCdWZmZXJSZXN1bHQgOiBUZWVuUHJvY2Vzc0V4ZWNTdHJpbmdSZXN1bHR9ICovKHtzdGRvdXQsIHN0ZGVyciwgY29kZX0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBlcnIgPSBuZXcgRXJyb3IoYENvbW1hbmQgJyR7cmVwfScgZXhpdGVkIHdpdGggY29kZSAke2NvZGV9YCk7XG4gICAgICAgIGVyciA9IE9iamVjdC5hc3NpZ24oZXJyLCB7c3Rkb3V0LCBzdGRlcnIsIGNvZGV9KTtcbiAgICAgICAgcmVqZWN0KGVycik7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBpZiB3ZSBzZXQgYSB0aW1lb3V0IG9uIHRoZSBjaGlsZCBwcm9jZXNzLCBjdXQgaW50byB0aGUgZXhlY3V0aW9uIGFuZFxuICAgIC8vIHJlamVjdCBpZiB0aGUgdGltZW91dCBpcyByZWFjaGVkLiBBdHRhY2ggdGhlIHN0ZG91dC9zdGRlcnIgd2UgY3VycmVudGx5XG4gICAgLy8gaGF2ZSBpbiBjYXNlIGl0J3MgaGVscGZ1bCBpbiBkZWJ1Z2dpbmdcbiAgICBpZiAob3B0cy50aW1lb3V0KSB7XG4gICAgICB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBsZXQge3N0ZG91dCwgc3RkZXJyfSA9IGdldFN0ZGlvKGlzQnVmZmVyKTtcbiAgICAgICAgbGV0IGVyciA9IG5ldyBFcnJvcihgQ29tbWFuZCAnJHtyZXB9JyB0aW1lZCBvdXQgYWZ0ZXIgJHtvcHRzLnRpbWVvdXR9bXNgKTtcbiAgICAgICAgZXJyID0gT2JqZWN0LmFzc2lnbihlcnIsIHtzdGRvdXQsIHN0ZGVyciwgY29kZTogbnVsbH0pO1xuICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgLy8gcmVqZWN0IGFuZCBUSEVOIGtpbGwgdG8gYXZvaWQgcmFjZSBjb25kaXRpb25zIHdpdGggdGhlIGhhbmRsZXJzXG4gICAgICAgIC8vIGFib3ZlXG4gICAgICAgIHByb2Mua2lsbChvcHRzLmtpbGxTaWduYWwpO1xuICAgICAgfSwgb3B0cy50aW1lb3V0KTtcbiAgICB9XG4gIH0pO1xufVxuXG5leHBvcnQgeyBleGVjIH07XG5leHBvcnQgZGVmYXVsdCBleGVjO1xuXG4vKipcbiAqIE9wdGlvbnMgb24gdG9wIG9mIGBTcGF3bk9wdGlvbnNgLCB1bmlxdWUgdG8gYHRlZW5fcHJvY2Vzcy5gXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBUZWVuUHJvY2Vzc1Byb3BzXG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IFtpZ25vcmVPdXRwdXRdIC0gSWdub3JlICYgZGlzY2FyZCBhbGwgb3V0cHV0XG4gKiBAcHJvcGVydHkge2Jvb2xlYW59IFtpc0J1ZmZlcl0gLSBSZXR1cm4gb3V0cHV0IGFzIGEgQnVmZmVyXG4gKiBAcHJvcGVydHkge1RlZW5Qcm9jZXNzTG9nZ2VyfSBbbG9nZ2VyXSAtIExvZ2dlciB0byB1c2UgZm9yIGRlYnVnZ2luZ1xuICogQHByb3BlcnR5IHtudW1iZXJ9IFttYXhTdGRvdXRCdWZmZXJTaXplXSAtIE1heGltdW0gc2l6ZSBvZiBgc3Rkb3V0YCBidWZmZXJcbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbbWF4U3RkZXJyQnVmZmVyU2l6ZV0gLSBNYXhpbXVtIHNpemUgb2YgYHN0ZGVycmAgYnVmZmVyXG4gKiBAcHJvcGVydHkge0J1ZmZlckVuY29kaW5nfSBbZW5jb2Rpbmc9J3V0ZjgnXSAtIEVuY29kaW5nIHRvIHVzZSBmb3Igb3V0cHV0XG4gKi9cblxuLyoqXG4gKiBBIGxvZ2dlciBvYmplY3QgdW5kZXJzdG9vZCBieSB7QGxpbmsgZXhlYyB0ZWVuX3Byb2Nlc3MuZXhlY30uXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBUZWVuUHJvY2Vzc0xvZ2dlclxuICogQHByb3BlcnR5IHsoLi4uYXJnczogYW55W10pID0+IHZvaWR9IGRlYnVnXG4gKi9cblxuLyoqXG4gKiBPcHRpb25zIGZvciB7QGxpbmsgZXhlYyB0ZWVuX3Byb2Nlc3MuZXhlY30uXG4gKiBAdHlwZWRlZiB7aW1wb3J0KCdjaGlsZF9wcm9jZXNzJykuU3Bhd25PcHRpb25zICYgVGVlblByb2Nlc3NQcm9wc30gVGVlblByb2Nlc3NFeGVjT3B0aW9uc1xuICovXG5cbi8qKlxuICogVGhlIHZhbHVlIHtAbGluayBleGVjIHRlZW5fcHJvY2Vzcy5leGVjfSByZXNvbHZlcyB0byB3aGVuIGBpc0J1ZmZlcmAgaXMgYGZhbHNlYFxuICogQHR5cGVkZWYge09iamVjdH0gVGVlblByb2Nlc3NFeGVjU3RyaW5nUmVzdWx0XG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3Rkb3V0IC0gU3Rkb3V0XG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3RkZXJyIC0gU3RkZXJyXG4gKiBAcHJvcGVydHkge251bWJlcj99IGNvZGUgLSBFeGl0IGNvZGVcbiAqL1xuXG4vKipcbiAqIFRoZSB2YWx1ZSB7QGxpbmsgZXhlYyB0ZWVuX3Byb2Nlc3MuZXhlY30gcmVzb2x2ZXMgdG8gd2hlbiBgaXNCdWZmZXJgIGlzIGB0cnVlYFxuICogQHR5cGVkZWYge09iamVjdH0gVGVlblByb2Nlc3NFeGVjQnVmZmVyUmVzdWx0XG4gKiBAcHJvcGVydHkge0J1ZmZlcn0gc3Rkb3V0IC0gU3Rkb3V0XG4gKiBAcHJvcGVydHkge0J1ZmZlcn0gc3RkZXJyIC0gU3RkZXJyXG4gKiBAcHJvcGVydHkge251bWJlcj99IGNvZGUgLSBFeGl0IGNvZGVcbiAqL1xuXG4vKipcbiAqIEV4dHJhIHByb3BzIHtAbGluayBleGVjIHRlZW5fcHJvY2Vzcy5leGVjfSBhZGRzIHRvIGl0cyBlcnJvciBvYmplY3RzXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBUZWVuUHJvY2Vzc0V4ZWNFcnJvclByb3BzXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3Rkb3V0IC0gU1RET1VUXG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3RkZXJyIC0gU1RERVJSXG4gKiBAcHJvcGVydHkge251bWJlcj99IGNvZGUgLSBFeGl0IGNvZGVcbiAqL1xuXG4vKipcbiAqIEVycm9yIHRocm93biBieSB7QGxpbmsgZXhlYyB0ZWVuX3Byb2Nlc3MuZXhlY31cbiAqIEB0eXBlZGVmIHtFcnJvciAmIFRlZW5Qcm9jZXNzRXhlY0Vycm9yUHJvcHN9IFRlZW5Qcm9jZXNzRXhlY0Vycm9yXG4gKi9cblxuLyoqXG4gKiBAdGVtcGxhdGUge3tpc0J1ZmZlcj86IGJvb2xlYW59fSBNYXliZUJ1ZmZlclxuICogQHR5cGVkZWYge01heWJlQnVmZmVyWydpc0J1ZmZlciddfSBCdWZmZXJQcm9wXG4gKiBAcHJpdmF0ZVxuICovXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBLE1BQU1BLGVBQWUsR0FB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